

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Jerry(姜源)">
  <meta name="keywords" content="Java,Html,CSS,JavaScript,Python,C,Linux,shell编程经验分享、技术总结、心得体会">
  
    <meta name="description" content="参考资料(官网)：https:&#x2F;&#x2F;www.jenkins.io&#x2F;zh&#x2F;  一、安装 jenkins 在你的本地电脑或者linux服务器上下载安装jenkins:jenkins下载地址：https:&#x2F;&#x2F;jenkins.io&#x2F;   下载网站的war包版本就好了  下载完后把它部署到你的tomcat上运行：放到tomcat的webapps目录下，启动tomcat（windows下双击startup.ba">
<meta property="og:type" content="article">
<meta property="og:title" content="01-Jenkins自动化部署项目">
<meta property="og:url" content="https://janycode.github.io/2019/09/07/09_%E8%B0%83%E8%AF%95%E6%B5%8B%E8%AF%95/04_%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/01-Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/index.html">
<meta property="og:site_name" content="姜源の云笔记">
<meta property="og:description" content="参考资料(官网)：https:&#x2F;&#x2F;www.jenkins.io&#x2F;zh&#x2F;  一、安装 jenkins 在你的本地电脑或者linux服务器上下载安装jenkins:jenkins下载地址：https:&#x2F;&#x2F;jenkins.io&#x2F;   下载网站的war包版本就好了  下载完后把它部署到你的tomcat上运行：放到tomcat的webapps目录下，启动tomcat（windows下双击startup.ba">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127112846.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127111026.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127111431.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127111504.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127111600.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127111659.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127111929.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127112005.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127112024.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127112124.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127112318.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113128.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113205.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113308.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113343.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113416.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113445.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113512.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113534.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113638.png">
<meta property="article:published_time" content="2019-09-07T13:14:38.000Z">
<meta property="article:modified_time" content="2023-05-05T05:58:14.317Z">
<meta property="article:author" content="Jerry(姜源)">
<meta property="article:tag" content="Jenkins">
<meta property="article:tag" content="自动化部署">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127112846.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>01-Jenkins自动化部署项目 - 姜源の云笔记</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"janycode.github.io","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":50,"cursorChar":"|","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":false},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"bfff735c897eb60ea49b735096b20e47","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 50vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>姜源の云笔记</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tools/">
                <i class="iconfont icon-slack-fill"></i>
                工具
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" target="_blank" rel="noopener" href="https://janycode.gitee.io/">
                <i class="iconfont icon-gitee-fill"></i>
                Gitee
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="01-Jenkins自动化部署项目"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Jerry(姜源)
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2019-09-07 21:14" pubdate>
          星期六, 2019/09/07 21:14:38
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          13k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          107 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">01-Jenkins自动化部署项目</h1>
            
            <div class="markdown-body">
              
              <p>参考资料(官网)：<a target="_blank" rel="noopener" href="https://www.jenkins.io/zh/">https://www.jenkins.io/zh/</a></p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127112846.png" srcset="/img/loading.gif" lazyload alt="image-20220127112845609"></p>
<h3 id="一、安装-jenkins"><a href="#一、安装-jenkins" class="headerlink" title="一、安装 jenkins"></a>一、安装 jenkins</h3><blockquote>
<p>在你的本地电脑或者linux服务器上下载安装jenkins:<br>jenkins下载地址：<a target="_blank" rel="noopener" href="https://jenkins.io/">https://jenkins.io/</a>   下载网站的war包版本就好了</p>
</blockquote>
<p>下载完后把它部署到你的tomcat上运行：放到tomcat的webapps目录下，启动tomcat（windows下双击startup.bat或者linux下运行<code>sh startup.sh</code>），然后通过浏览器访问，如我的电脑上访问：<code>localhost:8080/jenkins</code> 。启动后的界面如下：</p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127111026.png" srcset="/img/loading.gif" lazyload alt="image-20220127111025593"></p>
<p>然后到提示的文件中把里面的文本复制出来填到管理员密码中。</p>
<p>接着如果是在本地电脑跑，可能会出现：<code>该jenkins实例似乎已离线</code> 提示，如果出现，是因为本地https访问不了的原因。在浏览器中另打开一个界面<a target="_blank" rel="noopener" href="http://localhost:8080/pluginManager/advanced%EF%BC%8C%E6%8A%8A%E5%8D%87%E7%BA%A7%E7%AB%99%E7%82%B9%E4%B8%AD%E7%9A%84url%E4%B8%AD%E7%9A%84https%E6%94%B9%E4%B8%BAhttp,%E4%BF%9D%E5%AD%98%E6%9B%B4%E6%96%B0%E3%80%82%E7%84%B6%E5%90%8E%E5%85%B3%E6%8E%89tomcat%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%87%8D%E5%90%AF%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%81%94%E7%BD%91%E4%BA%86%E3%80%82">http://localhost:8080/pluginManager/advanced，把升级站点中的url中的https改为http,保存更新。然后关掉tomcat服务器重启，就可以联网了。</a></p>
<p>接下来选择安装推荐的插件，这个需要一定的时间。最后额外推荐安装两个插件，在系统管理中可以安装插件：</p>
<ol>
<li><p>Rebuilder</p>
</li>
<li><p>Safe Restart</p>
</li>
</ol>
<h3 id="二、安装-git-maven"><a href="#二、安装-git-maven" class="headerlink" title="二、安装 git,maven"></a>二、安装 git,maven</h3><blockquote>
<p>在linux服务器中安装git, maven，创建一个jenkens目录，配置git的公钥到你的github上，这些步骤是使用jenkins的前提。</p>
</blockquote>
<p>安装git的目的是在自动化部署前实时从git远程仓库中拉取最新的代码。在linux(我用的是centos系统)安装git：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install git<br></code></pre></td></tr></table></figure>

<p>生成密钥：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh-keygen -t rsa -C &quot;youremail@abc.com&quot;<br></code></pre></td></tr></table></figure>

<p>可以不设置密钥密码直接按三次回车。 把家目录中生成的公钥内容复制到github或其他仓库上。    </p>
<p>安装maven的目的是通过项目中的pom.xml文件自动解决项目依赖问题，构建项目。linux中通过wget+下载链接下载maven的zip包然后解压即可。配置maven环境变量：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/profile<br><br>//在这个文件末尾加上<br>export MAVEN_HOME=/root/maven3.4.5<br>export PATH=$MAVEN_HOME/bin:$PATH<br><br>//保存后在命令行输入,启动配置<br>. /etc/profile<br></code></pre></td></tr></table></figure>

<p>创建jenkins目录，用来存储拉取下来的项目代码等。</p>
<h3 id="三、服务器注册到-jenkins"><a href="#三、服务器注册到-jenkins" class="headerlink" title="三、服务器注册到 jenkins"></a>三、服务器注册到 jenkins</h3><blockquote>
<p>将Linux服务器注册到Jenkins上</p>
</blockquote>
<p>1、开启服务器上的ssh服务，可通过 <code>netstat -anp | grep :22</code> 命令查看是否开启</p>
<p>2、先来测试一下怎么在jenkins中操作远程服务器</p>
<p>在jenkins中选择<strong>系统管理</strong>——》新建节点</p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127111431.png" srcset="/img/loading.gif" lazyload alt="image-20220127111431009"></p>
<p>其中远程工作目录即你在Linux上创建的jenkins目录。在Credentials添加一个远程用户，输入你的远程机器用户名和密码保存。</p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127111504.png" srcset="/img/loading.gif" lazyload alt="image-20220127111503594"></p>
<p>点击TestEnv,启动代理。</p>
<p>在全局工具配置中配置git命令：</p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127111600.png" srcset="/img/loading.gif" lazyload alt="image-20220127111559244"></p>
<p>3、自动化部署过程原理：</p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127111659.png" srcset="/img/loading.gif" lazyload alt="image-20220127111658342"></p>
<p>所以需要编写一个shell脚本来执行这个过程。</p>
<p>具体的创建Jenkins任务的过程为</p>
<ol>
<li><p>创建jenkins任务</p>
</li>
<li><p>填写Server信息</p>
</li>
<li><p>配置git参数</p>
</li>
<li><p>填写构建语句（shell脚本）,实现自动部署。</p>
</li>
</ol>
<h3 id="四、创建自动化部署任务"><a href="#四、创建自动化部署任务" class="headerlink" title="四、创建自动化部署任务"></a>四、创建自动化部署任务</h3><ol>
<li>编写shell部署脚本<code>deploy.sh</code>，并放到linux服务器中的jenkins目录下，在该目录下通过<code>touch deploy.sh</code>创建一个脚本，把下面的脚本复制到里面即可（到时每次自动部署都会执行它），脚本中的 <strong>my-scrum</strong> 为我要自动构建的项目名：</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/usr/bin/env bash</span><br><span class="hljs-comment">#编译+部署项目站点</span><br><br><span class="hljs-comment">#需要配置如下参数</span><br><br><span class="hljs-comment"># 项目路径, 在Execute Shell中配置项目路径, pwd 就可以获得该项目路径</span><br><br><span class="hljs-comment"># export PROJ_PATH=这个jenkins任务在部署机器上的路径</span><br><br><span class="hljs-comment"># 输入你的环境上tomcat的全路径</span><br><br><span class="hljs-comment"># export TOMCAT_APP_PATH=tomcat在部署机器上的路径</span><br><br><span class="hljs-comment">### base 函数</span><br><br><span class="hljs-function"><span class="hljs-title">killTomcat</span></span>()<br>&#123;<br>    <span class="hljs-comment">#pid=`ps -ef|grep tomcat|grep java|awk &#x27;&#123;print $2&#125;&#x27;`</span><br>    <span class="hljs-comment">#echo &quot;tomcat Id list :$pid&quot;</span><br>    <span class="hljs-comment">#if [ &quot;$pid&quot; = &quot;&quot; ]</span><br>    <span class="hljs-comment">#then</span><br>    <span class="hljs-comment">#  echo &quot;no tomcat pid alive&quot;</span><br>    <span class="hljs-comment">#else</span><br>    <span class="hljs-comment">#  kill -9 $pid</span><br>    <span class="hljs-comment">#fi</span><br>    <span class="hljs-comment">#上面注释的或者下面的</span><br>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$TOMCAT_APP_PATH</span>/bin<br>    sh shutdown.sh<br>&#125;<br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$PROJ_PATH</span>/my-scrum<br>mvn clean install<br><br><span class="hljs-comment"># 停tomcat</span><br><br>killTomcat<br><br><span class="hljs-comment"># 删除原有工程</span><br><br><span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$TOMCAT_APP_PATH</span>/webapps/ROOT<br><span class="hljs-built_in">rm</span> -f <span class="hljs-variable">$TOMCAT_APP_PATH</span>/webapps/ROOT.war<br><span class="hljs-built_in">rm</span> -f <span class="hljs-variable">$TOMCAT_APP_PATH</span>/webapps/my-scrum.war<br><br><span class="hljs-comment"># 复制新的工程到tomcat上</span><br><br><span class="hljs-built_in">cp</span> <span class="hljs-variable">$PROJ_PATH</span>/scrum/target/order.war <span class="hljs-variable">$TOMCAT_APP_PATH</span>/webapps/<br><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$TOMCAT_APP_PATH</span>/webapps/<br><span class="hljs-built_in">mv</span> my-scrum.war ROOT.war<br><br><span class="hljs-comment"># 启动Tomcat</span><br><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$TOMCAT_APP_PATH</span>/<br>sh bin/startup.sh<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>在jenkins上点击新建一个任务，填好任务名，填写运行的节点（上文中新建节点时创建的）：</li>
</ol>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127111929.png" srcset="/img/loading.gif" lazyload alt="image-20220127111928388"></p>
<ol start="3">
<li>点击源码管理，填写github（或gitlab等）地址：</li>
</ol>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127112005.png" srcset="/img/loading.gif" lazyload alt="image-20220127112004139"></p>
<ol start="4">
<li>点击add，选择<code>check out to a sub-directory </code>,添加源码下载到jenkins目录下的指定目录（可以命名为你的项目名）：</li>
</ol>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127112024.png" srcset="/img/loading.gif" lazyload alt="image-20220127112023087"></p>
<p>5、填写构建任务时的shell脚本，然后保存，点击立即构建完成自动构建。（这里有一个坑，一定要<code>给tomcat下所有sh文件加上x权限</code>才能启动tomcat成功，具体为在tomcat目录上层执行<code>chmod a+x  -R tomcat</code>目录或者在tomcat的bin目录下执行<code>chmod +x *.sh</code>）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">当jenkins进程结束后新开的tomcat进程不被杀死</span><br>BUILD_ID=DONTKILLME<br><span class="hljs-meta prompt_">#</span><span class="language-bash">加载变量</span><br>. /etc/profile<br><span class="hljs-meta prompt_">#</span><span class="language-bash">配置运行参数</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">PROJ_PATH为设置的jenkins目录的执行任务目录</span><br>export PROJ_PATH=`pwd`<br><span class="hljs-meta prompt_">#</span><span class="language-bash">配置tomcat所在目录</span><br>export TOMCAT_APP_PATH=/root/tomcats/tomcat-my-scrum<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">执行写好的自动化部署脚本</span><br>sh /root/jenkins/deploy.sh<br></code></pre></td></tr></table></figure>

<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127112124.png" srcset="/img/loading.gif" lazyload alt="image-20220127112123466"></p>
<ol start="6">
<li>自动化构建成功：</li>
</ol>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127112318.png" srcset="/img/loading.gif" lazyload alt="image-20220127112317237"></p>
<ol start="7">
<li>后续代码如果有改动，只要push到github或者gitlab等上，在jenkins界面中再次执行构建任务就可以了，非常方便，自动化部署，再也不用手动上传项目到服务器了。</li>
</ol>
<h3 id="五、遇到的问题"><a href="#五、遇到的问题" class="headerlink" title="五、遇到的问题"></a>五、遇到的问题</h3><h4 id="5-1-解决一个tomcat关闭，所有tomcat都被关闭了的问题"><a href="#5-1-解决一个tomcat关闭，所有tomcat都被关闭了的问题" class="headerlink" title="5.1 解决一个tomcat关闭，所有tomcat都被关闭了的问题"></a>5.1 解决一个tomcat关闭，所有tomcat都被关闭了的问题</h4><p>（如果你的jenkins也是安装的服务器上的其中一个tomcat中，就可能被莫名杀掉）</p>
<p>这是因为所有的tomcat的关闭脚本（shutdown.sh或者说catalina.sh）都默认监听的是8005端口。只要进去tomcat目录下的conf目录下的server.xml文件中，将</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Server</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8005&quot;</span> <span class="hljs-attr">shutdown</span>=<span class="hljs-string">&quot;SHUTDOWN&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">Listener</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;org.apache.catalina.startup.VersionLoggerListener&quot;</span> /&gt;</span><br>  <span class="hljs-comment">&lt;!-- Security listener. Documentation at /docs/config/listeners.html</span><br><span class="hljs-comment">  &lt;Listener className=&quot;org.apache.catalina.security.SecurityListener&quot; /&gt;</span><br><span class="hljs-comment">  --&gt;</span><br></code></pre></td></tr></table></figure>

<p>中的8005端口改为不同的端口，就不会一个tomcat关闭，所有的tomcat都被关闭了。</p>
<blockquote>
<p>以后可以在linux服务器中安装多个tomcat，来部署不同的项目，分别使用不同的端口，如我喜欢用8081,8082,8083等端口来解决多个tomcat端口冲突问题（在tomcat的conf目录下的server.xml中修改即可，默认为8080）。然后可以用jenkins来管理这些tomcat的自动化部署。</p>
</blockquote>
<h3 id="六、Pipeline自动化构建"><a href="#六、Pipeline自动化构建" class="headerlink" title="六、Pipeline自动化构建"></a>六、Pipeline自动化构建</h3><p>常见的项目自动化流程应该构建机从代码仓拉取代码进行构建，构建完成后会将产物推送到制品库中，比如镜像仓， 然后中间会有测试环境，用于进行自动化测试或人工测试，最后进行远程部署。</p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113128.png" srcset="/img/loading.gif" lazyload alt="image-20220127113127259"></p>
<h4 id="6-1-新建jenkins项目"><a href="#6-1-新建jenkins项目" class="headerlink" title="6.1 新建jenkins项目"></a>6.1 新建jenkins项目</h4><p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113205.png" srcset="/img/loading.gif" lazyload alt="image-20220127113204007"></p>
<h4 id="6-2-点击配置按钮"><a href="#6-2-点击配置按钮" class="headerlink" title="6.2 点击配置按钮"></a>6.2 点击配置按钮</h4><p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113308.png" srcset="/img/loading.gif" lazyload alt="image-20220127113304678"></p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113343.png" srcset="/img/loading.gif" lazyload alt="image-20220127113342135"></p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113416.png" srcset="/img/loading.gif" lazyload alt="image-20220127113415906"></p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113445.png" srcset="/img/loading.gif" lazyload alt="image-20220127113444513"></p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113512.png" srcset="/img/loading.gif" lazyload alt="image-20220127113511631"></p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113534.png" srcset="/img/loading.gif" lazyload alt="image-20220127113534109"></p>
<p>说明：gitlab需要勾选标签推送事件，即可正常打tag</p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20220127113638.png" srcset="/img/loading.gif" lazyload alt="image-20220127113637575"></p>
<blockquote>
<p>需要自己编写对应项目构建的 jenkinsfile。</p>
<p>eg:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><code class="hljs pipeline">pipeline &#123;<br>	agent any<br>	options &#123;        # jenkins参数<br>		buildDiscarder(logRotator(numToKeepStr: &#x27;10&#x27;))<br>		disableConcurrentBuilds()<br>		timeout(time: 20, unit: &#x27;MINUTES&#x27;)<br>		gitLabConnection(&#x27;gitlab&#x27;)<br>	&#125;<br>    parameters &#123;    # 参数<br>        gitParameter name: &#x27;TAG&#x27;, <br>                     type: &#x27;PT_TAG&#x27;,<br>                     defaultValue: &#x27;master&#x27;<br>    &#125;<br>	environment &#123;         # 环境变量<br>	    GOPATH=&quot;/data/go_pkg&quot;<br>	    CGO_ENABLED=&quot;0&quot;<br>	    GOOS=&quot;linux&quot;<br>	    GOARCH=&quot;amd64&quot;<br>        HOST=&quot;hub.test.com&quot;<br>        RUN_DISPLAY_URL=&quot;https://jenkins.test.com/job/$&#123;JOB_BASE_NAME&#125;/$&#123;BUILD_NUMBER&#125;/display/redirect&quot;<br>        TAB_STR = &quot;\n                    \n&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;<br>    &#125;<br>	stages&#123;       # 第一阶段打印变量<br>	   stage(&#x27;Printenv&#x27;) &#123;<br>          steps &#123;<br>            script&#123;<br>                sh &#x27;printenv&#x27;<br>           &#125;<br>       &#125;<br>	 &#125;<br>       stage(&#x27;TagInfo&#x27;) &#123;      #  第二阶段git信息配置<br>            steps &#123;<br>                checkout([$class: &#x27;GitSCM&#x27;, <br>                          branches: [[name: &quot;$&#123;params.TAG&#125;&quot;]], <br>                          doGenerateSubmoduleConfigurations: false, <br>                          extensions: [], <br>                          gitTool: &#x27;Default&#x27;, <br>                          submoduleCfg: [], <br>                          userRemoteConfigs: [[url: &#x27;git@gitlab.test.com:web/test/microeccbiz.git&#x27;]]<br>                        ])<br>            &#125;<br>        &#125;<br>       stage(&#x27;Clone Code&#x27;)&#123;    # 第三阶段 clone代码<br>	      steps &#123;<br>             git &#x27;git@gitlab.test.com:web/test/microeccbiz.git&#x27;<br>			 updateGitlabCommitStatus(name: env.STAGE_NAME, state: &#x27;success&#x27;)<br>                script&#123;<br>                    env.BUILD_TASKS = env.STAGE_NAME + &quot;√...&quot; + env.TAB_STR<br>                 &#125;<br>              &#125;<br>           &#125;<br><br>       stage(&#x27;Code Build&#x27;)&#123;   # 第四阶段 构建代码<br>	      steps &#123;<br>             retry(2) &#123; sh &quot;make build&quot; &#125;<br>			 updateGitlabCommitStatus(name: env.STAGE_NAME, state: &#x27;success&#x27;)<br>               script&#123;<br>                  env.BUILD_TASKS += env.STAGE_NAME + &quot;√...&quot; + env.TAB_STR<br>                &#125;<br>             &#125;  <br>         &#125;<br>       stage(&#x27;Quality Scanning&#x27;)&#123;   # 第五阶段 代码质量扫描<br>	      steps &#123;<br>             echo &quot;sonarqube&quot;   # 此处未定义，需要自行定义<br>			 updateGitlabCommitStatus(name: env.STAGE_NAME, state: &#x27;success&#x27;)<br>                script&#123;<br>                    env.BUILD_TASKS += env.STAGE_NAME + &quot;√...&quot; + env.TAB_STR<br>                &#125;<br>             &#125;<br>         &#125;<br>       <br>       stage(&#x27;Docker Build&#x27;)&#123;     # 第六阶段 docker构建<br>          steps &#123;<br>              script &#123;<br>                  PROJECT=&quot;项目名称&quot;<br>                  envTag=&quot;$&#123;env.gitlabBranch&#125;&quot;<br>                  result = sh(script: &quot;basename $&#123;envTag&#125;&quot;, returnStdout: true).trim()<br>                  DOCKER_TAG = &quot;$&#123;result&#125;&quot;<br>                  matcher = &#x27;(^v[0-9]&#123;1&#125;.[0-9]&#123;1,2&#125;.[0-9]&#123;1,2&#125;)$&#x27;     # 正则匹配<br>                  matcherAlpha = &#x27;(^v[0-9]&#123;1&#125;.[0-9]&#123;1,2&#125;.[0-9]&#123;1,2&#125;-alpha[0-9]&#123;0,2&#125;)$&#x27;<br>                  matcherBeta = &#x27;(^v[0-9]&#123;1&#125;.[0-9]&#123;1,2&#125;.[0-9]&#123;1,2&#125;-beta[0-9]&#123;0,2&#125;)$&#x27;<br>				  matcherTest = &#x27;(^v[0-9]&#123;1&#125;.[0-9]&#123;1,2&#125;.[0-9]&#123;1,2&#125;-test[0-9]&#123;0,2&#125;)$&#x27;<br>                  if (&quot;$&#123;DOCKER_TAG&#125;&quot;=~&quot;$&#123;matcherAlpha&#125;&quot;)&#123;    # if判断是否为相对应的tag，然后去打不同的tag<br>                      echo &quot;tag is alpha&quot;<br>                      DOCKER_TAG=&quot;$&#123;DOCKER_TAG&#125;&quot;<br>                      DOCKER_TARGET=&quot;hub.test.com/alpha/$&#123;PROJECT&#125;&quot;<br>                      return<br>                  &#125;else if (&quot;$&#123;DOCKER_TAG&#125;&quot;=~&quot;$&#123;matcherBeta&#125;&quot;)&#123;<br>                      echo &quot;tag is beta&quot;<br>                      DOCKER_TAG=&quot;$&#123;DOCKER_TAG&#125;&quot;<br>                      DOCKER_TARGET=&quot;hub.test.com/beta/$&#123;PROJECT&#125;&quot;<br>                      return<br>                  &#125;else if(&quot;$&#123;DOCKER_TAG&#125;&quot;=~&quot;$&#123;matcher&#125;&quot;)&#123;<br>                    echo &quot;master tag&quot;<br>                    DOCKER_TAG=&quot;$&#123;DOCKER_TAG&#125;&quot;<br>                    //DOCKER_TARGET=&quot;hub.test.com/version/$&#123;PROJECT&#125;&quot;<br>                    DOCKER_TARGET=&quot;registry.cn-guangzhou.aliyuncs.com/test/$&#123;PROJECT&#125;&quot;<br>                    return<br>				  &#125;else if(&quot;$&#123;DOCKER_TAG&#125;&quot;=~&quot;$&#123;matcherTest&#125;&quot;)&#123;<br>                    echo &quot;master tag&quot;<br>                    DOCKER_TAG=&quot;$&#123;DOCKER_TAG&#125;&quot;<br>                    DOCKER_TARGET=&quot;registry.cn-guangzhou.aliyuncs.com/test/$&#123;PROJECT&#125;&quot;<br>                    return<br>                 &#125;else&#123;<br>                     echo &quot;git tag error&quot;<br>                     return<br>                 &#125;<br>              &#125;<br>              retry(2)&#123;<br>                  sh &quot;make docker-build DOCKER_TARGET=&#x27;$&#123;DOCKER_TARGET&#125;&#x27; DOCKER_TAG=&#x27;$&#123;DOCKER_TAG&#125;&#x27; GITLAB_USER=test GITLAB_TOKEN=token&quot;<br>              &#125;<br>			  updateGitlabCommitStatus(name: env.STAGE_NAME, state: &#x27;success&#x27;)<br>                script&#123;<br>                    env.BUILD_TASKS += env.STAGE_NAME + &quot;√...&quot; + env.TAB_STR<br>                &#125;<br>             &#125;<br>         &#125;<br>   	   stage(&#x27;Push Image&#x27;)&#123;   # 第七阶段 push镜像 <br>   	       <br>              steps &#123;<br>                script&#123;<br>                    if(&quot;$&#123;DOCKER_TAG&#125;&quot;=~&quot;$&#123;matcher&#125;&quot;||&quot;$&#123;DOCKER_TAG&#125;&quot;=~&quot;$&#123;matcherTest&#125;&quot;)&#123;<br>                        echo &quot;push cloud Ali&quot;<br>                        withCredentials([usernamePassword(credentialsId: &#x27;aliyunimages&#x27;, passwordVariable: &#x27;password&#x27;, usernameVariable: &#x27;username&#x27;)]) &#123;<br>             	        retry(2) &#123; sh &quot;docker login -u $&#123;username&#125; -p $&#123;password&#125; registry.cn-qingdao.aliyuncs.com &amp;&amp; make docker-release DOCKER_TARGET=$&#123;DOCKER_TARGET&#125; DOCKER_TAG=$&#123;DOCKER_TAG&#125;&quot; &#125;<br>             	        &#125;<br>            			updateGitlabCommitStatus(name: env.STAGE_NAME, state: &#x27;success&#x27;)<br>                            script&#123;<br>                                env.BUILD_TASKS += env.STAGE_NAME + &quot;√...&quot; + env.TAB_STR<br>                            &#125;                   <br>                    &#125;else if (&quot;$&#123;DOCKER_TAG&#125;&quot;=~&quot;alpha&quot;||&quot;$&#123;DOCKER_TAG&#125;&quot;=~&quot;beta&quot;)&#123;<br>                        echo &quot;push local&quot;<br>                        withCredentials([usernamePassword(credentialsId: &#x27;hub&#x27;, passwordVariable: &#x27;password&#x27;, usernameVariable: &#x27;username&#x27;)]) &#123;<br>         	            retry(2) &#123; sh &quot;docker login -u $&#123;username&#125; -p $&#123;password&#125; $&#123;HOST&#125; &amp;&amp; make docker-release DOCKER_TARGET=$&#123;DOCKER_TARGET&#125; DOCKER_TAG=$&#123;DOCKER_TAG&#125;&quot; &#125;<br>         	             &#125;<br>    			        updateGitlabCommitStatus(name: env.STAGE_NAME, state: &#x27;success&#x27;)<br>                        script&#123;<br>                            env.BUILD_TASKS += env.STAGE_NAME + &quot;√...&quot; + env.TAB_STR<br>                        &#125;<br>                    &#125;else&#123;<br>   	                    echo &quot;docker target is null&quot;<br>   	                &#125;<br>                &#125;<br>     	    &#125;<br>	     &#125;<br>	   stage(&#x27;Application Deploy&#x27;)&#123;   # 第八阶段  部署服务<br>          steps &#123;	   <br>             echo &quot;deployment&quot;<br> 	         script &#123;<br>                  if (&quot;$&#123;DOCKER_TAG&#125;&quot;=~&quot;$&#123;matcherAlpha&#125;&quot;)&#123;<br>                      echo &quot;deploy to develop server&quot;<br>                        projectId=&quot;c-ewrwfwf-vfwef&quot;<br>                        pnamespace=&quot;web&quot;<br>                        sh &quot;&quot;&quot;<br>                        curl -k -u &quot;token-s4xdt:zfwefgwgemm6dfwwhqvzljg7p5qqrf9sdfsfsfweerfdsgertwrfsdvsdfwe&quot; \<br>                        -X POST \<br>                        -H &#x27;Accept: application/json&#x27; \<br>                        -H &#x27;Content-Type: application/json&#x27; \<br>                        &#x27;https://10.7.0.211/v3/project/$&#123;projectId&#125;/workloads/deployment:$&#123;pnamespace&#125;:$&#123;PROJECT&#125;?action=redeploy&#x27;<br>                        &quot;&quot;&quot;<br>                      return<br>                  &#125;else if (&quot;$&#123;DOCKER_TAG&#125;&quot;=~&quot;$&#123;matcherBeta&#125;&quot;)&#123;<br>                      echo &quot;deploy to test server&quot;<br>                        projectId=&quot;c-werfwe-wrfsf&quot;<br>                        pnamespace=&quot;server&quot;<br>                        sh &quot;&quot;&quot;<br>                        curl -k -u &quot;token-s4xdt:zfwefgwgemm6dfwwhqvzljg7p5qqrf9sdfsfsfweerfdsgertwrfsdvsdfwer&quot; \<br>                        -X POST \<br>                        -H &#x27;Accept: application/json&#x27; \<br>                        -H &#x27;Content-Type: application/json&#x27; \<br>                        &#x27;https://10.7.0.211/v3/project/$&#123;projectId&#125;/workloads/deployment:$&#123;pnamespace&#125;:$&#123;PROJECT&#125;?action=redeploy&#x27;<br>                        &quot;&quot;&quot;<br>                      return<br>                  &#125;else&#123;<br>                    echo &quot;deploy failed&quot;<br>                    return<br>                 &#125;<br>              &#125;<br>			 updateGitlabCommitStatus(name: env.STAGE_NAME, state: &#x27;success&#x27;)<br>                script&#123;<br>                    env.BUILD_TASKS += env.STAGE_NAME + &quot;√...&quot; + env.TAB_STR<br>                &#125;<br> 	         &#125;<br>	     &#125;<br>    &#125;<br>    post &#123;    # 第九阶段  微信通知<br>       success &#123;<br>           echo &#x27;Congratulations!&#x27;<br>           sh &quot;&quot;&quot;<br>               curl &#x27;https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=fsfgerg3424sf-fdsf2-4e15-5342-fsfsffgr598c7ae&#x27; \<br>                   -H &#x27;Content-Type: application/json&#x27; \<br>                   -d &#x27;<br>                   &#123;<br>                      &quot;msgtype&quot;: &quot;text&quot;,<br>                      &quot;text&quot;: &#123;<br>                        &quot;content&quot;: &quot;😄👍构建成功👍😄\n 构建人：$&#123;gitlabUserName&#125; \n 项目名称: $&#123;PROJECT&#125;  \n 构建标签：$&#123;DOCKER_TAG&#125; \n 构建地址: $&#123;RUN_DISPLAY_URL&#125;&quot;<br>                      &#125;<br>                  &#125;&#x27;<br>            &quot;&quot;&quot;<br>        &#125;<br>       failure &#123;<br>            echo &#x27;Oh no!&#x27;<br>            sh &quot;&quot;&quot;<br>                curl &#x27;https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=32134fsffe-sdfsfsf-4e15-9705-be5e65fsadfs&#x27; \<br>                -H &#x27;Content-Type: application/json&#x27; \<br>                -d &#x27;<br>                 &#123;<br>                   &quot;msgtype&quot;: &quot;text&quot;,<br>                   &quot;text&quot;: &#123;<br>                       &quot;content&quot;: &quot;😖❌构建失败\n 构建人：$&#123;gitlabUserName&#125;\n 项目名称: $&#123;JOB_BASE_NAME&#125; \n 构建标签：$&#123;DOCKER_TAG&#125; \n 构建地址: $&#123;RUN_DISPLAY_URL&#125; &quot;<br>                    &#125;<br>                 &#125;&#x27;<br>            &quot;&quot;&quot;<br>        &#125;<br>        always &#123; <br>            echo &#x27;I will always say Hello again!&#x27;<br>        &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure></blockquote>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/09-%E8%B0%83%E8%AF%95%E6%B5%8B%E8%AF%95/" class="category-chain-item">09_调试测试</a>
  
  
    <span>></span>
    
  <a href="/categories/09-%E8%B0%83%E8%AF%95%E6%B5%8B%E8%AF%95/04-%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/" class="category-chain-item">04_自动部署</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Jenkins/">#Jenkins</a>
      
        <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/">#自动化部署</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>01-Jenkins自动化部署项目</div>
      <div>https://janycode.github.io/2019/09/07/09_调试测试/04_自动部署/01-Jenkins自动化部署项目/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Jerry(姜源)</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2019年9月7日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 姜源">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2019/09/08/09_%E8%B0%83%E8%AF%95%E6%B5%8B%E8%AF%95/04_%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/02-Docker+Jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" title="02-Docker+Jenkins持续集成">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">02-Docker+Jenkins持续集成</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2019/06/15/01_%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/05_Windows/02-hosts%E8%87%AA%E7%94%A8/" title="01-win批处理命令大全">
                        <span class="hidden-mobile">01-win批处理命令大全</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="SOHUCS" sid='https://janycode.github.io/2019/09/07/09_%E8%B0%83%E8%AF%95%E6%B5%8B%E8%AF%95/04_%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/01-Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/'></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#SOHUCS', function() {
      Fluid.utils.createScript("https://changyan.sohu.com/upload/changyan.js", function() {
        window.changyan.api.config({"appid":"cyw5OHIcO","appkey":"fea3446b3df4b3f129f34da4cbc87e51"})
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://simple.blog.csdn.net" target="_blank" rel="nofollow noopener"><span>CSDN</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/janycode" target="_blank" rel="nofollow noopener"><span>GitHub</span></a> <i class="iconfont icon-love"></i> <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量(PV) 
        <span id="busuanzi_value_site_pv"></span>
         次，
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数(UV) 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

<!-- live2d 动画 -->
<script src="https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js"></script>
<script>
    L2Dwidget.init({
        "model": {
            jsonPath: "https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json",
            "scale": 1
        },
        "display": {
            "position": "right",
            "width": 100,
            "height": 200,
            "hOffset": 35,
            "vOffset": -85
        },
        "mobile": {
            "show": false,
            "scale": 0.1
        },
        "react": {
            "opacityDefault": 0.75,
            "opacityOnHover": 0.2
        }
    });
</script>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <!-- Baidu Analytics -->
    <script defer>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?bfff735c897eb60ea49b735096b20e47";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  

  

  

  

  

  




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
