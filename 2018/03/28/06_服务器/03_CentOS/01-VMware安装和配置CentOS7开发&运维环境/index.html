

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Jerry(姜源)">
  <meta name="keywords" content="Java,Html,CSS,JavaScript,Python,C,Linux,shell编程经验分享、技术总结、心得体会">
  
    <meta name="description" content="Centos7 CentOS7在VMware上安装教程：https:&#x2F;&#x2F;blog.csdn.net&#x2F;HXBest&#x2F;article&#x2F;details&#x2F;123853738 CentOS7配置网络：https:&#x2F;&#x2F;blog.csdn.net&#x2F;feriman&#x2F;article&#x2F;details&#x2F;121068882 CentOS7配置yum镜像：https:&#x2F;&#x2F;blog.csdn.net&#x2F;m0_64787068&#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="01-VMware安装和配置CentOS7开发&amp;运维环境">
<meta property="og:url" content="https://janycode.github.io/2018/03/28/06_%E6%9C%8D%E5%8A%A1%E5%99%A8/03_CentOS/01-VMware%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AECentOS7%E5%BC%80%E5%8F%91&%E8%BF%90%E7%BB%B4%E7%8E%AF%E5%A2%83/index.html">
<meta property="og:site_name" content="姜源の云笔记">
<meta property="og:description" content="Centos7 CentOS7在VMware上安装教程：https:&#x2F;&#x2F;blog.csdn.net&#x2F;HXBest&#x2F;article&#x2F;details&#x2F;123853738 CentOS7配置网络：https:&#x2F;&#x2F;blog.csdn.net&#x2F;feriman&#x2F;article&#x2F;details&#x2F;121068882 CentOS7配置yum镜像：https:&#x2F;&#x2F;blog.csdn.net&#x2F;m0_64787068&#x2F;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20250411085338.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20250506152217.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20250506152317.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20250506152407.png">
<meta property="og:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20250508112555.png">
<meta property="article:published_time" content="2018-03-28T15:06:42.000Z">
<meta property="article:modified_time" content="2025-08-22T01:28:21.427Z">
<meta property="article:author" content="Jerry(姜源)">
<meta property="article:tag" content="CentOS">
<meta property="article:tag" content="服务器">
<meta property="article:tag" content="虚拟机">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20250411085338.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>01-VMware安装和配置CentOS7开发&amp;运维环境 - 姜源の云笔记</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"janycode.github.io","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":50,"cursorChar":"|","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":false},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"bfff735c897eb60ea49b735096b20e47","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 50vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>姜源の云笔记</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tools/">
                <i class="iconfont icon-slack-fill"></i>
                工具
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" target="_blank" rel="noopener" href="https://yuancodes.github.io/">
                <i class="iconfont icon-notebook"></i>
                Docsify
              </a>
            </li>
          
        
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="01-VMware安装和配置CentOS7开发&amp;运维环境"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Jerry(姜源)
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2018-03-28 23:06" pubdate>
          星期三, 2018/03/28 23:06:42
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          32k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          271 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">01-VMware安装和配置CentOS7开发&amp;运维环境</h1>
            
            <div class="markdown-body">
              
              <h2 id="Centos7"><a href="#Centos7" class="headerlink" title="Centos7"></a>Centos7</h2><ul>
<li>CentOS7在VMware上安装教程：<a target="_blank" rel="noopener" href="https://blog.csdn.net/HXBest/article/details/123853738">https://blog.csdn.net/HXBest/article/details/123853738</a></li>
<li>CentOS7配置网络：<a target="_blank" rel="noopener" href="https://blog.csdn.net/feriman/article/details/121068882">https://blog.csdn.net/feriman/article/details/121068882</a></li>
<li>CentOS7配置yum镜像：<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_64787068/article/details/140157410">https://blog.csdn.net/m0_64787068/article/details/140157410</a></li>
<li>CentOS7配置ssh：<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/lza20001103/article/details/144874625">https://blog.csdn.net/lza20001103/article/details/144874625</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42073364/article/details/121395224">https://blog.csdn.net/qq_42073364/article/details/121395224</a></li>
</ul>
</li>
</ul>
<h2 id="jdk多版本"><a href="#jdk多版本" class="headerlink" title="jdk多版本"></a>jdk多版本</h2><ul>
<li><p>JDK多版本共存和切换：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_48803304/article/details/107296245">https://blog.csdn.net/weixin_48803304/article/details/107296245</a></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vim">yum install java-<span class="hljs-number">1.8</span>.<span class="hljs-number">0</span>-openjdk.x86_64<br>yum install java-<span class="hljs-number">11</span>-openjdk<br>java -<span class="hljs-keyword">version</span><br>#更改默认java版本<br>sudo alternatives --config java<br>#设置java环境变量<br><span class="hljs-keyword">vi</span> /etc/<span class="hljs-keyword">profile</span>.d/java.<span class="hljs-keyword">sh</span><br>添加<span class="hljs-number">1</span>行: JAVA_HOME=<span class="hljs-string">&quot;/usr/lib/jvm/java-11-openjdk&quot;</span><br><span class="hljs-keyword">source</span> /etc/<span class="hljs-keyword">profile</span>.d/java.<span class="hljs-keyword">sh</span><br><span class="hljs-keyword">echo</span> $JAVA_HOME<br></code></pre></td></tr></table></figure>

<p>Maven仓库的安装与配置：<a target="_blank" rel="noopener" href="https://blog.csdn.net/dontYouWorry/article/details/128934720">https://blog.csdn.net/dontYouWorry/article/details/128934720</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#如果按上述方法安装了jdk后，jps -v命令提示找不到，则需要执行如下命令：</span><br>yum install -y java-1.8.0-openjdk-devel.x86_64<br><span class="hljs-comment">#然后jps -v 可以执行了。</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Jenkins持续交付"><a href="#Jenkins持续交付" class="headerlink" title="Jenkins持续交付"></a>Jenkins持续交付</h2><ul>
<li><p>jenkins清华大学镜像站：<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/">https://mirrors.tuna.tsinghua.edu.cn/jenkins/</a></p>
</li>
<li><p>jenkins各版本下载：<a target="_blank" rel="noopener" href="https://get.jenkins.io/war-stable/">https://get.jenkins.io/war-stable/</a></p>
</li>
<li><p>jenkins两个插件下载源替换：<a target="_blank" rel="noopener" href="https://blog.csdn.net/winerpro/article/details/143240901">https://blog.csdn.net/winerpro/article/details/143240901</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://mirror.esuni.jp/jenkins//updates/update-center.json">http://mirror.esuni.jp/jenkins//updates/update-center.json</a></li>
<li><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</a></li>
</ul>
</li>
<li><p>jenkins安装基于jdk17的2.452.3版本：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34752204/article/details/142252963">https://blog.csdn.net/weixin_34752204/article/details/142252963</a></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//g</span>et.jenkins.io<span class="hljs-regexp">/war-stable/</span><span class="hljs-number">2.452</span>.<span class="hljs-number">3</span>/jenkins.war<br></code></pre></td></tr></table></figure>

<p>jdk17的安装与注册到多版本切换：<a target="_blank" rel="noopener" href="https://blog.csdn.net/ChennyWJS/article/details/131979094">https://blog.csdn.net/ChennyWJS/article/details/131979094</a></p>
</li>
<li><p>jenkins安装后Manage jenkins中提示糟糕的问题：</p>
<ul>
<li>Dashboard &gt; Manage Jenkins &gt; Security &gt; 隐藏的安全警告(全部关闭就好了)</li>
<li>Dashboard &gt; Manage Jenkins &gt; System &gt; 管理监控配置(全部关闭就好了)</li>
</ul>
</li>
<li><p>jenkins中默认json配置替换：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /root/.jenkins/updates<br>sed -i <span class="hljs-string">&#x27;s/https:\/\/updates.jenkins.io\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g&#x27;</span> default.json &amp;&amp; sed -i <span class="hljs-string">&#x27;s/https:\/\/www.google.com/https:\/\/www.baidu.com/g&#x27;</span> default.json<br></code></pre></td></tr></table></figure>
</li>
<li><p>Jenkins启动报错：AWT is not properly configured：<a target="_blank" rel="noopener" href="https://blog.csdn.net/jiangjun_dao519/article/details/125620237">https://blog.csdn.net/jiangjun_dao519/article/details/125620237</a></p>
</li>
<li><p>jenkins 流水线pipeline阶段视图插件：<code>Pipeline stage view</code></p>
</li>
<li><p>jenkins 流水线pipeline使用java8来进行编译（与环境变量不冲突）：<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_16213346/7611153">https://blog.51cto.com/u_16213346/7611153</a></p>
</li>
<li><p>jenkins 流水线pipeline脚本中读取当前构建人名字插件：<code>build user vars</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pipeline">stage(&#x27;开始发布通知&#x27;) &#123;<br>    steps &#123;<br>        sh &#x27;echo 开始发布通知&#x27;<br>        wrap([$class: &#x27;BuildUser&#x27;]) &#123;<br>        	script &#123;<br>        		BUILD_USER = &quot;$&#123;env.BUILD_USER&#125;&quot;<br>        	&#125;<br>        	sh &#x27;echo BUILD_USER=$&#123;BUILD_USER&#125;&#x27;<br>        	//必须要放到wrap作用域内使用<br>        	sh &#x27;ssh root@$&#123;ipAddress&#125; &quot;cd /root/ &amp;&amp; ./.push-start-msg.sh $&#123;releaseTerminal&#125; $&#123;packageEnv&#125; jar $&#123;BUILD_USER&#125;&quot;&#x27;<br>        &#125;<br>        sh &#x27;echo 开始发布通知完成&#x27;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


</li>
<li><p>Jenkins的pipeline参考示例：</p>
</li>
<li><p>后端：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs dart">pipeline &#123; <br>    agent any <br>    <br>    environment &#123;<br>        REPOSITORY=<span class="hljs-string">&quot;http://ip地址:6060/background/xxx.git&quot;</span><br>        def projectPath = <span class="hljs-string">&quot;/root/xxx-project&quot;</span><br>        def projectName = <span class="hljs-string">&quot;xxx&quot;</span><br>        def ipAddress = <span class="hljs-string">&quot;ip地址&quot;</span><br>        def releaseTerminal = <span class="hljs-string">&quot;xxx&quot;</span><br>        def packageEnv = <span class="hljs-string">&quot;test&quot;</span><br>    &#125;<br><br>    tools &#123;<br>        jdk <span class="hljs-string">&#x27;Java8&#x27;</span><br>    &#125;<br>    <br>    stages &#123;<br>        stage(<span class="hljs-string">&#x27;开始发布通知&#x27;</span>) &#123;<br>            steps &#123;<br>                println <span class="hljs-string">&quot;rollbackFlag=&quot;</span> + rollbackFlag<br>                script &#123;<br>                	<span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                        wrap([$<span class="hljs-class"><span class="hljs-keyword">class</span>: &#x27;<span class="hljs-title">BuildUser</span>&#x27;]) </span>&#123;<br>                        	script &#123;<br>                        		BUILD_USER = <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;env.BUILD_USER&#125;</span>&quot;</span><br>                    	    &#125;<br>                        	sh <span class="hljs-string">&#x27;echo BUILD_USER=<span class="hljs-subst">$&#123;BUILD_USER&#125;</span>&#x27;</span><br>                        	sh <span class="hljs-string">&#x27;echo 开始回滚通知&#x27;</span><br>                        	sh <span class="hljs-string">&#x27;/root/.push-start-msg.sh <span class="hljs-subst">$&#123;releaseTerminal&#125;</span> <span class="hljs-subst">$&#123;packageEnv&#125;</span> jar <span class="hljs-subst">$&#123;BUILD_USER&#125;</span> 回滚&#x27;</span><br>                        	sh <span class="hljs-string">&#x27;echo 开始回滚通知完成&#x27;</span><br>                        &#125;<br>                	&#125; <span class="hljs-keyword">else</span> &#123;<br>                	     wrap([$<span class="hljs-class"><span class="hljs-keyword">class</span>: &#x27;<span class="hljs-title">BuildUser</span>&#x27;]) </span>&#123;<br>                        	script &#123;<br>                        		BUILD_USER = <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;env.BUILD_USER&#125;</span>&quot;</span><br>                    	    &#125;<br>                    	    sh <span class="hljs-string">&#x27;echo BUILD_USER=<span class="hljs-subst">$&#123;BUILD_USER&#125;</span>&#x27;</span><br>                        	sh <span class="hljs-string">&#x27;echo 开始发布通知&#x27;</span><br>                        	sh <span class="hljs-string">&#x27;/root/.push-start-msg.sh <span class="hljs-subst">$&#123;releaseTerminal&#125;</span> <span class="hljs-subst">$&#123;packageEnv&#125;</span> jar <span class="hljs-subst">$&#123;BUILD_USER&#125;</span> 发布&#x27;</span><br>                        	sh <span class="hljs-string">&#x27;echo 开始发布通知完成&#x27;</span><br>                	    &#125;<br>                	&#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>        stage(<span class="hljs-string">&#x27;拉取代码&#x27;</span>) &#123; <br>            steps &#123;<br>                script &#123;<br>                    <span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                        sh <span class="hljs-string">&#x27;echo 回滚操作，跳过拉取代码&#x27;</span><br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        sh <span class="hljs-string">&#x27;echo 拉取代码&#x27;</span><br>                        sh <span class="hljs-string">&#x27;echo pull-<span class="hljs-subst">$&#123;packageEnv&#125;</span>-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>&#x27;</span><br>                        sh <span class="hljs-string">&#x27;cd <span class="hljs-subst">$&#123;projectPath&#125;</span>/<span class="hljs-subst">$&#123;projectName&#125;</span> &amp;&amp; git checkout <span class="hljs-subst">$&#123;packageEnv&#125;</span> &amp;&amp; git pull &amp;&amp; <span class="hljs-subst">$&#123;projectPath&#125;</span>/pull-gitlog.sh <span class="hljs-subst">$&#123;releaseTerminal&#125;</span> <span class="hljs-subst">$&#123;packageEnv&#125;</span> jar&#x27;</span><br>                        sh <span class="hljs-string">&#x27;echo 拉取代码完成&#x27;</span>                        <br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>        stage(<span class="hljs-string">&#x27;项目编译&#x27;</span>) &#123; <br>            steps &#123; <br>                script &#123;<br>                    <span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                        sh <span class="hljs-string">&#x27;echo 回滚操作，跳过项目编译&#x27;</span><br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        sh <span class="hljs-string">&#x27;echo 项目编译&#x27;</span> <br>                        sh <span class="hljs-string">&#x27;echo package-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>&#x27;</span><br>                        sh <span class="hljs-string">&#x27;cd <span class="hljs-subst">$&#123;projectPath&#125;</span>/<span class="hljs-subst">$&#123;projectName&#125;</span> &amp;&amp; mvn clean package --settings /root/maven/jiechu-settings.xml -Dmaven.test.skip=true&#x27;</span><br>                        sh <span class="hljs-string">&#x27;echo 项目编译完成&#x27;</span><br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>        stage(<span class="hljs-string">&#x27;远程拷贝&#x27;</span>)&#123;<br>            steps &#123;<br>                script &#123;<br>                    println <span class="hljs-string">&quot;rollbackFlag=&quot;</span> + rollbackFlag<br>                    <span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                        sh <span class="hljs-string">&#x27;echo 回滚操作，跳过远程拷贝&#x27;</span><br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        sh <span class="hljs-string">&#x27;echo 远程拷贝&#x27;</span><br>                        sh <span class="hljs-string">&#x27;echo copy-jar-to-<span class="hljs-subst">$&#123;packageEnv&#125;</span>-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>&#x27;</span><br>                        sh <span class="hljs-string">&#x27;time rsync -avzh <span class="hljs-subst">$&#123;projectPath&#125;</span>/<span class="hljs-subst">$&#123;projectName&#125;</span>/ruoyi-admin/target/xxx-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>-*.jar root@<span class="hljs-subst">$&#123;ipAddress&#125;</span>:/root/xxx-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>-<span class="hljs-subst">$&#123;packageEnv&#125;</span>/jars&#x27;</span><br>                        sh <span class="hljs-string">&#x27;echo 远程拷贝完成&#x27;</span><br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>        stage(<span class="hljs-string">&#x27;启动服务&#x27;</span>) &#123;<br>            steps &#123;<br>                script &#123;<br>                    println <span class="hljs-string">&quot;rollbackFlag=&quot;</span> + rollbackFlag<br>                    <span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                        sh <span class="hljs-string">&#x27;echo 回滚操作，启动上一个jar包服务&#x27;</span><br>                        sh <span class="hljs-string">&#x27;ssh root@<span class="hljs-subst">$&#123;ipAddress&#125;</span> &quot;cd /root/xxx-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>-<span class="hljs-subst">$&#123;packageEnv&#125;</span> &amp;&amp; ./run-jars-rb.sh&quot;&#x27;</span><br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        sh <span class="hljs-string">&#x27;echo 启动服务&#x27;</span><br>                        sh <span class="hljs-string">&#x27;ssh root@<span class="hljs-subst">$&#123;ipAddress&#125;</span> &quot;cd /root/xxx-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>-<span class="hljs-subst">$&#123;packageEnv&#125;</span> &amp;&amp; ./run-jars.sh&quot;&#x27;</span><br>                    &#125;<br>                    sh <span class="hljs-string">&#x27;echo 启动日志&#x27;</span><br>                    sh <span class="hljs-string">&#x27;ssh root@<span class="hljs-subst">$&#123;ipAddress&#125;</span> &quot;cd /root/xxx-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>-<span class="hljs-subst">$&#123;packageEnv&#125;</span> &amp;&amp; ./startlog.sh <span class="hljs-subst">$&#123;releaseTerminal&#125;</span> <span class="hljs-subst">$&#123;packageEnv&#125;</span>&quot;&#x27;</span><br>                    sh <span class="hljs-string">&#x27;echo 启动服务成功&#x27;</span><br>                &#125;<br>            &#125;<br>        &#125;<br>        stage(<span class="hljs-string">&#x27;成功发布通知&#x27;</span>) &#123;<br>            steps &#123;<br>                println <span class="hljs-string">&quot;rollbackFlag=&quot;</span> + rollbackFlag<br>                script &#123;<br>                	<span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                        wrap([$<span class="hljs-class"><span class="hljs-keyword">class</span>: &#x27;<span class="hljs-title">BuildUser</span>&#x27;]) </span>&#123;<br>                        	script &#123;<br>                        		BUILD_USER = <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;env.BUILD_USER&#125;</span>&quot;</span><br>                        	&#125;<br>                    	    sh <span class="hljs-string">&#x27;echo BUILD_USER=<span class="hljs-subst">$&#123;BUILD_USER&#125;</span>&#x27;</span><br>                    	    sh <span class="hljs-string">&#x27;echo 成功回滚通知&#x27;</span><br>                    	    sh <span class="hljs-string">&#x27;/root/.push-success-msg.sh <span class="hljs-subst">$&#123;releaseTerminal&#125;</span> <span class="hljs-subst">$&#123;packageEnv&#125;</span> jar <span class="hljs-subst">$&#123;BUILD_USER&#125;</span> <span class="hljs-subst">$&#123;ipAddress&#125;</span> 回滚&#x27;</span><br>                    	    sh <span class="hljs-string">&#x27;echo 成功回滚通知完成&#x27;</span><br>                        &#125;<br>                	&#125; <span class="hljs-keyword">else</span> &#123;<br>                        wrap([$<span class="hljs-class"><span class="hljs-keyword">class</span>: &#x27;<span class="hljs-title">BuildUser</span>&#x27;]) </span>&#123;<br>                        	script &#123;<br>                        		BUILD_USER = <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;env.BUILD_USER&#125;</span>&quot;</span><br>                        	&#125;<br>                        	sh <span class="hljs-string">&#x27;echo BUILD_USER=<span class="hljs-subst">$&#123;BUILD_USER&#125;</span>&#x27;</span><br>                    	    sh <span class="hljs-string">&#x27;echo 成功发布通知&#x27;</span><br>                    	    sh <span class="hljs-string">&#x27;/root/.push-success-msg.sh <span class="hljs-subst">$&#123;releaseTerminal&#125;</span> <span class="hljs-subst">$&#123;packageEnv&#125;</span> jar <span class="hljs-subst">$&#123;BUILD_USER&#125;</span> <span class="hljs-subst">$&#123;ipAddress&#125;</span> 发布&#x27;</span><br>                    	    sh <span class="hljs-string">&#x27;echo 成功发布通知完成&#x27;</span><br>                        &#125;<br>                	&#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>前端：</p>
</li>
</ul>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs dart">  pipeline &#123; <br>      agent any <br>      <br>      environment &#123;<br>          REPOSITORY=<span class="hljs-string">&quot;http://ip地址:6060/front/xxx.git&quot;</span><br>          def projectPath = <span class="hljs-string">&quot;/root/xxx-project&quot;</span><br>  		def projectName = <span class="hljs-string">&quot;xxx&quot;</span><br>          def ipAddress = <span class="hljs-string">&quot;ip地址&quot;</span><br>          def releaseTerminal = <span class="hljs-string">&quot;h5&quot;</span><br>          def packageEnv = <span class="hljs-string">&quot;test&quot;</span><br>          def nodeVersion = <span class="hljs-string">&quot;18.16.0&quot;</span><br>      &#125;<br>      <br>      stages &#123;<br>          stage(<span class="hljs-string">&#x27;开始发布通知&#x27;</span>) &#123;<br>              steps &#123;<br>                  println <span class="hljs-string">&quot;rollbackFlag=&quot;</span> + rollbackFlag<br>                  script &#123;<br>                  	<span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                          wrap([$<span class="hljs-class"><span class="hljs-keyword">class</span>: &#x27;<span class="hljs-title">BuildUser</span>&#x27;]) </span>&#123;<br>                          	script &#123;<br>                          		BUILD_USER = <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;env.BUILD_USER&#125;</span>&quot;</span><br>                      	    &#125;<br>                          	sh <span class="hljs-string">&#x27;echo BUILD_USER=<span class="hljs-subst">$&#123;BUILD_USER&#125;</span>&#x27;</span><br>                          	sh <span class="hljs-string">&#x27;echo 开始回滚通知&#x27;</span><br>                          	sh <span class="hljs-string">&#x27;/root/.push-start-msg.sh <span class="hljs-subst">$&#123;releaseTerminal&#125;</span> <span class="hljs-subst">$&#123;packageEnv&#125;</span> front <span class="hljs-subst">$&#123;BUILD_USER&#125;</span> 回滚&#x27;</span><br>                          	sh <span class="hljs-string">&#x27;echo 开始回滚通知完成&#x27;</span><br>                          &#125;<br>                  	&#125; <span class="hljs-keyword">else</span> &#123;<br>                  	     wrap([$<span class="hljs-class"><span class="hljs-keyword">class</span>: &#x27;<span class="hljs-title">BuildUser</span>&#x27;]) </span>&#123;<br>                          	script &#123;<br>                          		BUILD_USER = <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;env.BUILD_USER&#125;</span>&quot;</span><br>                      	    &#125;<br>                      	    sh <span class="hljs-string">&#x27;echo BUILD_USER=<span class="hljs-subst">$&#123;BUILD_USER&#125;</span>&#x27;</span><br>                          	sh <span class="hljs-string">&#x27;echo 开始发布通知&#x27;</span><br>                          	sh <span class="hljs-string">&#x27;/root/.push-start-msg.sh <span class="hljs-subst">$&#123;releaseTerminal&#125;</span> <span class="hljs-subst">$&#123;packageEnv&#125;</span> front <span class="hljs-subst">$&#123;BUILD_USER&#125;</span> 发布&#x27;</span><br>                          	sh <span class="hljs-string">&#x27;echo 开始发布通知完成&#x27;</span><br>                  	    &#125;<br>                  	&#125;<br>                  &#125;<br>              &#125;<br>          &#125;<br>          stage(<span class="hljs-string">&#x27;拉取代码&#x27;</span>) &#123; <br>              steps &#123;<br>                  script &#123;<br>                      <span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                          sh <span class="hljs-string">&#x27;echo 回滚操作，跳过拉取代码&#x27;</span><br>                      &#125; <span class="hljs-keyword">else</span> &#123;<br>                          sh <span class="hljs-string">&#x27;echo 拉取代码&#x27;</span><br>                          sh <span class="hljs-string">&#x27;echo pull-<span class="hljs-subst">$&#123;packageEnv&#125;</span>-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>&#x27;</span><br>                          sh <span class="hljs-string">&#x27;cd <span class="hljs-subst">$&#123;projectPath&#125;</span>/<span class="hljs-subst">$&#123;projectName&#125;</span> &amp;&amp; git checkout <span class="hljs-subst">$&#123;packageEnv&#125;</span> &amp;&amp; git pull &amp;&amp; <span class="hljs-subst">$&#123;projectPath&#125;</span>/pull-gitlog.sh <span class="hljs-subst">$&#123;releaseTerminal&#125;</span> <span class="hljs-subst">$&#123;packageEnv&#125;</span> front&#x27;</span><br>                          sh <span class="hljs-string">&#x27;echo 拉取代码完成&#x27;</span>                        <br>                      &#125;<br>                  &#125;<br>              &#125;<br>          &#125;<br>          stage(<span class="hljs-string">&#x27;项目编译&#x27;</span>) &#123; <br>              steps &#123; <br>                  script &#123;<br>                      <span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                          sh <span class="hljs-string">&#x27;echo 回滚操作，跳过项目编译&#x27;</span><br>                      &#125; <span class="hljs-keyword">else</span> &#123;<br>                          sh <span class="hljs-string">&#x27;echo 项目编译&#x27;</span> <br>                          sh <span class="hljs-string">&#x27;echo 删除旧的dist包&#x27;</span><br>                          sh <span class="hljs-string">&#x27;cd <span class="hljs-subst">$&#123;projectPath&#125;</span>/<span class="hljs-subst">$&#123;projectName&#125;</span> &amp;&amp; rm ./dist -rf&#x27;</span><br>                          sh <span class="hljs-string">&#x27;echo 删除旧的dist包完成！&#x27;</span><br>                          sh <span class="hljs-string">&#x27;echo package-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>&#x27;</span><br>                          sh <span class="hljs-string">&#x27;. ~/.nvm/nvm.sh &amp;&amp; nvm use <span class="hljs-subst">$&#123;nodeVersion&#125;</span> &amp;&amp; cd <span class="hljs-subst">$&#123;projectPath&#125;</span>/<span class="hljs-subst">$&#123;projectName&#125;</span> &amp;&amp; npm cache clean --force &amp;&amp; npm pack --max-old-space-size=300 &amp;&amp; npm run testbuild&#x27;</span><br>                          sh <span class="hljs-string">&#x27;echo 项目编译完成&#x27;</span><br>                      &#125;<br>                  &#125;<br>              &#125;<br>          &#125;<br>          stage(<span class="hljs-string">&#x27;远程拷贝&#x27;</span>)&#123;<br>              steps &#123;<br>                  script &#123;<br>                      println <span class="hljs-string">&quot;rollbackFlag=&quot;</span> + rollbackFlag<br>                      <span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                          sh <span class="hljs-string">&#x27;echo 回滚操作，跳过远程拷贝&#x27;</span><br>                      &#125; <span class="hljs-keyword">else</span> &#123;<br>                          sh <span class="hljs-string">&#x27;echo 远程拷贝&#x27;</span><br>                          sh <span class="hljs-string">&#x27;echo copy-dist-to-<span class="hljs-subst">$&#123;packageEnv&#125;</span>-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>&#x27;</span><br>                          sh <span class="hljs-string">&#x27;ssh root@<span class="hljs-subst">$&#123;ipAddress&#125;</span> &quot;rm -rf /root/xxx-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>-<span class="hljs-subst">$&#123;packageEnv&#125;</span>/front/<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>/dist&quot;&#x27;</span><br>                          sh <span class="hljs-string">&#x27;time rsync -avzh <span class="hljs-subst">$&#123;projectPath&#125;</span>/<span class="hljs-subst">$&#123;projectName&#125;</span>/dist/build/<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>/* root@<span class="hljs-subst">$&#123;ipAddress&#125;</span>:/root/xxx-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>-<span class="hljs-subst">$&#123;packageEnv&#125;</span>/front/<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>/&#x27;</span><br>                          sh <span class="hljs-string">&#x27;echo 远程拷贝完成&#x27;</span><br>                      &#125;<br>                  &#125;<br>              &#125;<br>          &#125;<br>          stage(<span class="hljs-string">&#x27;部署页面&#x27;</span>) &#123;<br>              steps &#123;<br>                  script &#123;<br>                      println <span class="hljs-string">&quot;rollbackFlag=&quot;</span> + rollbackFlag<br>                      <span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                          sh <span class="hljs-string">&#x27;echo 回滚操作，部署上一个打包的静态页面&#x27;</span><br>                          sh <span class="hljs-string">&#x27;ssh root@<span class="hljs-subst">$&#123;ipAddress&#125;</span> &quot;cd /root/xxx-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>-<span class="hljs-subst">$&#123;packageEnv&#125;</span> &amp;&amp; ./run-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>-rb.sh&quot;&#x27;</span><br>                      &#125; <span class="hljs-keyword">else</span> &#123;<br>                          sh <span class="hljs-string">&#x27;echo 部署页面&#x27;</span><br>                          sh <span class="hljs-string">&#x27;ssh root@<span class="hljs-subst">$&#123;ipAddress&#125;</span> &quot;cd /root/xxx-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>-<span class="hljs-subst">$&#123;packageEnv&#125;</span> &amp;&amp; ./run-<span class="hljs-subst">$&#123;releaseTerminal&#125;</span>.sh&quot;&#x27;</span><br>                      &#125;<br>                      sh <span class="hljs-string">&#x27;echo 部署页面成功&#x27;</span><br>                  &#125;<br>              &#125;<br>          &#125;<br>          stage(<span class="hljs-string">&#x27;成功发布通知&#x27;</span>) &#123;<br>              steps &#123;<br>                  println <span class="hljs-string">&quot;rollbackFlag=&quot;</span> + rollbackFlag<br>                  script &#123;<br>                  	<span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                          wrap([$<span class="hljs-class"><span class="hljs-keyword">class</span>: &#x27;<span class="hljs-title">BuildUser</span>&#x27;]) </span>&#123;<br>                          	script &#123;<br>                          		BUILD_USER = <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;env.BUILD_USER&#125;</span>&quot;</span><br>                          	&#125;<br>                      	    sh <span class="hljs-string">&#x27;echo BUILD_USER=<span class="hljs-subst">$&#123;BUILD_USER&#125;</span>&#x27;</span><br>                      	    sh <span class="hljs-string">&#x27;echo 成功回滚通知&#x27;</span><br>                      	    sh <span class="hljs-string">&#x27;/root/.push-success-msg.sh <span class="hljs-subst">$&#123;releaseTerminal&#125;</span> <span class="hljs-subst">$&#123;packageEnv&#125;</span> front <span class="hljs-subst">$&#123;BUILD_USER&#125;</span> <span class="hljs-subst">$&#123;ipAddress&#125;</span> 回滚&#x27;</span><br>                      	    sh <span class="hljs-string">&#x27;echo 成功回滚通知完成&#x27;</span><br>                          &#125;<br>                  	&#125; <span class="hljs-keyword">else</span> &#123;<br>                          wrap([$<span class="hljs-class"><span class="hljs-keyword">class</span>: &#x27;<span class="hljs-title">BuildUser</span>&#x27;]) </span>&#123;<br>                          	script &#123;<br>                          		BUILD_USER = <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;env.BUILD_USER&#125;</span>&quot;</span><br>                          	&#125;<br>                          	sh <span class="hljs-string">&#x27;echo BUILD_USER=<span class="hljs-subst">$&#123;BUILD_USER&#125;</span>&#x27;</span><br>                      	    sh <span class="hljs-string">&#x27;echo 成功发布通知&#x27;</span><br>                      	    sh <span class="hljs-string">&#x27;/root/.push-success-msg.sh <span class="hljs-subst">$&#123;releaseTerminal&#125;</span> <span class="hljs-subst">$&#123;packageEnv&#125;</span> front <span class="hljs-subst">$&#123;BUILD_USER&#125;</span> <span class="hljs-subst">$&#123;ipAddress&#125;</span> 发布&#x27;</span><br>                      	    sh <span class="hljs-string">&#x27;echo 成功发布通知完成&#x27;</span><br>                          &#125;<br>                  	&#125;<br>                  &#125;<br>              &#125;<br>          &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>Jenkins账号权限设置：全局安全配置 - Authentication - 授权策略 - 安全矩阵 选择插件 <code>Role-based Authorization Strategy</code></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/YZL40514131/article/details/130143433">https://blog.csdn.net/YZL40514131/article/details/130143433</a></p>
</li>
<li><p>Java项目编译后的jar包瘦身数十倍（加快scp远程传输速度）：<a target="_blank" rel="noopener" href="https://blog.csdn.net/tangjieqing/article/details/144455182">https://blog.csdn.net/tangjieqing/article/details/144455182</a></p>
</li>
<li><p>服务器之间传输文件使用：rsync -avzh 效果是最好的，参考示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">time rsync -avzh xxx/target/*.jar root@ip:/root/xxx/jars<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="node多版本"><a href="#node多版本" class="headerlink" title="node多版本"></a>node多版本</h2><ul>
<li>安装nvm</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#安装nvm</span><br>curl -o- https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/nvm-sh/</span>nvm<span class="hljs-regexp">/v0.39.0/i</span>nstall.sh | bash<br>source ~/.bashrc<br>nvm -v<br>nvm list<br>nvm install <span class="hljs-number">18.16</span>.<span class="hljs-number">0</span><br>nvm use <span class="hljs-number">18.16</span>.<span class="hljs-number">0</span><br>node -v <span class="hljs-comment">#此时node为18.16.0</span><br><br>如果报错则需要升级make和gcc：参考如下方法<br></code></pre></td></tr></table></figure>

<ul>
<li><p>安装nvm管理node多版本：<a target="_blank" rel="noopener" href="https://blog.51cto.com/qiuyue/6260438">https://blog.51cto.com/qiuyue/6260438</a></p>
</li>
<li><p>比如我用的 node 16.15.1 和 18.16.0，通过 nvm list可以看到</p>
</li>
<li><p>安装nvm多版本管理后，jenkins中创建的任务可能看不到了，原因是因为中文编码问题。</p>
<ul>
<li>当时手动重新新建了pipeline以及做了如下中文设置才ok。<code>一定要先准备好环境再开始创建构建任务！</code></li>
</ul>
</li>
<li><p>npm镜像源加速：<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_52172586/article/details/142930356">https://blog.csdn.net/m0_52172586/article/details/142930356</a></p>
</li>
</ul>
<h3 id="一、Tomcat服务端编码修正"><a href="#一、Tomcat服务端编码修正" class="headerlink" title="一、Tomcat服务端编码修正"></a>一、Tomcat服务端编码修正</h3><ol>
<li><p>修改 <code>server.xml</code> 文件</p>
<ul>
<li>在Tomcat的 <code>conf/server.xml</code> 中找到 <code>&lt;Connector&gt;</code> 标签，添加 <code>URIEncoding=&quot;UTF-8&quot;</code> 参数：</li>
</ul>
</li>
</ol>
  <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;Connector <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;8080&quot;</span> <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;HTTP/1.1&quot;</span><br>           <span class="hljs-attribute">URIEncoding</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>  &lt;!-- 新增此行 --&gt;<br>           <span class="hljs-attribute">redirectPort</span>=<span class="hljs-string">&quot;8443&quot;</span> /&gt;<br></code></pre></td></tr></table></figure>

<p>   重启Tomcat生效<a target="_blank" rel="noopener" href="https://blog.csdn.net/ppdouble/article/details/12784475">4</a>。</p>
<ol start="2">
<li><p>调整日志编码配置</p>
<ul>
<li>编辑 <code>conf/logging.properties</code> ，修改以下行：</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">java.util.logging.ConsoleHandler.encoding</span>  = UTF-<span class="hljs-number">8</span>  <span class="hljs-comment"># 原为GBK或其他编码则修改</span><br></code></pre></td></tr></table></figure>

<p>确保日志输出统一为UTF-8<a target="_blank" rel="noopener" href="https://blog.csdn.net/guodong2020/article/details/118516739">6</a><a target="_blank" rel="noopener" href="https://blog.csdn.net/a350301941/article/details/90148765">8</a>]。</p>
</li>
</ol>
<hr>
<h3 id="二、Jenkins全局编码设置"><a href="#二、Jenkins全局编码设置" class="headerlink" title="二、Jenkins全局编码设置"></a>二、Jenkins全局编码设置</h3><ol>
<li>修改JVM启动参数</li>
</ol>
<ul>
<li>在Tomcat的启动脚本（如 <code>bin/catalina.sh</code> ）中添加JVM编码参数： <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">JAVA_OPTS</span>=<span class="hljs-string">&quot;-Dfile.encoding=UTF-8  -Dsun.jnu.encoding=UTF-8&quot;</span>   # 添加此行<br></code></pre></td></tr></table></figure>
 重启Tomcat使配置生效。</li>
</ul>
<ol start="2">
<li><p>Jenkins系统环境变量配置</p>
<ul>
<li>进入Jenkins的 <code>Manage Jenkins → System Configuration → Global properties</code>，勾选 <strong>Environment variables</strong> 并添加：</li>
</ul>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-built_in">Key</span><span class="hljs-operator">:</span> <span class="hljs-variable">LANG</span>   <span class="hljs-built_in">Value</span><span class="hljs-operator">:</span> <span class="hljs-type">en_US</span><span class="hljs-operator">.</span><span class="hljs-variable">UTF</span><span class="hljs-operator">-</span><span class="hljs-number">8</span><br><span class="hljs-built_in">Key</span><span class="hljs-operator">:</span> <span class="hljs-type">LC_ALL</span> <span class="hljs-built_in">Value</span><span class="hljs-operator">:</span> <span class="hljs-type">en_US</span><span class="hljs-operator">.</span><span class="hljs-variable">UTF</span><span class="hljs-operator">-</span><span class="hljs-number">8</span><br></code></pre></td></tr></table></figure>

<p>此操作覆盖系统默认编码。</p>
</li>
</ol>
<hr>
<h3 id="三、构建脚本与日志输出修正"><a href="#三、构建脚本与日志输出修正" class="headerlink" title="三、构建脚本与日志输出修正"></a>三、构建脚本与日志输出修正</h3><ol>
<li><p>Shell脚本显式指定编码。在Jenkins的构建脚本（如 <code>Execute shell</code>）开头添加：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">LANG</span>=<span class="hljs-string">&quot;en_US.UTF-8&quot;</span><br><span class="hljs-built_in">export</span> <span class="hljs-attribute">LC_ALL</span>=<span class="hljs-string">&quot;en_US.UTF-8&quot;</span><br></code></pre></td></tr></table></figure></li>
</ol>
<p>确保子进程继承正确编码。</p>
<ol start="2">
<li><p>Maven&#x2F;Gradle项目配置。对于Java项目，在 <code>pom.xml</code> 或 <code>gradle.properties</code> 中设置：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># Maven</span><br><span class="hljs-section">&lt;project.build.sourceEncoding&gt;</span><span class="hljs-attribute">UTF</span>-<span class="hljs-number">8</span>&lt;/project.build.sourceEncoding&gt; <br><br><span class="hljs-comment"># Gradle</span><br><span class="hljs-attribute">systemProp</span>.file.encoding=UTF-<span class="hljs-number">8</span> <br></code></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="四、系统级语言环境检查"><a href="#四、系统级语言环境检查" class="headerlink" title="四、系统级语言环境检查"></a>四、系统级语言环境检查</h3><ol>
<li><p>验证系统编码。执行 <code>locale</code> 命令查看当前编码，若未启用UTF-8，修改 <code>/etc/locale.conf</code> ：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">LANG</span>=<span class="hljs-string">&quot;en_US.UTF-8&quot;</span><br><span class="hljs-attr">LC_ALL</span>=<span class="hljs-string">&quot;en_US.UTF-8&quot;</span><br></code></pre></td></tr></table></figure></li>
</ol>
<p>重启系统生效<a target="_blank" rel="noopener" href="https://blog.csdn.net/guodong2020/article/details/118516739">6</a>]。</p>
<ol start="2">
<li><p>安装完整语言包。确保系统已安装中文语言支持：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">yum</span> install glibc-common -y<br><span class="hljs-attribute">localedef</span> -c -f UTF-<span class="hljs-number">8</span> -i en_US en_US.UTF-<span class="hljs-number">8</span><br></code></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="五、浏览器与缓存处理"><a href="#五、浏览器与缓存处理" class="headerlink" title="五、浏览器与缓存处理"></a>五、浏览器与缓存处理</h3><ol>
<li>清除浏览器缓存。使用Chrome&#x2F;Firefox的隐身模式访问Jenkins，排除缓存干扰<a target="_blank" rel="noopener" href="https://blog.csdn.net/xiaoyang9988/article/details/84784573">9</a>]。</li>
<li>调整Jenkins界面编码。在 <code>Manage Jenkins → Configure System</code> 中，找到 <strong>Locale</strong> 配置项，强制设置为 <code>zh_CN.UTF-8</code> 并重启服务。</li>
</ol>
<hr>
<h3 id="附：验证步骤"><a href="#附：验证步骤" class="headerlink" title="附：验证步骤"></a>附：验证步骤</h3><ol>
<li><p>查看构建日志文件编码：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">file</span> -i Jenkins工作空间路径<span class="hljs-regexp">/builds/</span>*/log<br></code></pre></td></tr></table></figure>
</li>
<li><p>若输出 <code>charset=utf-8</code> 表示配置生效。</p>
</li>
</ol>
<hr>
<p>通过以上步骤，90%的中文乱码问题可解决。若仍存在问题，需检查应用程序自身是否强制指定了编码（如日志框架配置）。</p>
<h2 id="jumpserver堡垒机"><a href="#jumpserver堡垒机" class="headerlink" title="jumpserver堡垒机"></a>jumpserver堡垒机</h2><ul>
<li><p>验证版本：v4.7.0</p>
</li>
<li><p>一键部署安装：<a target="_blank" rel="noopener" href="https://blog.csdn.net/icanflyingg/article/details/121898008">https://blog.csdn.net/icanflyingg/article/details/121898008</a></p>
</li>
<li><p>版本列表：<a target="_blank" rel="noopener" href="https://github.com/jumpserver/jumpserver/releases">https://github.com/jumpserver/jumpserver/releases</a></p>
</li>
<li><p>重置管理员密码的解决方法：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/696246180">https://zhuanlan.zhihu.com/p/696246180</a></p>
</li>
<li><p>登陆提示“配置文件有问题无法登陆”：<a target="_blank" rel="noopener" href="https://bbs.fit2cloud.com/t/topic/1935">https://bbs.fit2cloud.com/t/topic/1935</a></p>
</li>
<li><p>jumpserver 用户列表和资产列表转移，使用列表导出导入功能：<a target="_blank" rel="noopener" href="https://kb.fit2cloud.com/?p=56">https://kb.fit2cloud.com/?p=56</a></p>
</li>
</ul>
<h2 id="Grafana-Prometheus监控搭建"><a href="#Grafana-Prometheus监控搭建" class="headerlink" title="Grafana+Prometheus监控搭建"></a>Grafana+Prometheus监控搭建</h2><ul>
<li><p>环境搭建和使用：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_31725371/article/details/114697770">https://blog.csdn.net/qq_31725371/article/details/114697770</a></p>
</li>
<li><p>prometheusv2.25.0-linux-amd64单独下载（实测迅雷最快）：<a target="_blank" rel="noopener" href="https://github.com/prometheus/prometheus/releases?page=17">https://github.com/prometheus/prometheus/releases?page=17</a></p>
</li>
<li><p>prometheus.yml配置参考：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">scrape_configs:</span><br>  <span class="hljs-comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;prometheus&#x27;</span><br>    <span class="hljs-comment"># metrics_path defaults to &#x27;/metrics&#x27;</span><br>    <span class="hljs-comment"># scheme defaults to &#x27;http&#x27;.</span><br>    <span class="hljs-attr">static_configs:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">&#x27;localhost:9003&#x27;</span>]<br><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;xxx-centos&#x27;</span><br>    <span class="hljs-attr">static_configs:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">&#x27;121.40.67.xxx:9100&#x27;</span>] <span class="hljs-comment"># 多个用,分开</span><br><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;xxx-manage&#x27;</span><br>    <span class="hljs-attr">scheme:</span> <span class="hljs-string">https</span>  <span class="hljs-comment"># 强制使用 HTTPS 协议 </span><br>    <span class="hljs-attr">tls_config:</span><br>      <span class="hljs-attr">insecure_skip_verify:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 跳过证书验证（可选）</span><br>    <span class="hljs-attr">metrics_path:</span> <span class="hljs-string">/webmanage/actuator/prometheus</span>   <span class="hljs-comment">#java项目指定这个路径 /actuator/prometheus</span><br>    <span class="hljs-attr">static_configs:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">&#x27;121.40.67.xxx:9088&#x27;</span>] <span class="hljs-comment"># 多个用,分开</span><br>    <span class="hljs-attr">relabel_configs:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">job</span>]       <span class="hljs-comment"># 从 job 名称提取值 </span><br>      <span class="hljs-attr">target_label:</span> <span class="hljs-string">application</span>  <span class="hljs-comment"># 映射到 application 标签 </span><br>      <span class="hljs-attr">replacement:</span> <span class="hljs-string">$1</span>            <span class="hljs-comment"># 直接替换 </span><br></code></pre></td></tr></table></figure>
</li>
<li><p>prometheus启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">./prometheus --config.file=prometheus.yml<br><span class="hljs-comment">#如果配置了systemctl，则可以命令启动</span><br>systemctl start prometheus<br>systemctl status prometheus<br>systemctl stop prometheus<br><span class="hljs-comment">#开机启动</span><br>systemctl <span class="hljs-built_in">enable</span> prometheus<br><span class="hljs-comment">#开机不启动</span><br>systemctl <span class="hljs-built_in">disable</span> prometheus<br></code></pre></td></tr></table></figure>


</li>
<li><p>grafana单独下载：<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/grafana/yum/rpm/Packages/grafana-7.4.3-1.x86_64.rpm">https://mirrors.tuna.tsinghua.edu.cn/grafana/yum/rpm/Packages/grafana-7.4.3-1.x86_64.rpm</a></p>
</li>
<li><p>grafana启动failed拯救：<a target="_blank" rel="noopener" href="https://blog.csdn.net/ximenjianxue/article/details/125200854">https://blog.csdn.net/ximenjianxue/article/details/125200854</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-built_in">nohup</span> /usr/sbin/grafana-server --config=/etc/grafana/grafana.ini --pidfile=/var/run/grafana/grafana-server.pid --homepath=/usr/share/grafana --packaging=rpm cfg:default.paths.logs=/var/log/grafana &gt; /tmp/grafana.log 2&gt;&amp;1 &amp;<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;$!&quot;</span> &gt; pid<br></code></pre></td></tr></table></figure>
</li>
<li><p>java springboot项目接入：</p>
</li>
<li><p>依赖添加。版本可以自动关联，不需要对应，比如springboot2.5.x对应是1.7.x会自动拉取：</p>
<ul>
<li>注意context-path，eg：<a target="_blank" rel="noopener" href="https://localhost:8080/webmanage/actuator/prometheus">https://localhost:8080/webmanage/actuator/prometheus</a></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml">  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.micrometer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>micrometer-registry-prometheus<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>配置添加。</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Spring配置</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-comment"># 服务名称</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">wangxiao-manage</span><br><br><span class="hljs-string">...</span><br><br><span class="hljs-comment">#grafana</span><br><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoint:</span><br>    <span class="hljs-attr">prometheus:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">web:</span><br>      <span class="hljs-attr">exposure:</span><br>        <span class="hljs-attr">include:</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">metrics:</span><br>    <span class="hljs-attr">export:</span><br>      <span class="hljs-attr">prometheus:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">tags:</span><br>      <span class="hljs-attr">application:</span> <span class="hljs-string">$&#123;spring.application.name&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>接口开放。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">SecurityConfig.configure(...) 方法中添加：<br><span class="hljs-comment">// prometheus监控</span><br>.antMatchers(<span class="hljs-string">&quot;/actuator/**&quot;</span>).permitAll()<br></code></pre></td></tr></table></figure>
</li>
<li><p>grafana dashboards官方可视化模版：<a target="_blank" rel="noopener" href="https://grafana.com/grafana/dashboards/">https://grafana.com/grafana/dashboards/</a></p>
</li>
<li><p>grafana dashboards常用模版推荐：<a target="_blank" rel="noopener" href="https://blog.csdn.net/sdhzdtwhm/article/details/135546426">https://blog.csdn.net/sdhzdtwhm/article/details/135546426</a></p>
<ul>
<li>java服务监控模版id：12856</li>
</ul>
</li>
<li><p>centos服务器主机监控模版id：12633</p>
</li>
<li><p>grafana 报警规则官方中文文档：<a target="_blank" rel="noopener" href="https://grafana.org.cn/docs/grafana/latest/alerting/fundamentals/alert-rules/">https://grafana.org.cn/docs/grafana/latest/alerting/fundamentals/alert-rules/</a></p>
</li>
</ul>
<h2 id="Sonar代码扫描-增量"><a href="#Sonar代码扫描-增量" class="headerlink" title="Sonar代码扫描-增量"></a>Sonar代码扫描-增量</h2><blockquote>
<p>在sonar中环境和版本配置比较重要</p>
<p>#在sonar现在的版本中已经不支持mysql了,推荐使用postsql</p>
<p>推荐sonar 9.9.4 java 17 postsql 15 </p>
</blockquote>
<ul>
<li><p>sonar10.4基于jdk17，下载sonar：<a target="_blank" rel="noopener" href="https://www.sonarsource.com/products/sonarqube/downloads/historical-downloads/">https://www.sonarsource.com/products/sonarqube/downloads/historical-downloads/</a></p>
</li>
<li><p>安装sonar：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wutou/p/17458707.html">https://www.cnblogs.com/wutou/p/17458707.html</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_50271247/article/details/119756146">https://blog.csdn.net/weixin_50271247/article/details/119756146</a></li>
</ul>
</li>
<li><p>sonar最全使用教程：<a target="_blank" rel="noopener" href="https://blog.csdn.net/tongfj/article/details/125751659">https://blog.csdn.net/tongfj/article/details/125751659</a></p>
</li>
<li><p>报错问题解决：</p>
<ul>
<li><p>发现sonar.log报错如下：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs subunit">INFO app[][o.s.a.SchedulerImpl] Waiting for Elasticsearch to be up and running<br><span class="hljs-keyword">ERROR </span>app[][o.e.c.RestHighLevelClient] Failed to parse info response<br>6 java.lang.IllegalStateException: Unsupported Content-Type: text/html;charset=UTF<span class="hljs-string">-8</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>发现es.log报错如下：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">ERROR </span>es[][o.e.b.Bootstrap] Exception<br>java.lang.RuntimeException: can not run elasticsearch as root<br></code></pre></td></tr></table></figure>
</li>
<li><p>原因：<code>因为elasticsearch强制要求非root用户才能启动</code>。</p>
</li>
<li><p>解决过程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建名为 sonar 的用户（可自定义名称）</span><br>useradd sonar <br><span class="hljs-comment"># 设置密码（可选），密码也是 sonar 需要输入两遍</span><br>passwd sonar <br><span class="hljs-comment"># 重命名了一下sonarqube目录</span><br><span class="hljs-built_in">mv</span> sonarqube-9.9.8.100196 sonarqube<br><span class="hljs-comment"># 替换为你的 SonarQube 实际路径 </span><br><span class="hljs-built_in">chown</span> -R sonar:sonar /opt/sonar/sonarqube<br><br>--- 如下步骤也作为重启的必要步骤 Begin ---<br><span class="hljs-comment"># 清理旧数据【关键步骤】：删除 Elasticsearch 的临时文件和锁文件</span><br><span class="hljs-built_in">rm</span> -rf /opt/sonar/sonarqube/temp/* &amp;&amp; <span class="hljs-built_in">rm</span> -rf /opt/sonar/sonarqube/data/es8/node.lock<br><span class="hljs-comment"># 切换到 sonar 用户，才能去启动 sonar</span><br>su - sonar<br><span class="hljs-comment"># 启动 SonarQube（需进入安装目录的 bin 目录）</span><br><span class="hljs-built_in">cd</span> /opt/sonar/sonarqube/bin/linux-x86-64<br>./sonar.sh start<br><span class="hljs-comment"># 或</span><br>./sonar.sh restart<br>--- 如上步骤也作为重启的必要步骤 End ---<br></code></pre></td></tr></table></figure>
</li>
<li><p>启动还是失败，发现es端口被占用了，日志es.log下：</p>
</li>
</ul>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">ERROR </span>es[][o.e.b.Bootstrap] Exception<br>   54 org.elasticsearch.http.BindHttpException: Failed to bind to 127.0.0.1:9001<br>Caused by: java.net.BindException: Address already in use<br></code></pre></td></tr></table></figure>

<ul>
<li><p>修改es默认端口号为 9200</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment">#vi /opt/sonar/sonarqube/elasticsearch/config/elasticsearch.yml</span><br><span class="hljs-attr">http.port:</span> <span class="hljs-number">9200</span><br></code></pre></td></tr></table></figure>

<p>同步修改sonar.properties中的es端口：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#vi /opt/sonar/sonarqube/conf/sonar.properties</span><br><span class="hljs-attr">sonar.search.port</span>=<span class="hljs-string">9200</span><br><span class="hljs-attr">sonar.web.port</span>=<span class="hljs-string">9000 #默认值根据情况修改</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>启动成功！</p>
</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">查看WEB界面 默认访问地址：http:<span class="hljs-regexp">//i</span>p:<span class="hljs-number">9000</span>，默认账号:admin  密码: admin<br>登录成功后会强制要求更改密码。<br></code></pre></td></tr></table></figure>
</li>
<li><p>汉化：</p>
</li>
</ul>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20250411085338.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>手动去下载汉化插件包:</p>
<p>打开页面：<a target="_blank" rel="noopener" href="https://github.com/SonarQubeCommunity/sonar-l10n-zh/releases/latest">https://github.com/SonarQubeCommunity/sonar-l10n-zh/releases/latest</a></p>
<p>下载对应 sonarqube 的版本，比如我的是 9.9 版本，下载地址为：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/xuhuisheng/</span>sonar-l10n-zh<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/sonar-l10n-zh-plugin-9.9/</span>sonar-l10n-zh-plugin-<span class="hljs-number">9.9</span>.jar<br></code></pre></td></tr></table></figure>

<p>将插件放置到这个 ~&#x2F;sonarqube&#x2F;extensions&#x2F;plugins 目录下，然后重启 sonar 服务。</p>
<blockquote>
<p>如果wget很慢的话，可以使用windows的迅雷下载后，ftp工具将jar包推送到服务器制定目录。</p>
</blockquote>
<ul>
<li><p>mvn扫描代码质量（参考方法二）：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1496871">https://cloud.tencent.com/developer/article/1496871</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#sonar令牌：</span><br>配置全局分析令牌: sqa_6c6e7c4f7cc5012b07df283ad05b5c619e31xxxx<br><span class="hljs-comment">#比如java项目，到java项目目录下运行该命令进行代码质量扫描</span><br>mvn sonar:sonar \<br>    -Dmaven.test.skip=<span class="hljs-literal">true</span> \<br>    -Dsonar.host.url=http://localhost:9000 \<br>    -Dsonar.login=sqa_6c6e7c4f7cc5012b07df283ad05b5c619e31xxxx \<br>    -Dsonar.java.binaries=target/sonar \<br>    -Dsonar.projectKey=project_a \    <span class="hljs-comment">#用于api接口请求时使用的projectKey</span><br>    -Dsonar.projectName=ProjectA \    <span class="hljs-comment">#显示在sonar的web界面的项目名</span><br>    -Dsonar.analysis.date=20xx-04-01<br><span class="hljs-comment">#    -Dsonar.branch.name=test</span><br><br><span class="hljs-comment">#eg: 真实例子</span><br>+ <span class="hljs-built_in">cd</span> /root/jiechu-project/wangxiao<br>+ mvn sonar:sonar -Dmaven.test.skip=<span class="hljs-literal">true</span> -Dsonar.host.url=http://localhost:9000 -Dsonar.login=sqa_6c6e7c4f7cc5012b07df283ad05b5c619e31xxxx -Dsonar.java.binaries=/root/jiechu-project/wangxiao/target/sonar -Dsonar.projectKey=wangxiao -Dsonar.projectName=wangxiao -Dsonar.analysis.date=2025-04-11<br></code></pre></td></tr></table></figure>
</li>
<li><p>如果要使用 -Dsonar.branch.name&#x3D;test 指定分支扫描指令，需要安装插件 Sonarqube Community Branch Plugin</p>
<ul>
<li><p>插件地址：<a target="_blank" rel="noopener" href="https://github.com/mc1arke/sonarqube-community-branch-plugin">https://github.com/mc1arke/sonarqube-community-branch-plugin</a></p>
</li>
<li><p>插件版本对应关系：sonar 9.9 对应插件版本 1.14.0</p>
</li>
<li><p>下载1.14.0 版本（迅雷下载本地ftp传上去，记得重启）：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/mc1arke/</span>sonarqube-community-branch-plugin<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/1.14.0/</span>sonarqube-community-branch-plugin-<span class="hljs-number">1.14</span>.<span class="hljs-number">0</span>.jar<br></code></pre></td></tr></table></figure>

<p><code>指定分支的效果没有验证成功，暂时保持以test为验证代码核心分支</code>。</p>
</li>
</ul>
</li>
<li><p>获取sonar扫描结果api：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs json">curl http<span class="hljs-punctuation">:</span><span class="hljs-comment">//182.92.171.35:9000/api/components/search?qualifiers=TRK&amp;q=wangxiao</span><br><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;paging&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;pageIndex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;pageSize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;total&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;components&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;com.ruoyi:ruoyi&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;wangxiao&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;qualifier&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;TRK&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;project&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;com.ruoyi:ruoyi&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><br><br>key 即为 projectKey<br><br>curl -s -u sqa_6c6e7c4f7cc5012b07df283ad05b5c619e31xxxx<span class="hljs-punctuation">:</span> http<span class="hljs-punctuation">:</span><span class="hljs-comment">//182.92.171.35:9000/api/qualitygates/project_status?projectKey=com.ruoyi:ruoyi</span><br><span class="hljs-comment">//返回通过的情况：</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;projectStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;OK&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;conditions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;OK&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;metricKey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;new_reliability_rating&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;comparator&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;GT&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;periodIndex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;errorThreshold&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;actualValue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;OK&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;metricKey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;new_security_rating&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;comparator&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;GT&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;periodIndex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;errorThreshold&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;actualValue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;OK&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;metricKey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;new_maintainability_rating&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;comparator&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;GT&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;periodIndex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;errorThreshold&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;actualValue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;periods&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;NUMBER_OF_DAYS&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2025-04-11T13:56:53+0800&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;parameter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;30&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;ignoredConditions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;period&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;NUMBER_OF_DAYS&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2025-04-11T13:56:53+0800&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;parameter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;30&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;caycStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;compliant&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-comment">//返回未通过的情况：</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;projectStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ERROR&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;conditions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ERROR&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;metricKey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;new_reliability_rating&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;comparator&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;GT&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;periodIndex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;errorThreshold&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;actualValue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ERROR&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;metricKey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;new_security_rating&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;comparator&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;GT&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;periodIndex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;errorThreshold&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;actualValue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;OK&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;metricKey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;new_maintainability_rating&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;comparator&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;GT&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;periodIndex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;errorThreshold&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;actualValue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ERROR&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;metricKey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;new_security_hotspots_reviewed&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;comparator&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;LT&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;periodIndex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;errorThreshold&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;100&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;actualValue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0.0&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;periods&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;PREVIOUS_VERSION&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2025-04-11T14:23:06+0800&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;ignoredConditions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;period&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;PREVIOUS_VERSION&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2025-04-11T14:23:06+0800&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;caycStatus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;compliant&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>加入jenkins pipeline中 groovy 语法的脚本：</p>
<ul>
<li>针对java后端项目</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs groovy">stage(<span class="hljs-string">&#x27;项目编译&#x27;</span>) &#123;...&#125; <span class="hljs-comment">//需要先进行项目编译才能去扫描</span><br>stage(<span class="hljs-string">&#x27;代码扫描&#x27;</span>) &#123;<br>    tools &#123; jdk <span class="hljs-string">&#x27;Java17&#x27;</span> &#125;<br>    steps &#123;<br>        script &#123;<br>            sh <span class="hljs-string">&#x27;java --version&#x27;</span><br>            <span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                sh <span class="hljs-string">&#x27;echo 回滚操作，跳过拉取代码&#x27;</span><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                sh <span class="hljs-string">&#x27;echo 代码扫描&#x27;</span><br>                <span class="hljs-comment">// git最近一次提交的文件</span><br>                <span class="hljs-keyword">def</span> changedFiles = sh(<span class="hljs-attr">script:</span> <span class="hljs-string">&quot;cd $&#123;projectPath&#125;/$&#123;projectName&#125; &amp;&amp; git diff --name-only HEAD~1 HEAD | xargs -I&#123;&#125; realpath &#123;&#125;&quot;</span>, <span class="hljs-attr">returnStdout:</span> <span class="hljs-literal">true</span>).trim()<br>                <span class="hljs-keyword">def</span> inclusions = changedFiles.replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>)<br>                <span class="hljs-comment">// 使用双引号让变量插值生效</span><br>                sh <span class="hljs-string">&quot;echo 本次Git提交增量的文件为：$&#123;inclusions&#125;&quot;</span><br>                sh <span class="hljs-string">&quot;cd $&#123;projectPath&#125;/$&#123;projectName&#125; &amp;&amp; mvn sonar:sonar -Dmaven.test.skip=true -Dsonar.host.url=http://localhost:9000 -Dsonar.login=sqa_6c6e7c4f7cc5012b07df283ad05b5c619e31cd11 -Dsonar.inclusions=$&#123;inclusions&#125; -Dsonar.java.binaries=$&#123;projectPath&#125;/$&#123;projectName&#125;/target/sonar -Dsonar.projectKey=$&#123;projectName&#125; -Dsonar.projectName=$&#123;projectName&#125; -Dsonar.analysis.date=2025-04-11&quot;</span><br>                sh <span class="hljs-string">&#x27;echo 代码扫描完成&#x27;</span><br>                sh <span class="hljs-string">&#x27;sleep 5&#x27;</span><br>                sh <span class="hljs-string">&#x27;echo 开始确认代码扫描结果&#x27;</span><br>                <span class="hljs-comment">// 执行命令并获取输出</span><br>                <span class="hljs-keyword">def</span> commandOutput = sh(<br>                    <span class="hljs-symbol">script:</span> <span class="hljs-string">&quot;curl -s -u sqa_6c6e7c4f7cc5012b07df283ad05b5c619e31cd11: http://localhost:9000/api/qualitygates/project_status?projectKey=$&#123;projectName&#125; | jq -r &#x27;.projectStatus.status&#x27;&quot;</span>,<br>                    <span class="hljs-symbol">returnStdout:</span> <span class="hljs-literal">true</span><br>                ).trim()<br>    <br>                <span class="hljs-comment">// 解析结果</span><br>                <span class="hljs-keyword">def</span> SCAN_RES = commandOutput<br>                sh <span class="hljs-string">&quot;echo 代码扫描结果：$&#123;SCAN_RES&#125;&quot;</span><br>                <br>                <span class="hljs-keyword">if</span> (SCAN_RES != <span class="hljs-string">&quot;OK&quot;</span>) &#123;<br>                    error <span class="hljs-string">&quot;代码质量扫描未通过，详情查看地址(账号:viewer 密码:jcjy123456)：http://182.92.171.35:9000/dashboard?id=$&#123;projectName&#125;&quot;</span> <br>                &#125;<br>                sh <span class="hljs-string">&#x27;echo 确认代码扫描结果通过&#x27;</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>针对vue前端项目，前端使用 sonar-scanner 工具进行扫描，命令使用方式类似java的 mvn。<br>补充说明：当前安装的sonarqube是9.9版本，对应sonar-scanner的版本是4.8，别问怎么知道，搜一下即可<br>下载地址：<a target="_blank" rel="noopener" href="https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.8.0.2856-linux.zip?_gl=1*m4ahcr*_gcl_au*MzExMzIzMTMyLjE3NDQxNzk4NDY.*_ga*MTM5MzI1NTIyNi4xNzQ0MTc5ODI1*_ga_9JZ0GZ5TC6*MTc0NDQyMTkwOS4yLjEuMTc0NDQyMjQ2OS42MC4wLjA.">sonar-scanner4.8-linux-x64.zip</a><br>环境变量：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vi /etc/profile</span><br><br><span class="hljs-comment">#sonar-scanner 对应自己的解压路径即可</span><br><span class="hljs-built_in">export</span> SONAR_SCANNER_HOME=/opt/sonar/sonar-scanner<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$SONAR_SCANNER_HOME</span>/bin<br><br><span class="hljs-comment"># source /etc/profile</span><br><br><span class="hljs-comment"># sonar-scanner --version</span><br>NFO: Scanner configuration file: /opt/sonar/sonar-scanner/conf/sonar-scanner.properties<br>INFO: Project root configuration file: NONE<br>INFO: SonarScanner 4.8.0.2856<br>INFO: Java 11.0.17 Eclipse Adoptium (64-bit)<br>INFO: Linux 3.10.0-1160.62.1.el7.x86_64 amd64<br></code></pre></td></tr></table></figure>

<p>  命令方式与mvn命令方式基本一致：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#sonar令牌：</span><br>配置全局分析令牌: sqa_6c6e7c4f7cc5012b07df283ad05b5c619e31xxxx<br><span class="hljs-comment">#比如java项目，到java项目目录下运行该命令进行代码质量扫描</span><br>sonar-scanner \<br>    -Dsonar.host.url=http://localhost:9000 \<br>    -Dsonar.login=sqa_6c6e7c4f7cc5012b07df283ad05b5c619e31xxxx \<br>    -Dsonar.sources=. \<br>    -Dsonar.projectKey=project_a \    <span class="hljs-comment">#用于api接口请求时使用的projectKey</span><br>    -Dsonar.projectName=ProjectA \    <span class="hljs-comment">#显示在sonar的web界面的项目名</span><br>    -Dsonar.analysis.date=20xx-04-01<br><span class="hljs-comment">#    -Dsonar.branch.name=test</span><br><br><span class="hljs-comment">#eg：真实例子</span><br>+ <span class="hljs-built_in">cd</span> /root/front-project/online-school-webmanage<br>+ /opt/sonar/sonar-scanner/bin/sonar-scanner -Dsonar.host.url=http://localhost:9000 -Dsonar.login=sqa_6c6e7c4f7cc5012b07df283ad05b5c619e31xxxx -Dsonar.sources=/root/front-project/online-school-webmanage/src -Dsonar.projectKey=online-school-webmanage -Dsonar.projectName=online-school-webmanage <span class="hljs-string">&#x27;-Dsonar.exclusions=/root/front-project/online-school-webmanage/node_modules/**,/root/front-project/online-school-webmanage/dist/**&#x27;</span> -Dsonar.language=js -Dsonar.javascript.file.suffixes=.vue,.js -Dsonar.analysis.date=2025-04-11<br></code></pre></td></tr></table></figure>

<p>  因此jenkins中的pipeline中的groovy脚本为：</p>
  <figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs groovy">stage(<span class="hljs-string">&#x27;项目编译&#x27;</span>) &#123;...&#125;<br>stage(<span class="hljs-string">&#x27;代码扫描&#x27;</span>) &#123;<br>    steps &#123;<br>        script &#123;<br>            <span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                sh <span class="hljs-string">&#x27;echo 回滚操作，跳过拉取代码&#x27;</span><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                sh <span class="hljs-string">&#x27;echo 代码扫描&#x27;</span><br>                sh <span class="hljs-string">&#x27;cd $&#123;projectPath&#125;/$&#123;projectName&#125; &amp;&amp; /opt/sonar/sonar-scanner/bin/sonar-scanner -Dsonar.host.url=http://localhost:9000 -Dsonar.login=sqa_6c6e7c4f7cc5012b07df283ad05b5c619e31cd11 -Dsonar.sources=$&#123;projectPath&#125;/$&#123;projectName&#125;/src -Dsonar.projectKey=online-school-webmanage -Dsonar.projectName=online-school-webmanage -Dsonar.exclusions=$&#123;projectPath&#125;/$&#123;projectName&#125;/node_modules/**,$&#123;projectPath&#125;/$&#123;projectName&#125;/dist/** -Dsonar.language=js -Dsonar.javascript.file.suffixes=.vue,.js -Dsonar.analysis.date=2025-04-11&#x27;</span><br>                sh <span class="hljs-string">&#x27;echo 代码扫描完成&#x27;</span><br>                sh <span class="hljs-string">&#x27;sleep 5&#x27;</span><br>                sh <span class="hljs-string">&#x27;echo 开始确认代码扫描结果&#x27;</span><br>                <span class="hljs-comment">// 执行命令并获取输出</span><br>                <span class="hljs-keyword">def</span> commandOutput = sh(<br>                    <span class="hljs-symbol">script:</span> <span class="hljs-string">&quot;curl -s -u sqa_6c6e7c4f7cc5012b07df283ad05b5c619e31cd11: http://localhost:9000/api/qualitygates/project_status?projectKey=$&#123;projectName&#125; | jq -r &#x27;.projectStatus.status&#x27;&quot;</span>,<br>                    <span class="hljs-symbol">returnStdout:</span> <span class="hljs-literal">true</span><br>                ).trim()<br>    <br>                <span class="hljs-comment">// 解析结果</span><br>                <span class="hljs-keyword">def</span> SCAN_RES = commandOutput<br>                sh <span class="hljs-string">&quot;echo 代码扫描结果：$&#123;SCAN_RES&#125;&quot;</span><br>                <br>                <span class="hljs-keyword">if</span> (SCAN_RES != <span class="hljs-string">&quot;OK&quot;</span>) &#123;<br>                    error <span class="hljs-string">&quot;代码质量扫描未通过，详情查看地址(账号:viewer 密码:jcjy123456)：http://182.92.171.35:9000/dashboard?id=$&#123;projectName&#125;&quot;</span> <br>                &#125;<br>                sh <span class="hljs-string">&#x27;echo 确认代码扫描结果通过&#x27;</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>按照git最新提交记录的增量式扫描配置如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs groovy">stage(<span class="hljs-string">&#x27;代码扫描&#x27;</span>) &#123;<br>     steps &#123;<br>         script &#123;<br>             <span class="hljs-keyword">if</span> (rollbackFlag == <span class="hljs-string">&quot;true&quot;</span>) &#123;<br>                 sh <span class="hljs-string">&#x27;echo 回滚操作，跳过拉取代码&#x27;</span><br>             &#125; <span class="hljs-keyword">else</span> &#123;<br>                 sh <span class="hljs-string">&#x27;echo 代码扫描&#x27;</span><br>                 <span class="hljs-comment">// git最近一次提交的文件</span><br>                 <span class="hljs-keyword">def</span> changedFiles = sh(<span class="hljs-attr">script:</span> <span class="hljs-string">&quot;cd $&#123;projectPath&#125;/$&#123;projectName&#125; &amp;&amp; git diff --name-only HEAD~1 HEAD | xargs -I&#123;&#125; realpath &#123;&#125;&quot;</span>, <span class="hljs-attr">returnStdout:</span> <span class="hljs-literal">true</span>).trim()<br>                 <span class="hljs-keyword">def</span> inclusions = changedFiles.replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>)<br>                 <span class="hljs-comment">// 使用双引号让变量插值生效</span><br>                 sh <span class="hljs-string">&quot;echo 本次Git提交增量的文件为：$&#123;inclusions&#125;&quot;</span><br>                 sh <span class="hljs-string">&quot;cd $&#123;projectPath&#125;/$&#123;projectName&#125; &amp;&amp; /opt/sonar/sonar-scanner/bin/sonar-scanner -Dsonar.host.url=http://localhost:9000 -Dsonar.login=sqa_6c6e7c4f7cc5012b07df283ad05b5c619e31cd11 -Dsonar.sources=$&#123;projectPath&#125;/$&#123;projectName&#125;/src -Dsonar.projectKey=$&#123;projectName&#125; -Dsonar.projectName=$&#123;projectName&#125; -Dsonar.inclusions=$&#123;inclusions&#125; -Dsonar.exclusions=$&#123;projectPath&#125;/$&#123;projectName&#125;/node_modules/**,$&#123;projectPath&#125;/$&#123;projectName&#125;/dist/** -Dsonar.language=js -Dsonar.javascript.file.suffixes=.vue,.js -Dsonar.analysis.date=2025-04-11&quot;</span><br>                 sh <span class="hljs-string">&#x27;echo 代码扫描完成&#x27;</span><br>                 sh <span class="hljs-string">&#x27;sleep 5&#x27;</span><br>                 sh <span class="hljs-string">&#x27;echo 开始确认代码扫描结果&#x27;</span><br>                 <span class="hljs-comment">// 执行命令并获取输出</span><br>                 <span class="hljs-keyword">def</span> commandOutput = sh(<br>                     <span class="hljs-symbol">script:</span> <span class="hljs-string">&quot;curl -s -u sqa_6c6e7c4f7cc5012b07df283ad05b5c619e31cd11: http://localhost:9000/api/qualitygates/project_status?projectKey=$&#123;projectName&#125; | jq -r &#x27;.projectStatus.status&#x27;&quot;</span>,<br>                     <span class="hljs-symbol">returnStdout:</span> <span class="hljs-literal">true</span><br>                 ).trim()<br>     <br>                 <span class="hljs-comment">// 解析结果</span><br>                 <span class="hljs-keyword">def</span> SCAN_RES = commandOutput<br>                 sh <span class="hljs-string">&quot;echo 代码扫描结果：$&#123;SCAN_RES&#125;&quot;</span><br>                 <br>                 <span class="hljs-keyword">if</span> (SCAN_RES != <span class="hljs-string">&quot;OK&quot;</span>) &#123;<br>                     error <span class="hljs-string">&quot;代码质量扫描未通过，详情查看地址(账号:viewer 密码:jcjy123456)：http://182.92.171.35:9000/dashboard?id=$&#123;projectName&#125;&quot;</span> <br>                 &#125;<br>                 sh <span class="hljs-string">&#x27;echo 确认代码扫描结果通过&#x27;</span><br>             &#125;<br>         &#125;<br>     &#125;<br> &#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="php环境"><a href="#php环境" class="headerlink" title="php环境"></a>php环境</h2><h3 id="一、起步操作"><a href="#一、起步操作" class="headerlink" title="一、起步操作"></a>一、起步操作</h3><p>查询系统版本、系统内核</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /etc/redhat-release<br><span class="hljs-built_in">cat</span> /proc/version<br></code></pre></td></tr></table></figure>

<h3 id="二、搭建Apache"><a href="#二、搭建Apache" class="headerlink" title="二、搭建Apache"></a>二、搭建Apache</h3><p>1.安装Apache</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install -y httpd<br></code></pre></td></tr></table></figure>

<p>2.启动Apache服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl start httpd.service<br>systemctl status httpd.service<br></code></pre></td></tr></table></figure>

<p>3.设置开机启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemclt <span class="hljs-built_in">enable</span> httpd.service<br></code></pre></td></tr></table></figure>

<p>4.开放防火墙的80端口（直接关闭防火墙在云服务器上打开安全组端口）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">firewall-cmd --zone=public --add-port=80/tcp --permanent<br>firewall-cmd --reload<br>firewall-cmd --list-ports<br></code></pre></td></tr></table></figure>

<p>5.Apache测试（在浏览器输入ip访问即可）</p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20250506152217.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="三、搭建Mysql"><a href="#三、搭建Mysql" class="headerlink" title="三、搭建Mysql"></a>三、搭建Mysql</h3><ol>
<li>Yum仓库下载mysql</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum localinstall https://repo.mysql.com//mysql80-community-release-el7-1.noarch.rpm<br></code></pre></td></tr></table></figure>

<p>2.Yum安装mysql</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install mysql-community-server<br></code></pre></td></tr></table></figure>

<p>3.启动mysql服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">service mysqld start<br>service mysqld status<br></code></pre></td></tr></table></figure>

<p>4.查看初始密码、设置mysql密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep <span class="hljs-string">&#x27;temporary password&#x27;</span> /var/log/mysqld.log<br>mysql -u root -p<br></code></pre></td></tr></table></figure>

<p>使用初始化密码登录后必须设置一个自己的密码，否则不能进行其他操作。设置密码的策略组是默认的必须包含大小写字符、数字、特殊字符且大于8位(可以通过修改密码策略等级来允许配置简单密码，这个自己bing吧)。</p>
<p>5.开放防火墙3306端口</p>
<p>6.登录mysql，进入mysql数据库设置允许远程访问</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">alter user <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> identified with mysql_native_password by <span class="hljs-string">&#x27;123456&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20250506152317.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="四、搭建Php"><a href="#四、搭建Php" class="headerlink" title="四、搭建Php"></a>四、搭建Php</h3><p>1.yum安装php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum -y install php<br></code></pre></td></tr></table></figure>

<p>2.重启Apache服务器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl restart httpd<br></code></pre></td></tr></table></figure>

<p>3.安装php的扩展，安装完成之后也需要重启Apache服务器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum -y install php-gd php-ldap php-odbc php-pear php-xml php-xmlrpc php-mbstring php-snmp php-soap curl curl-devel<br></code></pre></td></tr></table></figure>

<p>五、测试<br>1.在&#x2F;var&#x2F;www&#x2F;html目录下创建index.php文件，并在其中添加一下代码保存。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">phpinfo</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>2.使用浏览器访问ip，出现以下界面表示成功。</p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20250506152407.png" srcset="/img/loading.gif" lazyload alt="image-20250506152406379"></p>
<p>注：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /var/www/html<br><span class="hljs-built_in">ls</span> -la<br>chomd -R 777 ./					//修改文件夹权限<br></code></pre></td></tr></table></figure>



<p>php版本升级到7.3版本：<a target="_blank" rel="noopener" href="https://www.oryoy.com/news/centos-xi-tong-xia-sheng-ji-php-zhi-te-ding-ban-ben-hao-de-xiang-xi-bu-zhou-yu-zhu-yi-shi-xiang.html">https://www.oryoy.com/news/centos-xi-tong-xia-sheng-ji-php-zhi-te-ding-ban-ben-hao-de-xiang-xi-bu-zhou-yu-zhu-yi-shi-xiang.html</a></p>
<p><img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20250508112555.png" srcset="/img/loading.gif" lazyload alt="image-20250508112545232"></p>

              
            </div>
            <hr/>
            <div>
              <div>
  <img src="https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20241112163319.png" srcset="/img/loading.gif" lazyload>
</div>
<div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/06-%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="category-chain-item">06_服务器</a>
  
  
    <span>></span>
    
  <a href="/categories/06-%E6%9C%8D%E5%8A%A1%E5%99%A8/03-CentOS/" class="category-chain-item">03_CentOS</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/CentOS/">#CentOS</a>
      
        <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/">#服务器</a>
      
        <a href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/">#虚拟机</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>01-VMware安装和配置CentOS7开发&amp;运维环境</div>
      <div>https://janycode.github.io/2018/03/28/06_服务器/03_CentOS/01-VMware安装和配置CentOS7开发&amp;运维环境/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Jerry(姜源)</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2018年3月28日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 姜源">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2018/03/28/06_%E6%9C%8D%E5%8A%A1%E5%99%A8/02_Nginx/02-Nginx%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" title="02-Nginx 负载均衡">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">02-Nginx 负载均衡</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2018/03/28/06_%E6%9C%8D%E5%8A%A1%E5%99%A8/02_Nginx/01-Nginx%20%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/" title="01-Nginx 配置详解">
                        <span class="hidden-mobile">01-Nginx 配置详解</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="SOHUCS" sid='https://janycode.github.io/2018/03/28/06_%E6%9C%8D%E5%8A%A1%E5%99%A8/03_CentOS/01-VMware%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AECentOS7%E5%BC%80%E5%8F%91&amp;%E8%BF%90%E7%BB%B4%E7%8E%AF%E5%A2%83/'></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#SOHUCS', function() {
      Fluid.utils.createScript("https://changyan.sohu.com/upload/changyan.js", function() {
        window.changyan.api.config({"appid":"cyw5OHIcO","appkey":"fea3446b3df4b3f129f34da4cbc87e51"})
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://simple.blog.csdn.net" target="_blank" rel="nofollow noopener"><span>CSDN</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/janycode" target="_blank" rel="nofollow noopener"><span>GitHub</span></a> <i class="iconfont icon-love"></i> <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量(PV) 
        <span id="busuanzi_value_site_pv"></span>
         次，
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数(UV) 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

<!-- live2d 动画 -->
<script src="https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js"></script>
<script>
    L2Dwidget.init({
        "model": {
            jsonPath: "https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json",
            "scale": 1
        },
        "display": {
            "position": "right",
            "width": 100,
            "height": 200,
            "hOffset": 35,
            "vOffset": -85
        },
        "mobile": {
            "show": false,
            "scale": 0.1
        },
        "react": {
            "opacityDefault": 0.75,
            "opacityOnHover": 0.2
        }
    });
</script>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <!-- Baidu Analytics -->
    <script defer>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?bfff735c897eb60ea49b735096b20e47";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  

  

  

  

  

  




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
