---
title: 01-全栈项目搭建
date: 2023-9-28 21:36:21
tags:
- Vue
- SpringBoot
- 全栈
categories: 
- 17_项目设计
- 04_全栈项目设计
---



参考资料：

* 粒子库 particles CSS效果官网：https://particles.js.org/
* 蚂蚁地理空间数据可视化：https://l7.antv.antgroup.com/



> 技术栈：
>
> 前端：vue3 + vite4 + ElementPlus2
>
> 后端：jdk17 + Maven3.6.3 + SpringBoot2.7 + MyBatis + 蚂蚁地理空间数据可视化2.x

## 1. 前端架构搭建

### 1.1 创建项目

vite 创建项目：*npm create vite@4.4.0*

npm 安装依赖：*npm i*

npm 启动项目：*npm run dev*

App.vue

```vue
<template>
  <div>
    app
  </div>
</template>

<script setup>

</script>

<style>
*{
  margin: 0;
  padding: 0;
}
</style>
```

main.js

```js
import { createApp } from 'vue'
// import './style.css'           //注释掉全局默认样式
import App from './App.vue'

createApp(App).mount('#app')
```



### 1.2 目录结构

```txt
public/
src/
  assets/
  components/
  router/
    index.js
  views/
    xxx.vue
  App.vue
  main.js
  style.css
index.html
package-lock.json
package.json
README.md
vite.config.js
```



### 1.3 创建路由

安装路由：*npm i vue-router*

router/index.js - 创建路由并导出

```js
import { createRouter, createWebHashHistory } from 'vue-router'
import Login from '../views/Login.vue'
import MainBox from '../views/MainBox.vue'

const routes = [
    {
        path: '/login',
        name: 'login',
        component: Login
    },
    {
        path: '/mainbox',
        name: 'mainbox',
        component: MainBox
    },
]
const router = createRouter({
    history: createWebHashHistory(),  // 带 # 的路径
    routes
})

export default router
```

项目使用路由 main.js：

```js
import { createApp } from 'vue'
// import './style.css'
import App from './App.vue'
import router from './router'  //导入路由

createApp(App)
    .use(router)  // 使用路由
    .mount('#app')
```

App.vue

```vue
<template>
  <div>
    <!-- 路由容器:路径匹配则自动加载 -->
     <router-view></router-view>
  </div>
</template>
...
```



#### 1.3.1 配置动态路由

router/config.js

```js
import Home from "../views/home/Home.vue";
// 用户管理
import UserList from "../views/user-manage/UserList.vue";
// 权限管理
import RoleList from "../views/right-manage/RoleList.vue";
import RightList from "../views/right-manage/RightList.vue";
// 实验室管理
import LabList from "../views/lab-manage/LabList.vue";
import AddLab from "../views/lab-manage/AddLab.vue";
// 预约管理
import AuditList from "../views/book-manage/AuditList.vue";
import BookList from "../views/book-manage/BookList.vue";
import AddBook from "../views/book-manage/AddBook.vue";

const routes = [
    {
        path: '/index',
        component: Home
    },
    {
        path: '/user-manage/list',
        component: UserList
    },
    {
        path: '/right-manage/rolelist',
        component: RoleList
    },
    {
        path: '/right-manage/rightlist',
        component: RightList
    },
    {
        path: '/lab-manage/lablist',
        component: LabList
    },
    {
        path: '/lab-manage/addlab',
        component: AddLab
    },
    {
        path: '/book-manage/auditlist',
        component: AuditList
    },
    {
        path: '/book-manage/booklist',
        component: BookList
    },
    {
        path: '/book-manage/addbook',
        component: AddBook
    }
]

export default routes
```

router/index.js

```js
import { createRouter, createWebHashHistory } from 'vue-router'
import Login from '../views/Login.vue'
import MainBox from '../views/MainBox.vue'
import RouteConfig from '../router/config'
import { useRouterStore } from '../store/useRouterStore'
import NotFound from '../views/notfound/NotFound.vue'

const routes = [
    {
        path: '/login',
        name: 'login',
        component: Login
    },
    {
        path: '/mainbox',
        name: 'mainbox',
        component: MainBox
    },
]
const router = createRouter({
    history: createWebHashHistory(),  // 带 # 的路径
    routes
})

// 添加路由
// router.addRoute("mainbox", {
//     path: '/index',   // 访问路径 #/index, 但如果是 'index'，则访问路径为 #/mainbox/index
//     component: Home   // Home 作为 mainbox 的孩子
// })

// 路由拦截
router.beforeEach((to, from, next) => {
    const { isGetterRouter } = useRouterStore()

    // 如果跳转是 login 就放行
    if (to.name === 'login') {
        next()
    } else {
        // 未登录授权：如果未登录则跳转的登陆
        if (!localStorage.getItem('token')) {
            next({
                path: '/login'
            })
        } else {
            // 只有第一次进入路由拦截才会进行配置路由 - 引入 pinia 公共状态管理
            if (!isGetterRouter) {
                ConfigRouter()
                next({ path: to.fullPath })  //第一次刚配置路由时不会生效，需要强行往路由上走一次
            } else {
                next()
            }
        }
    }
})

// 在 mainbox 下都写成孩子路由，用数组的方式加入路由
const ConfigRouter = () => {
    const { changeRouter } = useRouterStore()
    RouteConfig.forEach((item) => {
        router.addRoute("mainbox", item)
    })

    // 重定向
    router.addRoute("mainbox", {
        path: '/',
        redirect: '/index'
    })

    // 404
    router.addRoute("mainbox", {
        path: '/:pathMatch(.*)*',
        name: 'not found',
        component: NotFound
    })

    console.log(router.getRoutes()); //当前路由对象下有多少个路由
    changeRouter(true)
}

export default router
```



#### 1.3.2 路由权限匹配

router/index.js

```js
import { createRouter, createWebHashHistory } from 'vue-router'
import Login from '../views/Login.vue'
import MainBox from '../views/MainBox.vue'
import RouteConfig from '../router/config'
import { useRouterStore } from '../store/useRouterStore'
import NotFound from '../views/notfound/NotFound.vue'
import { useUserStore } from '../store/useUserStore'

const routes = [
    {
        path: '/login',
        name: 'login',
        component: Login
    },
    {
        path: '/mainbox',
        name: 'mainbox',
        component: MainBox
    },
]
const router = createRouter({
    history: createWebHashHistory(),  // 带 # 的路径
    routes
})

// 添加路由
// router.addRoute("mainbox", {
//     path: '/index',   // 访问路径 #/index, 但如果是 'index'，则访问路径为 #/mainbox/index
//     component: Home   // Home 作为 mainbox 的孩子
// })

// 路由拦截
router.beforeEach((to, from, next) => {
    const { isGetterRouter } = useRouterStore()
    const { user } = useUserStore()
    // 如果跳转是 login 就放行
    if (to.name === 'login') {
        next()
    } else {
        // 未登录授权：如果未登录则跳转的登陆
        // if (!localStorage.getItem('token')) {
        if (!user.role) {  // 更换为：用持久化 pinia 中的角色对象非空 - 表示登陆了
            next({
                path: '/login'
            })
        } else {
            // 只有第一次进入路由拦截才会进行配置路由 - 引入 pinia 公共状态管理
            if (!isGetterRouter) {
                router.removeRoute("mainbox") //重新登陆时需要将旧的 mianbox 移除掉，确保切换用户时 mainbox 路由始终是空的
                ConfigRouter()
                next({ path: to.fullPath })  //第一次刚配置路由时不会生效，需要强行往路由上走一次
            } else {
                next()
            }
        }
    }
})

// 在 mainbox 下都写成孩子路由，用数组的方式加入路由
const ConfigRouter = () => {
    // 因为路由拦截中移除掉过，所以重新登陆时要加进来
    router.addRoute({
        path: '/mainbox',
        name: 'mainbox',
        component: MainBox
    })
    const { changeRouter } = useRouterStore()
    RouteConfig.forEach((item) => {
        // 判断用户的路由(即菜单)权限，只有包含的情况下才会添加对应权限的路由
        checkPermission(item.path) && router.addRoute("mainbox", item)
    })

    // 重定向
    router.addRoute("mainbox", {
        path: '/',
        redirect: '/index'
    })

    // 404
    router.addRoute("mainbox", {
        path: '/:pathMatch(.*)*',
        name: 'not found',
        component: NotFound
    })

    console.log(router.getRoutes()); //当前路由对象下有多少个路由
    changeRouter(true)
}

// 检查用户路由权限，包含返回 true，不包含返回 false
const checkPermission = (path) => {
    const { user } = useUserStore()
    return user.role.rights.includes(path)
}

export default router
```



### 1.4 引入状态管理 pinia

安装：*npm i pinia*

使用：

store/useRouterStore.js

```js
import {defineStore} from 'pinia'
import { ref } from 'vue'

export const useRouterStore = defineStore("router", () => {
    const isGetterRouter = ref(false) //全局可用
    const changeRouter = (value) => {
        isGetterRouter.value = value
    }
    return {
        isGetterRouter,
        changeRouter
    }
})
```



### 1.5 引入 pinia 持久化插件

安装：*npm i pinia-plugin-persistedstate*

引入：main.js

```js
import { createPinia } from 'pinia'
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'

const pinia = createPinia()
pinia.use(piniaPluginPersistedstate)
```

开启持久化：useUserStore.js - `{ persist: true }`

```js
import {defineStore} from 'pinia'
import { ref } from 'vue'

// defineStore 第三个参与用于 pinia 持久化插件配置
export const useUserStore = defineStore("user", () => {
    const user = ref({}) //全局可用
    const changeUser = (value) => {
        user.value = value
    }
    return {
        user,
        changeUser
    }
}, {
    persist: true //持久化设置
})
```

触发持久化 store 时，会将公共状态数据 user 存储在 localStorage 中。



### 1.6 登陆&退出登陆

Login.vue

```vue
<template>
  <div>
    login
    <button @click="handleLoginAdmin">登陆-admin</button>
    <button @click="handleLoginTeacher">登陆-teacher</button>
  </div>
</template>

<script setup>
import { useRouter } from "vue-router"
import { useUserStore } from "../store/useUserStore"

const router = useRouter()

const userStore = useUserStore()
const handleLoginAdmin = () => {
  // pinia 默认存在在内存，同步写入本地存储
  userStore.changeUser({
    id: 1,
    username: "admin",
    password: "123",
    role: {
      roleName: "管理员",
      roleType: 1,
      rights: [
        "/index",
        "/user-manage",
        "/user-manage/list",
        "/right-manage",
        "/right-manage/rolelist",
        "/right-manage/rightlist",
        "/lab-manage",
        "/lab-manage/lablist",
        "/lab-manage/addlab",
        "/book-manage",
        "/book-manage/auditlist",
        "/book-manage/booklist",
      ],
    },
  })
  // 跳转到首页
  router.push("/")
}

const handleLoginTeacher = () => {
  userStore.changeUser({
    id: 2,
    username: "jerry",
    password: "123",
    role: {
      roleName: "教师",
      roleType: 2,
      rights: ["/index", "/book-manage", "/book-manage/auditlist", "/book-manage/booklist"],
    },
  })
  // 跳转到首页
  router.push("/")
}
</script>
```

MainBox.vue

```vue
<template>
    <div>
        mainbox
        <button @click="handleExit">退出</button>
        <router-view></router-view>
    </div>
</template>

<script setup>
import { useRouter } from 'vue-router';
import { useUserStore } from '../store/useUserStore';
import { useRouterStore } from '../store/useRouterStore';

const router = useRouter()
const { changeUser } = useUserStore()
const { changeRouter } = useRouterStore()

const handleExit = () => {
    changeUser({}) //清空
    changeRouter(false) //重置路由权限的获取状态
    router.push('/login') //跳转到登陆
}
</script>
```



### 1.7 登录页 - 引入element-plus

组件库：[element-Plus](https://element-plus.org/zh-CN/)

安装：*npm i element-plus*

* 写样式记得安装 sass： *npm i sass*

引入:

```js
import { createApp } from 'vue'
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
import App from './App.vue'

const app = createApp(App)

app.use(ElementPlus)
app.mount('#app')
```

Login.vue

```vue
<template>
  <vue-particles
    id="tsparticles"
    @particles-loaded="particlesLoaded"
    :options="tsparticlesConfig"
  />
  <div class="formContainer">
    <h3>智慧实验室平台管理系统</h3>
    <!-- el-form 中的 @submit.prevent 和 el-button 中的 native-type 可以让 button监听回车提交事件  -->
    <el-form
      ref="ruleFormRef"
      style="max-width: 600px"
      :model="ruleForm"
      :rules="rules"
      label-width="120px"
      class="ruleForm"
      status-icon
      @submit.prevent="submitForm(ruleFormRef)" 
    >
      <el-form-item label="用户名" prop="username">
        <el-input v-model="ruleForm.username" />
      </el-form-item>
      <el-form-item label="密码" prop="password">
        <el-input v-model="ruleForm.password" type="password" />
      </el-form-item>

      <el-form-item>
        <!-- <el-button type="primary" @click="submitForm(ruleFormRef)"> 登陆 </el-button> -->
        <el-button type="primary" native-type="submit"> 登陆 </el-button>
      </el-form-item>
    </el-form>
  </div>
</template>

<script setup>
import { useRouter } from "vue-router"
import { useUserStore } from "../store/useUserStore"
import { reactive, ref } from "vue"
import { tsparticlesConfig } from '../util/tsparticlesConfig'

const particlesLoaded = async container => {
    console.log("粒子库 Particles container loaded", container);
};

// ref 获取表单对象
const ruleFormRef = ref()
const ruleForm = reactive({
  username: "",
  password: "",
})
const rules = reactive({
  username: [{ required: true, message: "请输入用户名", trigger: "blur" }],
  password: [{ required: true, message: "请输入密码", trigger: "blur" }],
})

const router = useRouter()
const userStore = useUserStore()

// 登陆回调 - 复用组件里的 submitForm 逻辑（根据业务修改内部）
const submitForm = async formEl => {
  if (!formEl) return
  await formEl.validate((valid, fields) => {
    if (valid) {
      // console.log('提交!', ruleForm)
      if (ruleForm.username === "admin") {
        handleLoginAdmin()
      } else {
        handleLoginTeacher()
      }
    } else {
      console.log("错误提交!", fields)
    }
  })
}

const handleLoginAdmin = () => {
  // pinia 默认存在在内存，同步写入本地存储
  userStore.changeUser({
    id: 1,
    username: "admin",
    password: "123",
    role: {
      roleName: "管理员",
      roleType: 1,
      rights: [
        "/index",
        "/user-manage",
        "/user-manage/list",
        "/right-manage",
        "/right-manage/rolelist",
        "/right-manage/rightlist",
        "/lab-manage",
        "/lab-manage/lablist",
        "/lab-manage/addlab",
        "/book-manage",
        "/book-manage/auditlist",
        "/book-manage/booklist",
      ],
    },
  })
  // 跳转到首页
  router.push("/")
}

const handleLoginTeacher = () => {
  userStore.changeUser({
    id: 2,
    username: "jerry",
    password: "123",
    role: {
      roleName: "教师",
      roleType: 2,
      rights: ["/index", "/book-manage", "/book-manage/auditlist", "/book-manage/booklist"],
    },
  })
  // 跳转到首页
  router.push("/")
}
</script>

<style lang="scss" scoped>
.formContainer {
  width: 500px;
  height: 300px;
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  color: yellow;
  text-shadow: 2px 2px 5px black;
  text-align: center;
  z-index: 100;
  .ruleForm {
    margin-top: 50px;
  }
  h3 {
    font-size: 35px;
  }
  :deep(.el-form-item__label) {
    color: white;
    font-weight: bold;
    font-size: 18px;
  }
}
</style>

```

### 1.8 引入粒子库 particles

`particles` 粒子库官网：https://particles.js.org/

![image-20260107183325381](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260107183326943.png)



点击跳转 github 对应 vue3 文档：https://github.com/tsparticles/vue3

安装：*npm i @tsparticles/vue3*  和 *npm i tsparticles*



#### 1.8.1 使用默认粒子效果

main.js - 导入和使用

```js
import Particles from "@tsparticles/vue3";
import { loadFull } from "tsparticles";

createApp(App)
    .use(Particles, {
        init: async engine => {
            await loadFull(engine); 
            // await loadSlim(engine);
        },
    })
    .mount('#app')
```

Login.vue - 复制 github 说明文档中的 `<vue-particles ...>` 标签内容，放在 form 表单外即可。将 options 单独维护为 xxxConfig.js 文件进行导入。

```vue
<template>
  <vue-particles id="tsparticles" @particles-loaded="particlesLoaded" :options="tsparticlesConfig" />
</template>

<script setup>
import { tsparticlesConfig } from '../util/tsparticlesConfig'
const particlesLoaded = async container => {
    console.log("粒子库 Particles container loaded", container);
};
...
</script>
```

src/util/tsparticlesConfig.js

```js
export const tsparticlesConfig = {
    "autoPlay": true,
    "background": {
        "color": {
            "value": "#043564"
        },
        "image": "url('https://vincentgarreau.com/particles.js/assets/img/kbLd9vb_new.gif')",
        "position": "0 50%",
        "repeat": "no-repeat",
        "size": "60%",
        "opacity": 1
    },
    "backgroundMask": {
        "composite": "destination-out",
        "cover": {
            "opacity": 1,
            "color": {
                "value": ""
            }
        },
        "enable": false
    },
    "clear": true,
    "defaultThemes": {},
    "delay": 0,
    "fullScreen": {
        "enable": true,
        "zIndex": 0
    },
    "detectRetina": true,
    "duration": 0,
    "fpsLimit": 120,
    "interactivity": {
        "detectsOn": "window",
        "events": {
            "onClick": {
                "enable": true,
                "mode": "repulse"
            },
            "onDiv": {
                "selectors": [],
                "enable": false,
                "mode": [],
                "type": "circle"
            },
            "onHover": {
                "enable": false,
                "mode": [],
                "parallax": {
                    "enable": false,
                    "force": 2,
                    "smooth": 10
                }
            },
            "resize": {
                "delay": 0.5,
                "enable": true
            }
        },
        "modes": {
            "trail": {
                "delay": 1,
                "pauseOnStop": false,
                "quantity": 1
            },
            "attract": {
                "distance": 200,
                "duration": 0.4,
                "easing": "ease-out-quad",
                "factor": 1,
                "maxSpeed": 50,
                "speed": 1
            },
            "bounce": {
                "distance": 200
            },
            "bubble": {
                "distance": 200,
                "duration": 0.4,
                "mix": false,
                "divs": {
                    "distance": 200,
                    "duration": 0.4,
                    "mix": false,
                    "selectors": []
                }
            },
            "connect": {
                "distance": 80,
                "links": {
                    "opacity": 0.5
                },
                "radius": 60
            },
            "grab": {
                "distance": 100,
                "links": {
                    "blink": false,
                    "consent": false,
                    "opacity": 1
                }
            },
            "push": {
                "default": true,
                "groups": [],
                "quantity": 4
            },
            "remove": {
                "quantity": 2
            },
            "repulse": {
                "distance": 200,
                "duration": 0.4,
                "factor": 100,
                "speed": 1,
                "maxSpeed": 50,
                "easing": "ease-out-quad",
                "divs": {
                    "distance": 200,
                    "duration": 0.4,
                    "factor": 100,
                    "speed": 1,
                    "maxSpeed": 50,
                    "easing": "ease-out-quad",
                    "selectors": []
                }
            },
            "slow": {
                "factor": 3,
                "radius": 200
            },
            "particle": {
                "replaceCursor": false,
                "pauseOnStop": false,
                "stopDelay": 0
            },
            "light": {
                "area": {
                    "gradient": {
                        "start": {
                            "value": "#ffffff"
                        },
                        "stop": {
                            "value": "#000000"
                        }
                    },
                    "radius": 1000
                },
                "shadow": {
                    "color": {
                        "value": "#000000"
                    },
                    "length": 2000
                }
            }
        }
    },
    "manualParticles": [],
    "particles": {
        "bounce": {
            "horizontal": {
                "value": 1
            },
            "vertical": {
                "value": 1
            }
        },
        "collisions": {
            "absorb": {
                "speed": 2
            },
            "bounce": {
                "horizontal": {
                    "value": 1
                },
                "vertical": {
                    "value": 1
                }
            },
            "enable": false,
            "maxSpeed": 50,
            "mode": "bounce",
            "overlap": {
                "enable": true,
                "retries": 0
            }
        },
        "color": {
            "value": "#ffffff",
            "animation": {
                "h": {
                    "count": 0,
                    "enable": false,
                    "speed": 1,
                    "decay": 0,
                    "delay": 0,
                    "sync": true,
                    "offset": 0
                },
                "s": {
                    "count": 0,
                    "enable": false,
                    "speed": 1,
                    "decay": 0,
                    "delay": 0,
                    "sync": true,
                    "offset": 0
                },
                "l": {
                    "count": 0,
                    "enable": false,
                    "speed": 1,
                    "decay": 0,
                    "delay": 0,
                    "sync": true,
                    "offset": 0
                }
            }
        },
        "effect": {
            "close": true,
            "fill": true,
            "options": {},
            "type": []
        },
        "groups": {},
        "move": {
            "angle": {
                "offset": 0,
                "value": 90
            },
            "attract": {
                "distance": 200,
                "enable": false,
                "rotate": {
                    "x": 3000,
                    "y": 3000
                }
            },
            "center": {
                "x": 50,
                "y": 50,
                "mode": "percent",
                "radius": 0
            },
            "decay": 0,
            "distance": {},
            "direction": "left",
            "drift": 0,
            "enable": true,
            "gravity": {
                "acceleration": 9.81,
                "enable": false,
                "inverse": false,
                "maxSpeed": 50
            },
            "path": {
                "clamp": true,
                "delay": {
                    "value": 0
                },
                "enable": false,
                "options": {}
            },
            "outModes": {
                "default": "out",
                "bottom": "out",
                "left": "out",
                "right": "out",
                "top": "out"
            },
            "random": false,
            "size": false,
            "speed": 6,
            "spin": {
                "acceleration": 0,
                "enable": false
            },
            "straight": true,
            "trail": {
                "enable": false,
                "length": 10,
                "fill": {}
            },
            "vibrate": false,
            "warp": false
        },
        "number": {
            "density": {
                "enable": false,
                "width": 1920,
                "height": 1080
            },
            "limit": {
                "mode": "delete",
                "value": 0
            },
            "value": 100
        },
        "opacity": {
            "value": 0.5,
            "animation": {
                "count": 0,
                "enable": false,
                "speed": 2,
                "decay": 0,
                "delay": 0,
                "sync": false,
                "mode": "auto",
                "startValue": "random",
                "destroy": "none"
            }
        },
        "reduceDuplicates": false,
        "shadow": {
            "blur": 0,
            "color": {
                "value": "#000"
            },
            "enable": false,
            "offset": {
                "x": 0,
                "y": 0
            }
        },
        "shape": {
            "close": true,
            "fill": true,
            "options": {
                "star": {
                    "sides": 5
                }
            },
            "type": "star"
        },
        "size": {
            "value": {
                "min": 1,
                "max": 4
            },
            "animation": {
                "count": 0,
                "enable": false,
                "speed": 5,
                "decay": 0,
                "delay": 0,
                "sync": false,
                "mode": "auto",
                "startValue": "random",
                "destroy": "none"
            }
        },
        "stroke": {
            "width": 0
        },
        "zIndex": {
            "value": 0,
            "opacityRate": 1,
            "sizeRate": 1,
            "velocityRate": 1
        },
        "destroy": {
            "bounds": {},
            "mode": "none",
            "split": {
                "count": 1,
                "factor": {
                    "value": 3
                },
                "rate": {
                    "value": {
                        "min": 4,
                        "max": 9
                    }
                },
                "sizeOffset": true,
                "particles": {}
            }
        },
        "roll": {
            "darken": {
                "enable": false,
                "value": 0
            },
            "enable": false,
            "enlighten": {
                "enable": false,
                "value": 0
            },
            "mode": "vertical",
            "speed": 25
        },
        "tilt": {
            "value": 0,
            "animation": {
                "enable": false,
                "speed": 0,
                "decay": 0,
                "sync": false
            },
            "direction": "clockwise",
            "enable": false
        },
        "twinkle": {
            "lines": {
                "enable": false,
                "frequency": 0.05,
                "opacity": 1
            },
            "particles": {
                "enable": false,
                "frequency": 0.05,
                "opacity": 1
            }
        },
        "wobble": {
            "distance": 5,
            "enable": false,
            "speed": {
                "angle": 50,
                "move": 10
            }
        },
        "life": {
            "count": 0,
            "delay": {
                "value": 0,
                "sync": false
            },
            "duration": {
                "value": 0,
                "sync": false
            }
        },
        "rotate": {
            "value": 0,
            "animation": {
                "enable": false,
                "speed": 0,
                "decay": 0,
                "sync": false
            },
            "direction": "clockwise",
            "path": false
        },
        "orbit": {
            "animation": {
                "count": 0,
                "enable": false,
                "speed": 1,
                "decay": 0,
                "delay": 0,
                "sync": false
            },
            "enable": false,
            "opacity": 1,
            "rotation": {
                "value": 45
            },
            "width": 1
        },
        "links": {
            "blink": false,
            "color": {
                "value": "#fff"
            },
            "consent": false,
            "distance": 100,
            "enable": false,
            "frequency": 1,
            "opacity": 1,
            "shadow": {
                "blur": 5,
                "color": {
                    "value": "#000"
                },
                "enable": false
            },
            "triangles": {
                "enable": false,
                "frequency": 1
            },
            "width": 1,
            "warp": false
        },
        "repulse": {
            "value": 0,
            "enabled": false,
            "distance": 1,
            "duration": 1,
            "factor": 1,
            "speed": 1
        }
    },
    "pauseOnBlur": true,
    "pauseOnOutsideViewport": true,
    "responsive": [],
    "smooth": false,
    "style": {},
    "themes": [],
    "zLayers": 100,
    "key": "nyancat2",
    "name": "Nyan Cat 2",
    "motion": {
        "disable": false,
        "reduce": {
            "factor": 4,
            "value": true
        }
    }
}
```

##### 效果

![image-20260108120837033](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260108120838390.png)



#### 1.8.2 使用其他粒子效果

从 `particles` 粒子库官网：https://particles.js.org/

跳转到 

![image-20260107195418831](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260107195420149.png)

![image-20260107185216663](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260107185218276.png)

拷贝其配置内容，替换掉 src/util/tsparticlesConfig.js 即可。

* 其中修改背景图，在属性 background - image 中修改，图片文件放在 public/bg.jpg 目录下

```js
export const tsparticlesConfig = {
    "autoPlay": true,
    "background": {
        "color": {
            "value": "#043564"
        },
        "image": "url('./bg.jpg')",  //指定图片，直接引用就是放在 public 下
        "position": "center",   //定位到中心
        "repeat": "no-repeat",
        "size": "cover",    //覆盖铺满
        "opacity": 1,
        "attachment": "fixed"  //不随窗口滚动
    },
    ...
```



### 1.9 布局

目录

```
src/
  components/
    MainBox/
      SideMenu.vue
      TopHeader.vue
  views/
    MainBox.vue
```

MainBox.vue - 涉及布局组件 `Container`

```vue
<template>
  <div>
    <el-container style="height: 100vh">
      <!-- 侧边栏 Aside -->
      <SideMenu></SideMenu>
      <el-container direction="vertical">
        <!-- 顶部 Header -->
        <TopHeader></TopHeader>
        <el-main>
          <!-- 美观的默认滚动条 - 最好使用它包裹一下 -->
          <el-scrollbar>
            <router-view></router-view>
          </el-scrollbar>
        </el-main>
      </el-container>
    </el-container>
  </div>
</template>

<script setup>
import SideMenu from "../components/MainBox/SideMenu.vue"
import TopHeader from "../components/MainBox/TopHeader.vue"
</script>
```

SideMenu.vue

```vue
<template>
  <el-aside width="200px">
    sidemenu
  </el-aside>
</template>
```

TopHeader.vue - 主要支持标题、欢迎语、用户名显示，以及退出 或 跳转个人中心等

```vue
<template>
  <el-header>
    topHeader
    <button @click="handleExit">退出</button>
  </el-header>
</template>

<script setup>
import { useRouter } from "vue-router"
import { useUserStore } from "../../store/useUserStore"
import { useRouterStore } from "../../store/useRouterStore"

const router = useRouter()
const { changeUser } = useUserStore()
const { changeRouter } = useRouterStore()

const handleExit = () => {
  changeUser({}) //清空
  changeRouter(false) //重置路由权限的获取状态
  router.push("/login") //跳转到登陆
}
</script>
```



### 1.10 SideMenu 侧边栏

SideMenu.vue - 核心技术点：

* `height: 100vh` 可以解决侧边栏滚动条没有占满上下屏幕
* `:router=true` 在 el-menu 中开启后可以基于 index 配置的 path 路径跳转
* icon图标：使用动态组件 `<component>` 的 :is 属性动态绑定图标组件实例对象，不是字符串，因此需要 map 映射取值
* `route.fullPath` 当前相对路径，如 /user-manage/list 用于 :default-active 动态绑定实现当前菜单高亮

```vue
<template>
  <el-aside width="200px">
    <el-scrollbar>
      <!-- height:100vh 必须添加，否则侧边栏滚动不是占满上下位置; :router="true" 基于index进行跳转 -->
      <el-menu :default-active="route.fullPath" class="el-menu-vertical-demo" style="height: 100vh" :router="true">
        <!-- for循环嵌套 -->
        <template v-for="data in datalist" :key="data.path">
          <!-- 有子级的继续遍历子级，同时判断是否拥有权限菜单 -->
          <el-sub-menu :index="data.path" v-if="data.children.length && checkAuth(data.path)">
            <template #title>
              <el-icon>
                <!-- icon图标：使用动态组件的 :is 属性动态绑定图标组件实例对象，不是字符串，因此需要 map 映射取值 -->
                <component :is="mapIcons[data.icon]"></component>
              </el-icon>
              <span>{{ data.title }}</span>
            </template>
            <!-- 子级也使用 template 包裹进行遍历，此时内部可以使用 v-if 来判断是否拥有权限菜单 -->
            <template v-for="item in data.children" :key="item.path">
              <el-menu-item :index="item.path" v-if="checkAuth(item.path)">
                <el-icon>
                  <component :is="mapIcons[item.icon]"></component>
                </el-icon>
                <span>{{ item.title }}</span>
              </el-menu-item>
            </template>
          </el-sub-menu>
          <!-- 没有子级的菜单为【首页】，根据json数据，它是json里第一个数据，因此【首页】在最上面 -->
          <el-menu-item :index="data.path" v-else-if="checkAuth(data.path)">
            <el-icon>
              <component :is="mapIcons[data.icon]"></component>
            </el-icon>
            <span>{{ data.title }}</span>
          </el-menu-item>
        </template>
      </el-menu>
    </el-scrollbar>
  </el-aside>
</template>

<script setup>
import { onMounted, ref } from "vue"
import axios from "axios"
import { HomeFilled, Key, OfficeBuilding, UploadFilled, List, User } from "@element-plus/icons-vue"
import { useRoute } from "vue-router"
import { useUserStore } from "../../store/useUserStore"
const route = useRoute()
//route.fullPath 当前相对路径，如 /user-manage/list 用于 :default-active 动态绑定实现当前菜单高亮
console.log(route)

// dom已挂载时就请求权限数据，进行渲染
onMounted(() => {
  getList()
})
const datalist = ref([])
const getList = async () => {
  let res = await axios.get("/rights.json")
  console.log(res.data)
  datalist.value = res.data
}

// 图标实例对象映射，同名简写，如 User: User,
const mapIcons = {
  HomeFilled,
  User,
  Key,
  OfficeBuilding,
  UploadFilled,
  List,
}

// 校验 pinia 中当前登录用户拥有的权限 path 列表，没有权限则不创建菜单
const { user } = useUserStore()
const checkAuth = path => {
  return user.role.rights.includes(path)
}
</script>
```

依赖权限菜单 json 数据（临时准备）。

rights.json

```json
[
  {
    "title": "首页",
    "path": "/index",
    "icon": "HomeFilled",
    "children": []
  },
  {
    "title": "用户管理",
    "path": "/user-manage",
    "icon": "User",
    "children": [
      {
        "title": "用户列表",
        "path": "/user-manage/list",
        "icon": "List"
      }
    ]
  },
  {
    "title": "权限管理",
    "path": "/right-manage",
    "icon": "Key",
    "children": [
      {
        "title": "角色列表",
        "path": "/right-manage/rolelist",
        "icon": "List"
      },
      {
        "title": "权限列表",
        "path": "/right-manage/rightlist",
        "icon": "List"
      }
    ]
  },
  {
    "title": "实验室管理",
    "path": "/lab-manage",
    "icon": "OfficeBuilding",
    "children": [
      {
        "title": "实验室列表",
        "path": "/lab-manage/lablist",
        "icon": "List"
      },
      {
        "title": "添加实验室",
        "path": "/lab-manage/addlab",
        "icon": "List"
      }
    ]
  },
  {
    "title": "预约管理",
    "path": "/book-manage",
    "icon": "UploadFilled",
    "children": [
      {
        "title": "审核列表",
        "path": "/book-manage/auditlist",
        "icon": "List"
      },
      {
        "title": "预约列表",
        "path": "/book-manage/booklist",
        "icon": "List"
      },
      {
        "title": "预约实验室",
        "path": "/book-manage/addbook",
        "icon": "List"
      }
    ]
  }
]
```

##### 效果

![image-20260108120946052](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260108120947398.png)

### 1.11 TopHeader 顶部栏

TopHeader.vue - 核心技术点：

* 默认头像的放置位置不同，则取值方式就会不同。

```vue
<template>
  <el-header>
    <div>实验室管理系统</div>
    <div>
      <span style="line-height:40px">欢迎 {{ user.username }} 回来</span>
      <el-dropdown>
        <!-- 头像 -->
        <el-avatar :size="40" :src="circleUrl" />
        <template #dropdown>
          <el-dropdown-menu>
            <el-dropdown-item>{{ user.role.roleName }}</el-dropdown-item>
            <el-dropdown-item @click="handleExit">退出</el-dropdown-item>
          </el-dropdown-menu>
        </template>
      </el-dropdown>
    </div>
  </el-header>
</template>

<script setup>
import { useRouter } from "vue-router"
import { useUserStore } from "../../store/useUserStore"
import { useRouterStore } from "../../store/useRouterStore"

const router = useRouter()
const { user, changeUser } = useUserStore()
const { changeRouter } = useRouterStore()

const handleExit = () => {
  changeUser({}) //清空
  changeRouter(false) //重置路由权限的获取状态
  router.push("/login") //跳转到登陆
}

// ① 头像位置: public/avatar.png
// const circleUrl = "/avatar.png"
// ② webpack: src/assets/  使用 require("../../assets/avatar.png") 引入
// const circleUrl = "/avatar.png"
// Vite项目 asstes/avatar.png  使用 new URL(path, import.meta.url).href 引入
const circleUrl = new URL('../../assets/avatar.png', import.meta.url).href
</script>

<style lang="scss" scoped>
.el-header{
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: blue;
  color: white;
}
</style>
```

##### 效果

![image-20260108124401264](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260108124402480.png)



### 1.12 RightList 权限列表

RightList.vue - 核心技术点：

* Table 表格组件: 要支持`树形展开子级`只需要设置 `row-key="唯一属性"`
* `scope.row` 在 el-table 组件中默认取 tableData 的一行数据，直接用 . 取值

```vue
<template>
  <!-- Table 表格组件: 树形展开子级只需要设置 row-key="唯一属性" -->
  <el-table :data="tableData" style="width: 100%" row-key="path">
    <el-table-column prop="title" label="权限名称" min-width="200" />
    <!-- 图标需使用：自定义表单+动态组件<component>映射map -->
    <el-table-column label="图标" min-width="100">
      <template #default="scope">
        <div style="display: flex; align-items: center">
          <!-- scope.row 是默认取 tableData 的行数据，因此可以直接 .icon -->
          <el-icon>
            <component :is="mapIcons[scope.row.icon]"></component>
          </el-icon>
        </div>
      </template>
    </el-table-column>
    <!-- 按钮也使用：自定义表单 -->
    <el-table-column label="操作" min-width="200">
      <template #default="scope">
        <!-- 更新按钮使用：dialog 对话框组件，设置双向绑定变量 dialogVisible=true 即可显示 -->
        <el-button size="small" type="primary" round @click="handleUpdate(scope.row)">更新</el-button>
        <!-- 删除按钮使用：popconfirm 气泡确认框 -->
        <el-popconfirm
          title="你确定要删除吗?"
          @confirm="handleDelete(scope.row.id)"
          confirm-button-text="确定"
          cancel-button-text="取消"
        >
          <template #reference>
            <!-- 插槽方式写入按钮 -->
            <el-button size="small" type="danger" round>删除</el-button>
          </template>
        </el-popconfirm>
      </template>
    </el-table-column>
  </el-table>

  <!-- dialog 对话框组件 -->
  <el-dialog v-model="dialogVisible" title="更新权限" width="400px">
    <!-- label-width="80px" 避免对话框内部左侧宽度太宽 -->
    <el-form ref="updateFormRef" :model="updateForm" :rules="rules" label-width="80px" class="ruleForm" status-icon>
      <el-form-item label="权限名称" prop="title">
        <el-input v-model="updateForm.title" />
      </el-form-item>
    </el-form>

    <template #footer>
      <div class="dialog-footer">
        <el-button @click="dialogVisible = false">取消</el-button>
        <el-button type="primary" @click="handleConfirm"> 更新 </el-button>
      </div>
    </template>
  </el-dialog>
</template>

<script setup>
import { onMounted, reactive, ref } from "vue"
import axios from "axios"
import { HomeFilled, Key, OfficeBuilding, UploadFilled, List, User } from "@element-plus/icons-vue"
import { ElMessage } from "element-plus"

const tableData = ref([])
onMounted(() => {
  getList()
})
const getList = async () => {
  let res = await axios.get("/admin/rights/list")
  console.log(res.data)
  tableData.value = res.data
}

// 图标实例对象映射，同名简写，如 User: User,
const mapIcons = {
  HomeFilled,
  User,
  Key,
  OfficeBuilding,
  UploadFilled,
  List,
}

// 更新弹窗 form表单所需
const dialogVisible = ref(false)
const updateFormRef = ref()
const updateForm = reactive({
  title: "",
})
const rules = reactive({
  title: [{ required: true, message: "请输入权限名称", trigger: "blur" }],
})
const currentItem = ref({})

// 更新 put: /admin/rights/{id} 参数 {title:"", icon:""}
const handleUpdate = row => {
  //console.log(row)
  currentItem.value = row //记录当前点击的对象内容，用于更新时拿id
  updateForm.title = row.title
  dialogVisible.value = true
}
// 点击更新 confirm 确认 - 复用组件里的 submitForm 逻辑（根据业务修改内部）
const handleConfirm = () => {
  updateFormRef.value.validate(async (valid, fields) => {
    if (valid) {
      // 提交更新
      let res = await axios.put(`/admin/rights/${currentItem.value.id}`, updateForm)
      console.log("update res:", res.data)

      dialogVisible.value = false //对话框消失
      if (!res.data.code) {
        ElMessage({
          //成功提示 Message 消息组件
          message: res.data.msg,
          type: "success",
        })
        getList() //对话框消失再获取并更新一次列表
      } else {
        ElMessage.error(res.data.msg)
      }
    } else {
      console.log("错误提交!", fields)
    }
  })
}

// 删除
const handleDelete = async id => {
  console.log(id)
  await axios.delete(`/admin/rights/${id}`)
  await getList() //气泡对话框消失再获取并更新一次列表
  ElMessage({
    message: "删除成功！",
    type: "success",
  })
}
</script>
```

##### 效果

更新 - 弹窗和Message提示；删除 - 气泡确认框和Message提示

![image-20260108195741083](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260108195742346.png)

### 1.13 RoleList 角色列表

RoleList.vue - 核心技术点：

* `Popover 弹出框`组件，鼠标移入悬浮树形显示权限列表
* 更新角色权限的树形可选显示
* Tree 树形控件：`show-checkbox` 变成可选节点，做默认选中必须设置 node-key 值唯一; `:check-strictly="true"` 父子不关联
* Tree 树形控件：自定义节点 的渲染方法 renderContent

```vue
<template>
  <!-- Table 表格组件: 树形展开 row-key="唯一属性" -->
  <el-table :data="tableData" style="width: 100%">
    <!-- <el-table-column prop="roleName" label="角色名称" min-width="200" /> -->
    <el-table-column label="角色名称" min-width="200">
      <template #default="scope">
        <!-- Popover 弹出框组件：鼠标移入悬浮提示 -->
        <el-popover
          placement="right"
          title="权限详情"
          :width="200"
          trigger="hover"
          @before-enter="handleHover(scope.row)"
        >
          <!-- 表格列内容显示 -->
          <template #reference>
            <el-button class="m-2">{{ scope.row.roleName }}</el-button>
          </template>
          <!-- 默认插槽，参考文档描述 -->
          <template #default>
            <!-- Tree 树形控件：鼠标移入默认显示映射的 props 且默认展开，自定义节点使用 render-content 函数 -->
            <el-tree
              style="max-width: 600px"
              :data="righsList"
              :props="defaultProps"
              :default-expand-all="true"
              :render-content="renderContent"
            />
          </template>
        </el-popover>
      </template>
    </el-table-column>

    <!-- 按钮也使用：自定义表单 -->
    <el-table-column label="操作" min-width="200">
      <template #default="scope">
        <el-button size="small" type="primary" round @click="handleUpdate(scope.row)">更新</el-button>
        <!-- popconfirm 气泡确认框 -->
        <el-popconfirm
          title="你确定要删除吗?"
          @confirm="handleDelete(scope.row.id)"
          confirm-button-text="确定"
          cancel-button-text="取消"
        >
          <template #reference>
            <el-button size="small" type="danger" round>删除</el-button>
          </template>
        </el-popconfirm>
      </template>
    </el-table-column>
  </el-table>

  <!-- dialog 对话框组件 -->
  <el-dialog v-model="dialogVisible" title="更新角色" width="400px">
    <!-- label-width="80px" 避免左侧宽度太宽 -->
    <el-form ref="updateFormRef" :model="updateForm" :rules="rules" label-width="80px" class="ruleForm" status-icon>
      <el-form-item label="角色名称" prop="roleName">
        <el-input v-model="updateForm.roleName" />
      </el-form-item>
      <el-form-item label="角色权限" prop="rights">
        <!-- Tree 树形控件：show-checkbox 变成可选节点，做默认选中必须设置node-key值唯一; :check-strictly="true" 父子不关联 -->
        <el-tree
          style="max-width: 600px"
          :data="righsList"
          :props="defaultProps"
          :default-expand-all="true"
          show-checkbox
          node-key="path"
          ref="treeRef"
          :check-strictly="true"
        />
      </el-form-item>
    </el-form>

    <template #footer>
      <div class="dialog-footer">
        <el-button @click="dialogVisible = false">取消</el-button>
        <el-button type="primary" @click="handleConfirm"> 更新 </el-button>
      </div>
    </template>
  </el-dialog>
</template>

<script setup>
import { onMounted, reactive, ref, nextTick } from "vue"
import axios from "axios"
import { ElMessage } from "element-plus"

const tableData = ref([])
const righsList = ref([])
const defaultProps = {
  children: "children",
  label: "title", // rights 中的元素的 title
}
onMounted(() => {
  getList()
  getRightList()
})
const getList = async () => {
  let res = await axios.get("/admin/roles/list")
  console.log(res.data)
  tableData.value = res.data
}
const getRightList = async () => {
  let res = await axios.get("/admin/rights/list")
  console.log(res.data)
  righsList.value = res.data
}

/* -------------------- Tree 树形控件:鼠标移入显示的位置 start -------------------- */
// 进入动画前，解构 rights，就知道当前用户是哪些权限菜单
const currentRights = ref([])
const handleHover = ({ rights }) => {
  //console.log("rights:", rights)
  currentRights.value = rights
}
// Tree 树形控件：自定义节点 的渲染方法
const renderContent = (h, { node, data }) => {
  //console.log("data->", data)  // data 是当前 scope.row 对象，data.path 可以取到权限路径
  return h(
    "span",
    {
      // 判断权限包含添加 active 控制对应权限着色，结合 style 样式
      class: `custom-tree-node ${currentRights.value.includes(data.path) ? "active" : ""}`,
    },
    [h("span", null, node.label)]
  )
}
/* -------------------- Tree 树形控件:鼠标移入显示的位置 end -------------------- */

// 更新 按钮回调
const handleUpdate = item => {
  //console.log(item)
  dialogVisible.value = true
  updateForm.roleName = item.roleName //回显角色名到输入框
  currentItem.value = item  //用于请求更新接口传参
  // 设置 rights 权限列表给 tree - 注意：此时 dialog 对话框还未创建出来，使用 nextTick 等其dom渲染后即可
  nextTick(() => {
    treeRef.value.setCheckedKeys(JSON.parse(item.rights)) //json字符串转为json对象
  })
}
// 更新对话框弹窗 form表单所需
const dialogVisible = ref(false)
const updateFormRef = ref()
const currentItem = ref({})
const updateForm = reactive({
  roleName: "",
})
const rules = reactive({
  roleName: [{ required: true, message: "请输入角色名称", trigger: "blur" }],
})
/* -------------------- Tree 树形控件:更新弹窗里的可选树位置 start -------------------- */
const treeRef = ref()
/* -------------------- Tree 树形控件:更新弹窗里的可选树位置 end -------------------- */
const handleConfirm = async () => {
  //getCheckedKeys() 获取选中的节点值，是个数组
  //console.log(updateForm.roleName, treeRef.value.getCheckedKeys());
  let res = await axios.put(`/admin/roles/${currentItem.value.id}`, {
    roleName: updateForm.roleName,
    rights: JSON.stringify(treeRef.value.getCheckedKeys()),
  })
  dialogVisible.value = false //关闭对话框弹窗

  if (!res.data.code) {
    ElMessage({
      //成功提示 Message 消息组件
      message: res.data.msg,
      type: "success",
    })
    getList() //对话框消失再获取并更新一次列表
  } else {
    ElMessage.error(res.data.msg)
  }
}

// 删除 按钮回调
const handleDelete = async id => {
  await axios.delete(`/admin/roles/${id}`)
  await getList() //气泡对话框消失再获取并更新一次列表
  ElMessage({
    message: "删除成功！",
    type: "success",
  })
}
</script>

<style lang="scss" scoped>
:deep(.active) {
  color: #c45656;
}
</style>
```

##### 效果

![image-20260109115937617](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260109115938568.png)

![image-20260109115919677](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260109115920977.png)



### 1.14 UserList 用户列表

UserList.vue - 增删改查完整逻辑。

```vue
<template>
  <!-- Button 按钮组件 -->
  <el-button type="primary" @click="handleAdd">添加用户</el-button>
  <!-- Table 表格组件: 树形展开 row-key="唯一属性" -->
  <el-table :data="tableData" style="width: 100%">
    <!-- <el-table-column prop="roleName" label="角色名称" min-width="200" /> -->
    <el-table-column prop="id" label="编号" />
    <el-table-column prop="username" label="用户名" min-width="200" />
    <el-table-column label="角色名称" min-width="200">
      <template #default="scope">
        <div>{{ scope.row.role.roleName }}</div>
      </template>
    </el-table-column>

    <!-- 按钮也使用：自定义表单 -->
    <el-table-column label="操作" min-width="200">
      <template #default="scope">
        <el-button
          size="small"
          type="primary"
          round
          @click="handleUpdate(scope.row)"
          :disabled="scope.row.isDefault ? true : false"
          >更新</el-button
        >
        <!-- popconfirm 气泡确认框 -->
        <el-popconfirm
          title="你确定要删除吗?"
          @confirm="handleDelete(scope.row.id)"
          confirm-button-text="确定"
          cancel-button-text="取消"
        >
          <template #reference>
            <el-button size="small" type="danger" round :disabled="scope.row.isDefault ? true : false">删除</el-button>
          </template>
        </el-popconfirm>
      </template>
    </el-table-column>
  </el-table>

  <!-- dialog 对话框组件-新增 -->
  <el-dialog v-model="dialogVisible" title="添加用户" width="500px">
    <!-- label-width="100px" 避免左侧宽度太宽 -->
    <el-form ref="addFormRef" :model="addForm" :rules="rules" label-width="100px" class="ruleForm" status-icon>
      <el-form-item label="用户名" prop="username">
        <el-input v-model="addForm.username" />
      </el-form-item>
      <el-form-item label="密码" prop="password">
        <el-input v-model="addForm.password" type="password" />
      </el-form-item>
      <!-- select 选择器组件：用于选择角色下拉框 -->
      <el-form-item label="选择角色" prop="roleId">
        <el-select v-model="addForm.roleId" placeholder="请选择角色" style="width: 100%">
          <el-option v-for="item in roleList" :key="item.id" :label="item.roleName" :value="item.id" />
        </el-select>
      </el-form-item>
    </el-form>

    <template #footer>
      <div class="dialog-footer">
        <el-button @click="dialogVisible = false">取消</el-button>
        <el-button type="primary" @click="handleAddConfirm"> 确定 </el-button>
      </div>
    </template>
  </el-dialog>

  <!-- dialog 对话框组件-更新 -->
  <el-dialog v-model="dialogUpdateVisible" title="更新用户" width="500px">
    <!-- label-width="100px" 避免左侧宽度太宽 -->
    <el-form ref="updateFormRef" :model="updateForm" :rules="rules" label-width="100px" class="ruleForm" status-icon>
      <el-form-item label="用户名" prop="username">
        <el-input v-model="updateForm.username" />
      </el-form-item>
      <el-form-item label="密码" prop="password">
        <el-input v-model="updateForm.password" type="password" />
      </el-form-item>
      <!-- select 选择器组件：用于选择角色下拉框 -->
      <el-form-item label="选择角色" prop="roleId">
        <el-select v-model="updateForm.roleId" placeholder="请选择角色" style="width: 100%">
          <el-option v-for="item in roleList" :key="item.id" :label="item.roleName" :value="item.id" />
        </el-select>
      </el-form-item>
    </el-form>

    <template #footer>
      <div class="dialog-footer">
        <el-button @click="dialogUpdateVisible = false">取消</el-button>
        <el-button type="primary" @click="handleUpdateConfirm"> 更新 </el-button>
      </div>
    </template>
  </el-dialog>
</template>

<script setup>
import { onMounted, reactive, ref, nextTick } from "vue"
import axios from "axios"
import { ElMessage } from "element-plus"

/* -------------------- 列表 start -------------------- */
const tableData = ref([])
const roleList = ref([])
onMounted(() => {
  getList()
  getRoleList()
})
const getList = async () => {
  let res = await axios.get("/admin/users/list")
  console.log("res.data users->", res.data)
  tableData.value = res.data
}
/* -------------------- 列表 end -------------------- */

/* -------------------- 新增 start -------------------- */
const dialogVisible = ref(false)
const addFormRef = ref()
const addForm = reactive({
  username: "",
  password: "",
  roleId: "",
})
const rules = reactive({
  username: [{ required: true, message: "请输入用户名", trigger: "blur" }],
  password: [{ required: true, message: "请输入密码", trigger: "blur" }],
  roleId: [{ required: true, message: "请选择角色", trigger: "blur" }],
})
const handleAdd = () => {
  dialogVisible.value = true
}

const getRoleList = async () => {
  let res = await axios.get("/admin/roles/list")
  console.log("res.data roles->", res.data)
  roleList.value = res.data
}

const handleAddConfirm = () => {
  addFormRef.value.validate(async valid => {
    if (valid) {
      console.log(addForm) //新增的对象，如 {username: 'aaa', password: '123', roleId: 2}
      dialogVisible.value = false //关闭弹窗
      const res = await axios.post("/admin/users/add", addForm)
      if (!res.data.code) {
        addForm.username = ""
        addForm.password = ""
        ElMessage({
          message: "添加成功！",
          type: "success",
        })
        getList()
      }
    } else {
      console.log(valid) //false
    }
  })
}
/* -------------------- 新增 end -------------------- */

/* -------------------- 更新 start -------------------- */
const dialogUpdateVisible = ref(false)
const updateFormRef = ref()
const currentItem = ref({})
const updateForm = reactive({
  username: "",
  password: "",
  roleId: "",
})
// 弹出更新 form dialog 对话框
const handleUpdate = row => {
  //显示更新对话框
  dialogUpdateVisible.value = true
  //updateForm 更新
  updateForm.username = row.username
  updateForm.password = row.password
  updateForm.roleId = row.roleId

  //currentItem id
  currentItem.value = row
}
// 关闭 对话框，请求接口更新数据，刷新列表，弹 message 成功与失败
const handleUpdateConfirm = async () => {
  dialogUpdateVisible.value = false
  const res = await axios.put(`/admin/users/${currentItem.value.id}`, updateForm)
  commonMessage(res)
}
/* -------------------- 更新 end -------------------- */

/* -------------------- 删除 start -------------------- */
const handleDelete = async id => {
  const res = await axios.delete(`/admin/users/${id}`)
  commonMessage(res)
}
/* -------------------- 删除 end -------------------- */

// 通用 Message 组件：成功(+刷新列表) or 失败
const commonMessage = async (res) => {
  if (!res.data.code) {
    await getList()
    ElMessage({
      message: res.data.msg,
      type: "success",
    })
  } else {
    ElMessage(res.data.msg)
  }
}
</script>
```

##### 效果

![image-20260109164432301](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260109164433965.png)

![image-20260109164443631](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260109164444922.png)

![image-20260109164507593](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260109164508936.png)



### 1.15 AddLab 添加实验室-蚂蚁地理空间

AddLab.vue - 核心技术点

* 蚂蚁地理空间 `平面区域标注` 图表的基本使用
  * 修改背景图、点击弹出 `Popup 信息窗`、弹出 `Form 表单提交`窗、`遍历添加文本标注`、**坐标位置定位(鼠标点击位置 x,y 倍数计算)**等
* 数据流的处理逻辑

```vue
<template>
  <div>
    <div style="min-height: 1000px; justify-content: center; position: relative" id="map" />

    <!-- dialog 对话框组件-新增 -->
    <el-dialog v-model="dialogVisible" title="添加实验室" width="500px">
      <!-- label-width="100px" 避免左侧宽度太宽 -->
      <el-form ref="addFormRef" :model="addForm" :rules="rules" label-width="100px" class="ruleForm" status-icon>
        <el-form-item label="实验室名称" prop="title">
          <el-input v-model="addForm.title" />
        </el-form-item>
        <el-form-item label="容纳人数" prop="capacity">
          <el-input v-model="addForm.capacity" type="number" />
        </el-form-item>
        <!-- select 选择器组件：用于选择角色下拉框 -->
        <el-form-item label="实验室类型" prop="labType">
          <el-select v-model="addForm.labType" placeholder="请选择实验室类型" style="width: 100%">
            <el-option v-for="item in labTypes" :key="item.value" :label="item.label" :value="item.value" />
          </el-select>
        </el-form-item>
        <!-- select 选择器组件：用于选择角色下拉框 -->
        <el-form-item label="所属学院" prop="collegeType">
          <el-select v-model="addForm.collegeType" placeholder="请选择所属学院" style="width: 100%">
            <el-option v-for="item in collegeTypes" :key="item.value" :label="item.label" :value="item.value" />
          </el-select>
        </el-form-item>
      </el-form>

      <template #footer>
        <div class="dialog-footer">
          <el-button @click="dialogVisible = false">取消</el-button>
          <el-button type="primary" @click="handleAddConfirm"> 确定 </el-button>
        </div>
      </template>
    </el-dialog>
  </div>
</template>
<script setup>
import { onMounted, ref, reactive } from "vue"
import { ImageLayer, Scene, Popup, PointLayer } from "@antv/l7"
import { Map } from "@antv/l7-maps"
import { collegeTypes, labTypes } from "../../util/type"
import axios from "axios"
import { ElMessage } from "element-plus"

let scene, popup
onMounted(() => {
  scene = new Scene({
    id: "map",
    // 新增：Canvas 渲染参数，消除 willReadFrequently 警告
    renderer: {
      type: "canvas", // 指定渲染器类型为 Canvas
      options: {
        willReadFrequently: true, // 开启高频读取优化
      },
    },
    map: new Map({
      center: [500, 500], //中心坐标位置，用于计算偏移量
      zoom: 3, //放大倍数
      version: "SIMPLE",
      mapSize: 1000, //地图尺寸 1000
      maxZoom: 5, //放大倍数，最大5倍
      minZoom: 2, //放大备注，最小2倍
      pitchEnabled: false, //捏放禁止
      rotateEnabled: false, //旋转禁止
    }),
  })
  scene.setBgColor("rgb(94, 182, 140)")

  //L7 v2.x 用 scene.map 获取地图实例，v3.x 兼容写法
  const mapInstance = scene.getMap ? scene.getMap() : scene.map

  //背景图片层
  const imagelayer = new ImageLayer({}).source("/bg.jpg", {
    parser: {
      type: "image",
      extent: [360, 400, 640, 600],
    },
  })

  // imagelayer 图片层添加信息 Popup 信息窗，绑定 click 事件
  imagelayer.on("click", e => {
    console.log(e) //坐标: (e.x, e.y)  经纬: (e.lngLat.lng, e.lngLat.lat)
    let { lng, lat } = e.lngLat
    popup = new Popup({
      offsets: [0, 0],
      closeButton: false,
    })
      .setLnglat(e.lngLat)
      //.setHTML(`<div>位置:(${e.x}, ${e.y})</div>`)
      //单独给一个 class 样式(偷elementplus的按钮样式)，onclick 事件绑定到 window 对象上
      .setHTML(`<button class="el-button el-button--primary" onclick="add_popup(${lng}, ${lat})">选择位置</button>`)
    scene.addPopup(popup)
  })

  scene.on("loaded", () => {
    //获取已创建的数据，显示在图中
    getList()
    scene.addLayer(imagelayer)
  })
})

const getList = async () => {
  const res = await axios.get("/admin/labs/list")
  console.log(res.data)
  //遍历添加文本标注: .map(item => ({...}))  映射为新的结构
  let list = res.data.map(item => ({
    x: item.x,
    y: item.y,
    t: item.title,
  }))
  addTextLayer(list) //添加文字标注
}

window.add_popup = (lng, lat) => {
  console.log("经纬:", lng, lat)
  //显示输入的对话框
  dialogVisible.value = true
  //关闭 Popup 信息窗
  popup.close()
  // x,y
  addForm.x = 500 + 2.8 * lng
  addForm.y = 500 + 2.8 * lat
}

//添加 - 弹窗
const dialogVisible = ref(false)
const addFormRef = ref()
const defaultForm = {
  title: "",
  capacity: "",
  labType: "",
  collegeType: "",
  x: 0,
  y: 0,
}
const addForm = reactive({ ...defaultForm })
const rules = reactive({
  title: [{ required: true, message: "请输入实验室名称", trigger: "blur" }],
  capacity: [{ required: true, message: "请输入容纳人数", trigger: "blur" }],
  labType: [{ required: true, message: "请选择实验室类型", trigger: "blur" }],
  collegeType: [{ required: true, message: "请选择学院类型", trigger: "blur" }],
})

const handleAddConfirm = () => {
  addFormRef.value.validate(async valid => {
    if (valid) {
      dialogVisible.value = false //关闭对话框
      console.log(addForm)
      //发axios请求
      const res = await axios.post(`/admin/labs/add`, addForm)
      if (!res.data.code) {
        ElMessage({
          message: "添加成功！",
          type: "success",
        })
        addTextLayer([
          {
            x: addForm.x,
            y: addForm.y,
            t: addForm.title,
          },
        ]) //添加文字标注
        //还原 reactive 对象类型中所有字段为初始值
        Object.assign(addForm, defaultForm)
      }
    } else {
      console.log("valid failed")
    }
  })
}

const addTextLayer = data => {
  //将 textlayer 拿过来，修改 data 属性为 [x:x, y:y, t:小屋]
  const textlayer = new PointLayer({ zIndex: 2 })
    .source(
      data,
      // data 的单个数组元素
      // [
      //   {
      //     x: addForm.x, // 2.8倍的计算方法: (x轴最长640 - 中心点500) / 画布最右纬度值 50 ≈ 2.8
      //     y: addForm.y, // 2.8倍的计算方法: (y轴最长400 - 中心点500) / 画布最右经度值-35 ≈ 2.8
      //     t: addForm.title,
      //   },
      // ],
      {
        parser: {
          type: "json",
          x: "x",
          y: "y",
        },
      }
    )
    .shape("t", "text")
    .size(16) //字体大小
    .active({
      color: "#00f",
      mix: 0.9,
    })
    .color("rgb(255, 20, 20)") //文本标注的文本颜色
    .style({
      textAnchor: "center", // 文本相对锚点的位置 center|left|right|top|bottom|top-left
      spacing: 2, // 字符间距
      fontWeight: "800",
      padding: [1, 1], // 文本包围盒 padding [水平，垂直]，影响碰撞检测结果，避免相邻文本靠的太近
      stroke: "#ffffff", // 描边颜色
      strokeWidth: 2, // 描边宽度
      textAllowOverlap: true,
      fontSize: "30",
    })
  scene.addLayer(textlayer)
}
</script>
```

##### 效果

点击地图任意位置

![image-20260110185004510](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260110185006019.png)

【选择位置】

![image-20260110185112776](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260110185114554.png)

![image-20260110185135686](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260110185136987.png)



### 1.16 LabList 实验室列表

LabList.vue - 核心技术点：

* 增删改查的基本显示逻辑、数据流
* el-tag 组件，`动态控制不同的颜色`显示
* dialog 对话框组件中`封装自定义组件`、`全屏显示`、`v-if完全创建和销毁(防止数据残留)`

```vue
<template>
  <div>
    <!-- Table 表格组件: 树形展开 row-key="唯一属性" -->
    <el-table :data="tableData" style="width: 100%">
      <!-- <el-table-column prop="roleName" label="角色名称" min-width="200" /> -->
      <el-table-column label="实验室名称">
        <template #default="scope">
          <!-- Link 组件，类似a标签进行包装，用于预览实验室 -->
          <el-link type="primary" @click="handlePreview(scope.row)">{{ scope.row.title }}</el-link>
        </template>
      </el-table-column>
      <el-table-column label="所属学院" min-width="200">
        <template #default="scope">
          <!-- Tag 组件，可以传入不同的 color 值，让显示不一样 -->
          <el-tag :color="collegeMethod(scope.row.collegeType).color">{{
            collegeMethod(scope.row.collegeType).label
          }}</el-tag>
        </template>
      </el-table-column>
      <el-table-column label="实验室类型" min-width="200">
        <template #default="scope">
          <el-tag :color="labMethod(scope.row.labType).color">{{ labMethod(scope.row.labType).label }}</el-tag>
        </template>
      </el-table-column>
      <el-table-column prop="capacity" label="容纳人数" />

      <!-- 按钮也使用：自定义表单 -->
      <el-table-column label="操作" min-width="200">
        <template #default="scope">
          <el-button
            size="small"
            type="primary"
            round
            @click="handleUpdate(scope.row)"
            :disabled="scope.row.isDefault ? true : false"
            >更新</el-button
          >
          <!-- popconfirm 气泡确认框 -->
          <el-popconfirm
            title="你确定要删除吗?"
            @confirm="handleDelete(scope.row.id)"
            confirm-button-text="确定"
            cancel-button-text="取消"
          >
            <template #reference>
              <el-button size="small" type="danger" round :disabled="scope.row.isDefault ? true : false"
                >删除</el-button
              >
            </template>
          </el-popconfirm>
        </template>
      </el-table-column>
    </el-table>

    <!-- dialog 对话框组件- v-if 对数据进行完全创建和删除，防止数据残留 -->
    <el-dialog v-model="dialogVisible" title="实验室位置" :fullscreen="true" v-if="dialogVisible">
      <!-- 封装自定义组件 -->
      <LabMap :x="currentItem.x" :y="currentItem.y" :t="currentItem.title"></LabMap>
    </el-dialog>

    <!-- dialog 对话框组件-新增 -->
    <el-dialog v-model="dialogUpdateVisible" title="更新实验室" width="500px">
      <!-- label-width="100px" 避免左侧宽度太宽 -->
      <el-form ref="updateFormRef" :model="updateForm" :rules="rules" label-width="100px" class="ruleForm" status-icon>
        <el-form-item label="实验室名称" prop="title">
          <el-input v-model="updateForm.title" />
        </el-form-item>
        <el-form-item label="容纳人数" prop="capacity">
          <!-- 注意：v-model.number 修饰符可以让字段转为 数字 类型 -->
          <el-input v-model.number="updateForm.capacity" type="number" />
        </el-form-item>
        <!-- select 选择器组件：用于选择角色下拉框 -->
        <el-form-item label="实验室类型" prop="labType">
          <el-select v-model="updateForm.labType" placeholder="请选择实验室类型" style="width: 100%">
            <el-option v-for="item in labTypes" :key="item.value" :label="item.label" :value="item.value" />
          </el-select>
        </el-form-item>
        <!-- select 选择器组件：用于选择角色下拉框 -->
        <el-form-item label="所属学院" prop="collegeType">
          <el-select v-model="updateForm.collegeType" placeholder="请选择所属学院" style="width: 100%">
            <el-option v-for="item in collegeTypes" :key="item.value" :label="item.label" :value="item.value" />
          </el-select>
        </el-form-item>
      </el-form>

      <template #footer>
        <div class="dialog-footer">
          <el-button @click="dialogUpdateVisible = false">取消</el-button>
          <el-button type="primary" @click="handleUpdateConfirm"> 确定 </el-button>
        </div>
      </template>
    </el-dialog>
  </div>
</template>

<script setup>
import axios from "axios"
import { onMounted, ref, reactive } from "vue"
import { collegeTypes, labTypes } from "../../util/type"
import LabMap from "../../components/lab-manage/LabMap.vue"
import { ElMessage } from "element-plus"

onMounted(() => {
  getList()
})
const tableData = ref([])
const getList = async () => {
  const res = await axios.get("/admin/labs/list")
  tableData.value = res.data
}

const collegeMethod = value => {
  return collegeTypes.find(item => item.value === value)
}
const labMethod = value => {
  return labTypes.find(item => item.value === value)
}

/* -------------------- 预览 start -------------------- */
//使用 el-link 包裹，弹出一个 el-dialog，进行父传子属性传值，v-if 让 dialog 创建和删除来确保每次数据是全新的
const currentItem = ref({})
const dialogVisible = ref(false)
const handlePreview = row => {
  console.log("row->", row)

  dialogVisible.value = true
  currentItem.value = row
}
/* -------------------- 预览 end -------------------- */

/* -------------------- 更新 start -------------------- */
const dialogUpdateVisible = ref(false)
const updateFormRef = ref()
const defaultForm = {
  title: "",
  capacity: "",
  labType: "",
  collegeType: "",
}
const updateForm = reactive({ ...defaultForm })
const rules = reactive({
  title: [{ required: true, message: "请输入实验室名称", trigger: "blur" }],
  capacity: [{ required: true, message: "请输入容纳人数", trigger: "blur" }],
  labType: [{ required: true, message: "请选择实验室类型", trigger: "blur" }],
  collegeType: [{ required: true, message: "请选择学院类型", trigger: "blur" }],
})

const handleUpdate = (row) => {
  dialogUpdateVisible.value = true

  updateForm.title = row.title
  updateForm.capacity = row.capacity
  updateForm.labType = row.labType
  updateForm.collegeType = row.collegeType

  currentItem.value = row
}

const handleUpdateConfirm = () => {
  updateFormRef.value.validate(async valid => {
    if (valid) {
      dialogUpdateVisible.value = false //关闭对话框
      console.log(updateForm)
      //发axios请求
      const res = await axios.put(`/admin/labs/${currentItem.value.id}`, updateForm)
      commonMessage(res)
    } else {
      console.log("valid failed")
    }
  })
}
/* -------------------- 更新 end -------------------- */

/* -------------------- 删除 start -------------------- */
const handleDelete = async (id) => {
  const res = await axios.delete(`/admin/labs/${id}`)
  commonMessage(res)
}
/* -------------------- 删除 end -------------------- */
// 通用 Message 组件：成功(+刷新列表) or 失败
const commonMessage = async (res) => {
  if (!res.data.code) {
    await getList()
    ElMessage({
      message: res.data.msg,
      type: "success",
    })
  } else {
    ElMessage(res.data.msg)
  }
}
</script>

<style lang="scss" scoped>
:deep(.el-tag) {
  color: white;
}
</style>

```

##### 效果

![image-20260110191547388](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260110191548586.png)



### 1.17 LabMap 自定义组件

LabMap.vue - 核心技术点

* 复用 添加实验室 AddLab 组件的蚂蚁地理空间代码，注意：`在 dialog 对话框中弹窗`出来的，所以 **onMounted 时还不能获取到宽度**，会导致变形，需要 `nextTick()` 即 dom 渲染完就可以解决问题
* 父传子：进行全屏回显、显示具体实验室标注文本

父(LabList.vue)：

```vue
    <!-- dialog 对话框组件- v-if 对数据进行完全创建和删除，防止数据残留 -->
    <el-dialog v-model="dialogVisible" title="实验室位置" :fullscreen="true" v-if="dialogVisible">
      <!-- 封装自定义组件 -->
      <LabMap :x="currentItem.x" :y="currentItem.y" :t="currentItem.title"></LabMap>
    </el-dialog>
```

子(LabMap.vue)：

```vue
<template>
  <div>
    <div style="min-height: 1000px; justify-content: center; position: relative" id="map" />
  </div>
</template>

<script setup>
import { onMounted, nextTick } from "vue"
import { ImageLayer, Scene, PointLayer } from "@antv/l7"
import { Map } from "@antv/l7-maps"

//接收父传子字段
const props = defineProps(["x", "y", "t"])
console.log(props);

let scene
onMounted(() => {
  //因为在 dialog 对话框中弹窗出来的，所以此时还不能获取到宽度，会导致变形，需要 nextTick()渲染完就不会有问题
  console.log(document.getElementById("map").clientWidth) //0
  nextTick(() => {
    scene = new Scene({
      id: "map",
      // 新增：Canvas 渲染参数，消除 willReadFrequently 警告
      renderer: {
        type: "canvas", // 指定渲染器类型为 Canvas
        options: {
          willReadFrequently: true, // 开启高频读取优化
        },
      },
      map: new Map({
        center: [props.x, props.y], //中心坐标位置，用于计算偏移量
        zoom: 5, //放大倍数
        version: "SIMPLE",
        mapSize: 1000, //地图尺寸 1000
        maxZoom: 5, //放大倍数，最大5倍
        minZoom: 2, //放大备注，最小2倍
        pitchEnabled: false, //捏放禁止
        rotateEnabled: false, //旋转禁止
      }),
    })
    scene.setBgColor("rgb(94, 182, 140)")

    //背景图片层
    const imagelayer = new ImageLayer({}).source("/bg.jpg", {
      parser: {
        type: "image",
        extent: [360, 400, 640, 600],
      },
    })

    scene.on("loaded", () => {
      //loaded完直接添加上来当前的这个实验室信息
      addTextLayer([
        {
          x: props.x,
          y: props.y,
          t: props.t,
        },
      ])
      scene.addLayer(imagelayer)
    })
  })
})

const addTextLayer = data => {
  //将 textlayer 拿过来，修改 data 属性为 [x:x, y:y, t:小屋]
  const textlayer = new PointLayer({ zIndex: 2 })
    .source(
      data,
      {
        parser: {
          type: "json",
          x: "x",
          y: "y",
        },
      }
    )
    .shape("t", "text")
    .size(30) //字体大小
    .active({
      color: "#00f",
      mix: 0.9,
    })
    .color("rgb(255, 20, 20)") //文本标注的文本颜色
    .style({
      textAnchor: "center", // 文本相对锚点的位置 center|left|right|top|bottom|top-left
      spacing: 2, // 字符间距
      fontWeight: "800",
      padding: [1, 1], // 文本包围盒 padding [水平，垂直]，影响碰撞检测结果，避免相邻文本靠的太近
      stroke: "#ffffff", // 描边颜色
      strokeWidth: 2, // 描边宽度
      textAllowOverlap: true,
      fontSize: "30",
    })
  scene.addLayer(textlayer)
}
</script>
```

##### 效果

![image-20260110191836696](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260110191837987.png)

### 1.18 AddBook 预约实验室

AddBook.vue - 核心技术点：

* 获取已创建在数据库中的数据遍历标注在图中
* 绑定点击标注文字的事件，弹出 dialog 对话框（对话框中处理对 DatePicker 日期组件的国际化、可选日期范围、select选项的关联禁用）
* 添加预约的数据组装

```vue

```

##### 效果





### 1.99 通用封装

util/type.js - 作为部分写死的常量值（或维护在后端数据库通过接口交互）

```js
const labTypes = [
  {
    label: "物理实验室",
    value: 1,
    color: "#02909d"
  },
  {
    label: "化学实验室",
    value: 2,
    color: "#eb5c20"
  },
  {
    label: "电子设计实验室",
    value: 3,
    color: "#a1d4ba"
  },
  {
    label: "生命科学研究实验室",
    value: 4,
    color: "#d05667"
  },
]

const collegeTypes = [
  {
    label: "理学院",
    value: 1,
    color: "#fbcb4a"
  },
  {
    label: "信息科学工程学院",
    value: 2,
    color: "#14c145"
  },
  {
    label: "经济管理学院",
    value: 3,
    color: "#eedeb0"
  },
  {
    label: "人文学院",
    value: 4,
    color: "#065279"
  },
]

const classTypes = [
  {
    label: "第一节课",
    value: 1
  },
  {
    label: "第二节课",
    value: 2
  },
  {
    label: "第三节课",
    value: 3
  },
  {
    label: "第四节课",
    value: 4
  },
]

export {
    labTypes,
    collegeTypes,
    classTypes
}
```



## 2. 后端架构搭建

```sh
> java --version
java 17.0.7
```

jdk17 兼容 springboot2 和 springboot3，且确保 maven 的 settings.xml 中使用阿里云镜像仓库，以及对 profile 已切换至 jdk17。

### 1.1 创建项目

IDEA - 新建项目

![image-20260108131822624](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260108131824648.png)

![image-20260108132101356](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20260108132102464.png)

配置文件 application.yml (将 .properties 修改为 .yml 配置文件) - 配置服务启动端口和本地数据库

```yaml
server:
  port: 5000

spring:
  # mysql 数据库配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/lab_system
    username: root
    password: 123456

# mybatis 配置映射 xml 文件，并配置打印sql语句
mybatis:
  mapper-locations: classpath:mapper/*Mapper.xml
  configuration:
   log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```



### 1.2 数据库 sql

基于本地数据库: mysql57 (localhost:3306, root, 123456)

> mysql57 服务器的启动和停止：
>
> `net start mysql57` - 启动服务
>
> `net stop mysql57` - 停止服务
>
> `tasklist | findstr /i "mysql"` - 查询 mysqld 进程是否存在（启动才会存在）

添加初始权限菜单数据 sql：

```sql
-- 权限菜单表
CREATE TABLE `rights`
(
    id        INT PRIMARY KEY AUTO_INCREMENT,
    title     VARCHAR(20)  NOT NULL,
    path      VARCHAR(100) NOT NULL,
    icon      VARCHAR(100) NOT NULL,
    parent_id INT     DEFAULT 0, -- 父级菜单id
    is_leaf   TINYINT DEFAULT 0  -- 是否是叶子菜单：0-否，1-是
);

-- 清空表（可选，初始化时使用）
TRUNCATE TABLE rights;

-- 首页
INSERT INTO rights (title, path, icon, parent_id, is_leaf)
VALUES ('首页', '/index', 'HomeFilled', 0, 0);
-- 用户管理 id=2
INSERT INTO rights (title, path, icon, parent_id, is_leaf)
VALUES ('用户管理', '/user-manage', 'User', 0, 0);
-- 插入用户管理的子节点
INSERT INTO rights (title, path, icon, parent_id, is_leaf)
VALUES ('用户列表', '/user-manage/list', 'List', 2, 1);
-- 权限管理 id=4
INSERT INTO rights (title, path, icon, parent_id, is_leaf)
VALUES ('权限管理', '/right-manage', 'Key', 0, 0);
-- 插入权限管理的子节点
INSERT INTO rights (title, path, icon, parent_id, is_leaf)
VALUES ('角色列表', '/right-manage/rolelist', 'List', 4, 1),
       ('权限列表', '/right-manage/rightlist', 'List', 4, 1);
-- 实验室管理 id=7
INSERT INTO rights (title, path, icon, parent_id, is_leaf)
VALUES ('实验室管理', '/lab-manage', 'OfficeBuilding', 0, 0);
-- 插入实验室管理的子节点
INSERT INTO rights (title, path, icon, parent_id, is_leaf)
VALUES ('实验室列表', '/lab-manage/lablist', 'List', 7, 1),
       ('添加实验室', '/lab-manage/addlab', 'List', 7, 1);
-- 预约管理 id=10
INSERT INTO rights (title, path, icon, parent_id, is_leaf)
VALUES ('预约管理', '/book-manage', 'UploadFilled', 0, 0);
-- 插入预约管理的子节点
INSERT INTO rights (title, path, icon, parent_id, is_leaf)
VALUES ('审核列表', '/book-manage/auditlist', 'List', 10, 1),
       ('预约列表', '/book-manage/booklist', 'List', 10, 1),
       ('预约实验室', '/book-manage/addbook', 'List', 10, 1);
```

添加初始角色信息sql：

```sql
-- 角色表
CREATE TABLE roles
(
    id       INT PRIMARY KEY AUTO_INCREMENT,
    roleName VARCHAR(20) NOT NULL,
    roleType INT         NOT NULL,
    rights   JSON        NOT NULL
);

INSERT INTO roles(roleName, roleType, rights)
VALUES ('管理员',
        1,
        '[
          "/index",
          "/user-manage",
          "/user-manage/list",
          "/right-manage",
          "/right-manage/rolelist",
          "/right-manage/rightlist",
          "/lab-manage",
          "/lab-manage/lablist",
          "/lab-manage/addlab",
          "/book-manage",
          "/book-manage/auditlist",
          "/book-manage/booklist"
        ]');


INSERT INTO roles(roleName, roleType, rights)
VALUES ('教师',
        2,
        '[
          "/index",
          "/book-manage",
          "/book-manage/booklist",
          "/book-manage/addbook"
        ]');
```

添加初始用户信息sql：

```sql
-- 用户表
CREATE TABLE users
(
    id         INT PRIMARY KEY AUTO_INCREMENT,
    username   VARCHAR(20) NOT NULL,
    password   VARCHAR(20) NOT NULL,
    roleId     INT         NOT NULL,
    is_default INT DEFAULT '0'
);
INSERT INTO users (username, password, roleId, is_default)
VALUES ('admin', '123', 1, 1);
INSERT INTO users (username, password, roleId)
VALUES ('jerry', '123', 2);
```

添加实验室表sql：

```sql
-- 实验室表
CREATE TABLE labs
(
    id          INT PRIMARY KEY AUTO_INCREMENT,
    title       VARCHAR(20) NOT NULL,
    capacity    INT DEFAULT '0',
    labType     INT DEFAULT '0',
    collegeType INT DEFAULT '0',
    x           INT DEFAULT '0',
    y           INT DEFAULT '0'
);
```

实验室预约表sql：

```sql
-- 预约表
CREATE TABLE books
(
    id           INT PRIMARY KEY AUTO_INCREMENT,
    labId        INT DEFAULT '0',
    bookTime     DATE,
    bookClass    INT DEFAULT '0',
    bookReason   VARCHAR(100) NOT NULL,
    bookUsername VARCHAR(20)  NOT NULL,
    bookState    INT DEFAULT '0' COMMENT '0-审核中, 1-审核通过, 2-驳回'
)
```



### 1.3 通用 Result 封装

pom.xml - 手动添加 lombok

```xml
    <!--添加lombok依赖-->
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
    </dependency>
```

utils/SysConstant.java

```java
public interface SysConstant {
    Integer CODE_SUCCESS = 0;
    Integer CODE_ERROR = -1;
    String ADD_SUCCESS = "添加成功";
    String ADD_ERROR = "添加失败";
    String UPDATE_SUCCESS = "更新成功";
    String UPDATE_ERROR = "更新失败";
    String DELETE_SUCCESS = "删除成功";
    String DELETE_ERROR = "删除失败";
    String LOGIN_SUCCESS = "登陆成功";
    String LOGIN_ERROR = "登录失败";
}
```

utils/ResultObj.java

```java
import lombok.Data;

@Data
public class ResultObj {
    private Integer code;
    private String msg;
    private Object data;

    public ResultObj(Integer code) {
        this.code = code;
    }

    public ResultObj(Integer code, String msg) {
        this.code = code;
        this.msg = msg;
    }

    public ResultObj(Integer code, String msg, Object data) {
        this.code = code;
        this.msg = msg;
        this.data = data;
    }

    public static final ResultObj ADD_SUCCESS = new ResultObj(SysConstant.CODE_SUCCESS, SysConstant.ADD_SUCCESS);
    public static final ResultObj ADD_ERROR = new ResultObj(SysConstant.CODE_ERROR, SysConstant.ADD_ERROR);

    public static final ResultObj UPDATE_SUCCESS = new ResultObj(SysConstant.CODE_SUCCESS, SysConstant.UPDATE_SUCCESS);
    public static final ResultObj UPDATE_ERROR = new ResultObj(SysConstant.CODE_ERROR, SysConstant.UPDATE_ERROR);

    public static final ResultObj DELETE_SUCCESS = new ResultObj(SysConstant.CODE_SUCCESS, SysConstant.DELETE_SUCCESS);
    public static final ResultObj DELETE_ERROR = new ResultObj(SysConstant.CODE_ERROR, SysConstant.DELETE_ERROR);
}
```

### 1.4 权限接口

接口规范化：[Apifox接口文档一体化协作平台](https://yuancodes.github.io/#/./15_分布式/00_Api文档/03-Apifox接口文档一体化协作平台?id=apifox接口文档一体化协作平台)

#### controller

pojo/Right.java

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Right {
    private Integer id;
    private String title;
    private String icon;
    private String path;
    private List<Right> children;
}
```

controller/RightController.java

```java
@RestController
@RequestMapping("/admin/rights")
public class RightController {
    @Autowired
    private RightService<Right> rightService;

    @GetMapping("/list")
    public List<Right> getRightList() {
        return rightService.getRightList();
    }

    // /admin/rights/3
    @PutMapping(value = "/{id}")
    public ResultObj updateRightList(@PathVariable Integer id, @RequestBody Right right) {
        try {
            right.setId(id);
            rightService.updateRightList(right);
            return ResultObj.UPDATE_SUCCESS;
        } catch (Exception e) {
            return ResultObj.UPDATE_ERROR;
        }
    }

    @DeleteMapping(value = "/{id}")
    public ResultObj deleteRightList(@PathVariable Integer id) {
        try {
            rightService.deleteRightList(id);
            return ResultObj.DELETE_SUCCESS;
        } catch (Exception e) {
            return ResultObj.DELETE_ERROR;
        }
    }
}
```

#### service

service/RightService.java

```java
public interface RightService<Right> {
    List<Right> getRightList();
    void updateRightList(Right right);
    void deleteRightList(Integer id);
}
```

service/impl/RightServiceImpl.java

```java
@Service
public class RightServiceImpl implements RightService<Right> {
    @Autowired
    private RightMapper<Right> rightMapper;

    @Override
    public List<Right> getRightList() {
        return rightMapper.getRightList();
    }

    @Override
    public void updateRightList(Right right) {
        rightMapper.updateRightList(right);
    }

    @Override
    public void deleteRightList(Integer id) {
        rightMapper.deleteRightList(id);
    }
}
```

#### dao

dao/RightMapper.java

```java
@Mapper
public interface RightMapper<Right> {
    List<Right> getRightList();
    boolean updateRightList(Right right);
    void deleteRightList(Integer id);
}
```

resources/mapper/RightMapper.xml

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jerry.labsystem.dao.RightMapper">
    <resultMap id="menuTree" type="com.jerry.labsystem.pojo.Right">
        <id column="id" property="id"/>
        <id column="title" property="title"/>
        <id column="path" property="path"/>
        <id column="icon" property="icon"/>
        <!-- 将 children 通过 select 方法注入进来，list 列表就会附带 children 返回 -->
        <collection property="children" select="getMenuChildren" ofType="com.jerry.labsystem.pojo.Right"
                    column="id"/>
    </resultMap>

    <select id="getMenuChildren" resultMap="menuTree">
        SELECT id, title, path, icon
        FROM rights
        WHERE parent_id = #{parentId}
    </select>

    <select id="getRightList" resultMap="menuTree">
        SELECT *
        FROM rights
        WHERE parent_id = 0
    </select>

    <update id="updateRightList">
        update rights
        <set>
            <if test="title != null">
                title = #{title},
            </if>
            <if test="icon != null">
                icon = #{icon}
            </if>
        </set>
        where id = #{id}
    </update>

    <delete id="deleteRightList">
        DELETE
        FROM rights
        WHERE id = #{id}
    </delete>
</mapper>
```



### 1.5 角色接口

接口规范化：[Apifox接口文档一体化协作平台](https://yuancodes.github.io/#/./15_分布式/00_Api文档/03-Apifox接口文档一体化协作平台?id=apifox接口文档一体化协作平台)

#### controller

pojo/Role.java

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Role {
    private Integer id;
    private String roleName;
    private Integer roleType;
    private String rights;
}
```

controller/RoleController.java

```java
@RestController
@RequestMapping("/admin/roles")
public class RoleController {
    @Autowired
    private RoleService<Role> roleService;

    @GetMapping("/list")
    public List<Role> getRoleList() {
        return roleService.getRoleList();
    }

    // /admin/rols/3
    @PutMapping(value = "/{id}")
    public ResultObj updateRoleList(@PathVariable Integer id, @RequestBody Role role) {
        try {
            role.setId(id);
            roleService.updateRoleList(role);
            return ResultObj.UPDATE_SUCCESS;
        } catch (Exception e) {
            return ResultObj.UPDATE_ERROR;
        }
    }

    @DeleteMapping(value = "/{id}")
    public ResultObj deleteRoleList(@PathVariable Integer id) {
        try {
            roleService.deleteRoleList(id);
            return ResultObj.DELETE_SUCCESS;
        } catch (Exception e) {
            return ResultObj.DELETE_ERROR;
        }
    }
}
```



#### service

service/RoleService.java

```java
public interface RoleService<Role> {
    List<Role> getRoleList();
    void updateRoleList(Role role);
    void deleteRoleList(Integer id);
}
```

service/impl/RoleServiceImpl.java

```java
@Service
public class RoleServiceImpl implements RoleService<Role> {
    @Autowired
    private RoleMapper<Role> roleMapper;

    @Override
    public List<Role> getRoleList() {
        return roleMapper.getRoleList();
    }

    @Override
    public void updateRoleList(Role role) {
        roleMapper.updateRoleList(role);
    }

    @Override
    public void deleteRoleList(Integer id) {
        roleMapper.deleteRoleList(id);
    }
}
```



#### dao

dao/RoleMapper.java

```java
@Mapper
public interface RoleMapper<Role> {
    List<Role> getRoleList();
    void updateRoleList(Role role);
    void deleteRoleList(Integer id);
}
```

resources/mapper/RoleMapper.xml

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jerry.labsystem.dao.RoleMapper">
    <resultMap id="menuTree" type="com.jerry.labsystem.pojo.Role">
        <id column="id" property="id"/>
        <id column="roleName" property="roleName"/>
        <id column="roleType" property="roleType"/>
        <id column="rights" property="rights"/>
    </resultMap>

    <select id="getRoleList" resultMap="menuTree">
        SELECT id, roleName, roleType, rights
        FROM roles
    </select>

    <update id="updateRoleList">
        update roles
        <set>
            <if test="roleName != null">
                roleName = #{roleName},
            </if>
            <if test="rights != null">
                rights = #{rights}
            </if>
        </set>
        where id = #{id}
    </update>

    <delete id="deleteRoleList">
        DELETE
        FROM roles
        WHERE id = #{id}
    </delete>
</mapper>
```

### 1.6 用户接口

#### controller

pojo/User.java

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class User {
    private Integer id;
    private String username;
    private String password;
    private Integer roleId;
    private Integer isDefault;
    private Role role;
}
```

controller/UserController.java - 包含模拟登陆的 /login 接口。

```java
@RestController
@RequestMapping("/admin/users")
public class UserController {
    @Autowired
    private UserService<User> userService;

    @GetMapping("/list")
    public List<User> getUserList(User user) {
        return userService.getUserList(user);
    }

    @PostMapping("/add")
    public ResultObj addUserList(@RequestBody User user) {
        try {
            userService.addUserList(user);
            return ResultObj.ADD_SUCCESS;
        } catch (RuntimeException e) {
            return ResultObj.ADD_ERROR;
        }
    }

    // /admin/rols/3
    @PutMapping(value = "/{id}")
    public ResultObj updateUserList(@PathVariable Integer id, @RequestBody User user) {
        try {
            user.setId(id);
            userService.updateUserList(user);
            return ResultObj.UPDATE_SUCCESS;
        } catch (Exception e) {
            return ResultObj.UPDATE_ERROR;
        }
    }

    @DeleteMapping(value = "/{id}")
    public ResultObj deleteUserList(@PathVariable Integer id) {
        try {
            userService.deleteUserList(id);
            return ResultObj.DELETE_SUCCESS;
        } catch (Exception e) {
            return ResultObj.DELETE_ERROR;
        }
    }

    @PostMapping("/login")
    public ResultObj login(@RequestBody User user) {
        try {
            List<User> userList = userService.getUserList(user);
            if (CollectionUtils.isEmpty(userList)) {
                throw new RuntimeException();
            }
            return new ResultObj(SysConstant.CODE_SUCCESS, SysConstant.LOGIN_SUCCESS, userList.get(0));
        } catch (RuntimeException e) {
            return new ResultObj(SysConstant.CODE_ERROR, SysConstant.LOGIN_ERROR);
        }
    }
}
```



#### service

service/UserService.java

```java
public interface UserService<User> {
    List<User> getUserList(User user);
    void updateUserList(User user);
    void deleteUserList(Integer id);
    void addUserList(User user);
}
```

service/impl/UserServiceImpl.java

```java
@Service
public class UserServiceImpl implements UserService<User> {
    @Autowired
    private UserMapper<User> userMapper;

    @Override
    public List<User> getUserList(User user) {
        return userMapper.getUserList(user);
    }

    @Override
    public void updateUserList(User user) {
        userMapper.updateUserList(user);
    }

    @Override
    public void deleteUserList(Integer id) {
        userMapper.deleteUserList(id);
    }

    @Override
    public void addUserList(User user) {
        userMapper.addUserList(user);
    }
}
```



#### dao

dao/UserMapper.java

```java
@Mapper
public interface UserMapper<User> {
    List<User> getUserList(User user);
    void updateUserList(User user);
    void deleteUserList(Integer id);
    void addUserList(User user);
}
```

resources/mapper/UserMapper.xml

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jerry.labsystem.dao.UserMapper">
    <resultMap id="result" type="com.jerry.labsystem.pojo.User">
        <id column="id" property="id"/>
        <result column="username" property="username"/>
        <result column="roleId" property="roleId"/>
        <result column="is_default" property="isDefault"/>
        <!-- 将 role 对象通过 select 方法注入进来 -->
        <association property="role" select="getRole" column="roleId" javaType="com.jerry.labsystem.pojo.Role" />
    </resultMap>

    <select id="getRole" resultType="com.jerry.labsystem.pojo.Role">
        SELECT *
        FROM roles
        WHERE id = #{any_id}
    </select>

    <select id="getUserList" resultMap="result">
        SELECT id, username, roleId, is_default
        FROM users
        <where>
            1 = 1
            <if test="username != null">
                and username = #{username}
            </if>
            <if test="password != null">
                and password = #{password}
            </if>
            <if test="roleId != null">
                and roleId = #{roleId}
            </if>
            <if test="isDefault != null">
                and is_default = #{isDefault}
            </if>
        </where>
    </select>

    <update id="updateUserList">
        update users
        <set>
            <if test="username != null">
                username = #{username},
            </if>
            <if test="password != null">
                password = #{password},
            </if>
            <if test="roleId != null">
                roleId = #{roleId},
            </if>
            <if test="isDefault != null">
                is_default = #{isDefault},
            </if>
        </set>
        where id = #{id}
    </update>

    <delete id="deleteUserList">
        DELETE
        FROM users
        WHERE id = #{id}
    </delete>

    <insert id="addUserList" parameterType="com.jerry.labsystem.pojo.User">
        INSERT INTO users
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="username != null">
                username,
            </if>
            <if test="password != null">
                password,
            </if>
            <if test="roleId != null">
                roleId,
            </if>
        </trim>
        <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
            <if test="username != null">
                #{username},
            </if>
            <if test="password != null">
                #{password},
            </if>
            <if test="roleId != null">
                #{roleId},
            </if>
        </trim>
    </insert>
</mapper>
```



### 1.7 实验室接口

#### controller

pojo/Lab.java

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Lab {
    private Integer id;
    private String title;
    private Integer capacity;
    private Integer labType;
    private Integer collegeType;
    private Integer x;
    private Integer y;
}
```

controller/LabController.java

```java
@RestController
@RequestMapping("/admin/labs")
public class LabController {
    @Autowired
    private LabService<Lab> labService;

    @GetMapping("/list")
    public List<Lab> getLabList(Lab lab) {
        return labService.getLabList(lab);
    }

    @PostMapping("/add")
    public ResultObj addLabList(@RequestBody Lab lab) {
        try {
            labService.addLabList(lab);
            return ResultObj.ADD_SUCCESS;
        } catch (RuntimeException e) {
            return ResultObj.ADD_ERROR;
        }
    }

    // /admin/rols/3
    @PutMapping(value = "/{id}")
    public ResultObj updateLabList(@PathVariable Integer id, @RequestBody Lab lab) {
        try {
            lab.setId(id);
            labService.updateLabList(lab);
            return ResultObj.UPDATE_SUCCESS;
        } catch (Exception e) {
            return ResultObj.UPDATE_ERROR;
        }
    }

    @DeleteMapping(value = "/{id}")
    public ResultObj deleteLabList(@PathVariable Integer id) {
        try {
            labService.deleteLabList(id);
            return ResultObj.DELETE_SUCCESS;
        } catch (Exception e) {
            return ResultObj.DELETE_ERROR;
        }
    }
}
```



#### service

service/LabService.java

```java
public interface LabService<Lab> {
    List<Lab> getLabList(Lab lab);
    void updateLabList(Lab lab);
    void deleteLabList(Integer id);
    void addLabList(Lab lab);
}
```

service/impl/LabServiceImpl.java

```java
@Service
public class LabServiceImpl implements LabService<Lab> {
    @Autowired
    private LabMapper<Lab> labMapper;

    @Override
    public List<Lab> getLabList(Lab lab) {
        return labMapper.getLabList(lab);
    }

    @Override
    public void updateLabList(Lab lab) {
        labMapper.updateLabList(lab);
    }

    @Override
    public void deleteLabList(Integer id) {
        labMapper.deleteLabList(id);
    }

    @Override
    public void addLabList(Lab lab) {
        labMapper.addLabList(lab);
    }
}
```



#### dao

dao/LabMapper.java

```java
@Mapper
public interface LabMapper<Lab> {
    List<Lab> getLabList(Lab lab);
    void updateLabList(Lab lab);
    void deleteLabList(Integer id);
    void addLabList(Lab lab);
}
```

resources/mapper/LabMapper.xml

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jerry.labsystem.dao.LabMapper">

    <select id="getLabList" resultType="com.jerry.labsystem.pojo.Lab">
        SELECT *
        FROM labs
        ORDER BY id ASC
    </select>


    <insert id="addLabList" parameterType="com.jerry.labsystem.pojo.Lab">
        INSERT INTO labs
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="title != null">
                title,
            </if>
            <if test="capacity != null">
                capacity,
            </if>
            <if test="labType != null">
                labType,
            </if>
            <if test="collegeType != null">
                collegeType,
            </if>
            <if test="x != null">
                x,
            </if>
            <if test="y != null">
                y,
            </if>
        </trim>
        <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
            <if test="title != null">
                #{title},
            </if>
            <if test="capacity != null">
                #{capacity},
            </if>
            <if test="labType != null">
                #{labType},
            </if>
            <if test="collegeType != null">
                #{collegeType},
            </if>
            <if test="x != null">
                #{x},
            </if>
            <if test="y != null">
                #{y},
            </if>
        </trim>
    </insert>

    <update id="updateLabList">
        update labs
        <set>
            <if test="title != null">
                title = #{title},
            </if>
            <if test="capacity != null">
                capacity = #{capacity},
            </if>
            <if test="labType != null">
                labType = #{labType},
            </if>
            <if test="collegeType != null">
                collegeType = #{collegeType},
            </if>
            <if test="x != null">
                x = #{x},
            </if>
            <if test="y != null">
                y = #{y},
            </if>
        </set>
        where id = #{id}
    </update>

    <delete id="deleteLabList">
        DELETE
        FROM labs
        WHERE id = #{id}
    </delete>
</mapper>
```





### 1.8 预约实验室接口

#### controller

pojo/Book.java
```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Book {
    private Integer id;
    private Integer labId;
    private Date bookTime;
    private Integer bookClass;
    private String bookUsername;
    private String bookReason;
    private Integer bookState;
    private Lab lab;
}
```
controller/BookController.java
```java
@RestController
@RequestMapping("/admin/books")
public class BookController {
    @Autowired
    private BookService<Book> labService;

    @GetMapping("/list")
    public List<Book> getBookList(Book book) {
        return labService.getBookList(book);
    }

    @PostMapping("/add")
    public ResultObj addBookList(@RequestBody Book book) {
        try {
            labService.addBookList(book);
            return ResultObj.ADD_SUCCESS;
        } catch (RuntimeException e) {
            return ResultObj.ADD_ERROR;
        }
    }

    @PostMapping("/select")
    public List<Book> selectBookList(@RequestBody Book book) {
        return labService.getBookList(book);
    }

    // /admin/rols/3
    @PutMapping(value = "/{id}")
    public ResultObj updateBookList(@PathVariable Integer id, @RequestBody Book book) {
        try {
            book.setId(id);
            labService.updateBookList(book);
            return ResultObj.UPDATE_SUCCESS;
        } catch (Exception e) {
            return ResultObj.UPDATE_ERROR;
        }
    }

    @DeleteMapping(value = "/{id}")
    public ResultObj deleteBookList(@PathVariable Integer id) {
        try {
            labService.deleteBookList(id);
            return ResultObj.DELETE_SUCCESS;
        } catch (Exception e) {
            return ResultObj.DELETE_ERROR;
        }
    }
}
```

#### service

service/BookService.java
```java
public interface BookService<Book> {
    List<Book> getBookList(Book book);
    void updateBookList(Book book);
    void deleteBookList(Integer id);
    void addBookList(Book book);
}
```
service/impl/BookServiceImpl.java
```java
@Service
public class BookServiceImpl implements BookService<Book> {
    @Autowired
    private BookMapper<Book> bookMapper;

    @Override
    public List<Book> getBookList(Book book) {
        return bookMapper.getBookList(book);
    }

    @Override
    public void updateBookList(Book book) {
        bookMapper.updateBookList(book);
    }

    @Override
    public void deleteBookList(Integer id) {
        bookMapper.deleteBookList(id);
    }

    @Override
    public void addBookList(Book book) {
        bookMapper.addBookList(book);
    }
}
```

#### dao

dao/BookMapper.java
```java
@Mapper
public interface BookMapper<Book> {
    List<Book> getBookList(Book book);
    void updateBookList(Book book);
    void deleteBookList(Integer id);
    void addBookList(Book book);
}
```
resources/mapper/BookMapper.xml
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jerry.labsystem.dao.BookMapper">

    <select id="getBookList" resultType="com.jerry.labsystem.pojo.Book">
        SELECT *
        FROM books
        <where>
            <if test="labId != null">
                and labId = #{labId}
            </if>
            <if test="bookTime != null">
                and bookTime = #{bookTime}
                and bookState != 2
            </if>
        </where>
        ORDER BY bookTime, bookClass ASC
    </select>

    <insert id="addBookList" parameterType="com.jerry.labsystem.pojo.Book">
        INSERT INTO books
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="labId != null">
                labId,
            </if>
            <if test="bookTime != null">
                bookTime,
            </if>
            <if test="bookClass != null">
                bookClass,
            </if>
            <if test="bookReason != null">
                bookReason,
            </if>
            <if test="bookUsername != null">
                bookUsername,
            </if>
            <if test="bookState != null">
                bookState,
            </if>
        </trim>
        <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
            <if test="labId != null">
                #{labId},
            </if>
            <if test="bookTime != null">
                #{bookTime},
            </if>
            <if test="bookClass != null">
                #{bookClass},
            </if>
            <if test="bookReason != null">
                #{bookReason},
            </if>
            <if test="bookUsername != null">
                #{bookUsername},
            </if>
            <if test="bookState != null">
                #{bookState},
            </if>
        </trim>
    </insert>

    <update id="updateBookList">
        update books
        <set>
            <if test="labId != null">
                labId = #{labId},
            </if>
            <if test="bookTime != null">
                bookTime = #{bookTime},
            </if>
            <if test="bookClass != null">
                bookClass = #{bookClass},
            </if>
            <if test="bookReason != null">
                bookReason = #{bookReason},
            </if>
            <if test="bookUsername != null">
                bookUsername = #{bookUsername},
            </if>
            <if test="bookState != null">
                bookState = #{bookState},
            </if>
        </set>
        where id = #{id}
    </update>

    <delete id="deleteBookList">
        DELETE
        FROM books
        WHERE id = #{id}
    </delete>
</mapper>
```



## 3. 其他问题

### 3.1 反向代理 vite.config.js

vite.config.js - 前后端均可`解决跨域`，在前端可以配置如下反向代理，让请求模拟从本域请求本域，就不会有跨域问题。

```js
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  // 解决跨域问题
  server: {
    proxy: {
      "/admin": {
        target: "http://localhost:5000",
        changeOrigin: true
      }
    }
  }
})
```



### 3.2 蚂蚁地理空间数据可视化

官网：https://l7.antv.antgroup.com/

官网：https://antv-2018.alipay.com/zh-cn/l7/1.x/index.html

官方教程文档：https://www.yuque.com/antv/l7/yzkq8e

安装L7依赖：*npm install --save @antv/l7*

*安装第三方底图依赖*：*npm install --save @antv/l7-maps*

示例图表：

* 平面区域标注：https://l7.antv.antgroup.com/examples/point/text#simplecoordinate
* 添加Pop信息窗：https://l7.antv.antgroup.com/tutorial/quickstart#%E4%BA%A4%E4%BA%92%E5%BC%8F%E5%A1%AB%E5%85%85%E5%9B%BE

demo

```vue
<template>
  <div>
    <div style="min-height: 500px; justify-content: center; position: relative" id="map" />
  </div>
</template>
<script setup>
import { onMounted } from "vue"
import { ImageLayer, PointLayer, Scene } from "@antv/l7"
import { Map } from "@antv/l7-maps"

onMounted(() => {
  const scene = new Scene({
    id: "map",
    map: new Map({
      center: [500, 500],
      zoom: 3,
      version: "SIMPLE",
      mapSize: 1000,
      maxZoom: 5,
      minZoom: 2,
      pitchEnabled: false,
      rotateEnabled: false,
    }),
  })
  scene.setBgColor("rgb(94, 182, 140)")

  const imagelayer = new ImageLayer({}).source(
    "https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*I0X5R4jAUQ4AAAAAAAAAAAAAARQnAQ",
    {
      parser: {
        type: "image",
        extent: [360, 400, 640, 600],
      },
    }
  )

  scene.on("loaded", () => {
    fetch("https://gw.alipayobjects.com/os/bmw-prod/7dc0d454-fabc-4461-a5d5-d404dadb49a9.json")
      .then(res => res.json())
      .then(data => {
        const textlayer = new PointLayer({ zIndex: 2 })
          .source(data, {
            parser: {
              type: "json",
              x: "x",
              y: "y",
            },
          })
          .shape("t", "text")
          .size(12)
          .active({
            color: "#00f",
            mix: 0.9,
          })
          .color("rgb(86, 156, 214)")
          .style({
            textAnchor: "center", // 文本相对锚点的位置 center|left|right|top|bottom|top-left
            spacing: 2, // 字符间距
            fontWeight: "800",
            padding: [1, 1], // 文本包围盒 padding [水平，垂直]，影响碰撞检测结果，避免相邻文本靠的太近
            stroke: "#ffffff", // 描边颜色
            strokeWidth: 2, // 描边宽度
            textAllowOverlap: true,
          })
        scene.addLayer(textlayer)
      })

    scene.addLayer(imagelayer)
  })
})
</script>
```



### 3.3 i18n 国际化

参考官网：https://element-plus.org/zh-CN/guide/i18n#%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE

element-Plus 只需要 main.js 引入 i18n 中文支持即可，比如用于 **日历组件中周几的 中文 显示**（而非英文）。

main.js

```js
import { createApp } from 'vue'
import App from './App.vue'
import ElementPlus from 'element-plus' //导入 element-plus 样式
import 'element-plus/dist/index.css'   //导入 element-plus 样式
import zhCn from 'element-plus/es/locale/lang/zh-cn'  //全局引入国际化

createApp(App)
    .use(ElementPlus, {
        locale: zhCn,
    })                    //使用 element-plus，并添加国际化
    .mount('#app')
```



### 3.x 高德地图位置显示 demo





### 3.y 前后端分页逻辑融合









