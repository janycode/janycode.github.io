---
title: 08-Vue3.0
date: 2018-5-22 21:36:21
tags:
- Vue
- vue3
categories: 
- 04_大前端
- 04_Vue
---

![image-20200723170734421](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20200723170735.png)

参考资料：

* 官网：https://cn.vuejs.org/
* vue2 官方教程：https://v2.cn.vuejs.org/v2/guide/
* vue3 官方教程：https://cn.vuejs.org/guide/introduction.html
* 说明：`Vue 2.0 在 2023 年 12 月 31 日停止更新`。
* vue2 迁移到 vue3：
  * https://developer.aliyun.com/article/1580912
  * https://blog.csdn.net/2301_78858041/article/details/145606078


> 本文全部基于 vue3。

## 1. vue-cli 创建vue3项目

```powershell
vue create my-app-vue3
```

![image-20251229174550313](https://jy-imgs.oss-cn-beijing.aliyuncs.com/img/20251229174551701.png)



## 2. vue3升级调整

升级依赖后，需要对代码进行相应的调整。以下是几个关键的迁移步骤。

### 全局 API 迁移

Vue 3 对全局 API 进行了重构，许多全局方法现在需要通过 `createApp` 实例来调用。

`main.js` & `router/index.js`  & `store/index.js`

Vue 2 示例

```js
import Vue from 'vue';
import App from './App.vue';
import router from './router';
import store from './store';
Vue.config.productionTip = false;
new Vue({
  router,
  store,
  render: h => h(App),
}).$mount('#app');
```

Vue 3 示例

```js
import { createApp } from 'vue';
import App from './App.vue';
import router from './router';
import store from './store';
const app = createApp(App);
app.use(router);
app.use(store);
app.mount('#app');
```

### 实例属性迁移

Vue 2 中的实例属性，如 `$mount` 和 `$destroy`，在 Vue 3 中已经有所变化。

Vue 2 示例

```js
const vm = new Vue({
  // options
});
vm.$mount('#app');
```

Vue 3 示例

```js
const app = createApp({
  // options
});
app.mount('#app');
```

### 事件 API 迁移

Vue 3 删除了 `$on`, `$off`, 和 `$once` 方法，建议使用 mitt[2] 这样的事件库作为替代。

Vue 2 示例

```js
const vm = new Vue();
vm.$on('event', () => {
  // handle event
});
```

Vue 3 示例

```js
import mitt from 'mitt';
const emitter = mitt();
emitter.on('event', () => {
  // handle event
});
```

### 指令迁移

Vue 3 对指令的定义方式进行了调整。

Vue 2 示例

```js
Vue.directive('focus', {
  inserted: function (el) {
    el.focus();
  }
});
```

Vue 3 示例

```js
const app = createApp(App);
app.directive('focus', {
  mounted(el) {
    el.focus();
  }
});
app.mount('#app');
```

### 组件生命周期钩子迁移

Vue 3 对一些生命周期钩子进行了重命名，例如 `beforeDestroy` 改为 `beforeUnmount`，`destroyed` 改为 `unmounted`。

Vue 2 示例

```js
export default {
  beforeDestroy() {
    console.log('Component is about to be destroyed');
  },
  destroyed() {
    console.log('Component has been destroyed');
  }
};
```

Vue 3 示例

```js
export default {
  beforeUnmount() {
    console.log('Component is about to be unmounted');
  },
  unmounted() {
    console.log('Component has been unmounted');
  }
};
```

## 3. 使用 Vue 3 的新特性

Vue 3 引入了许多新的特性，下面我们将介绍一些关键的新特性，并展示如何在项目中使用它们。

### Composition API

Composition API 是 Vue 3 中的一个重要新特性，它提供了一种更灵活、更可组合的方式来组织组件逻辑。

示例

```js
import { ref, reactive, onMounted } from 'vue';
export default {
  setup() {
    const count = ref(0);
    const state = reactive({
      message: 'Hello, Vue 3!'
    });
    function increment() {
      count.value++;
    }
    onMounted(() => {
      console.log('Component has been mounted');
    });
    return {
      count,
      state,
      increment
    };
  }
};
```

### Teleport

Teleport 允许你将组件的 DOM 渲染到一个特定的 DOM 节点之外。

示例

```js
<template>
  <div>
    <teleport to="#modals">
      <div class="modal">
        <p>This is a modal</p>
      </div>
    </teleport>
  </div>
</template>
```

### Fragments

在 Vue 3 中，组件可以返回多个根节点，从而摆脱了 Vue 2 中必须有单一根节点的限制。

示例

```js
<template>
  <div>
    <header>Header Content</header>
    <main>Main Content</main>
    <footer>Footer Content</footer>
  </div>
</template>
```

## 4. 测试和调试

在完成代码迁移后，确保对整个项目进行全面的测试和调试。以下是一些推荐的测试和调试步骤。

### 单元测试（使用 Jest）

使用 Jest 或 Mocha 等测试框架，编写和运行单元测试，确保所有功能正常工作。

示例

```js
import { mount } from '@vue/test-utils';
import HelloWorld from '@/components/HelloWorld.vue';
describe('HelloWorld.vue', () => {
  it('renders props.msg when passed', () => {
    const msg = 'new message';
    const wrapper = mount(HelloWorld, {
      props: { msg }
    });
    expect(wrapper.text()).toMatch(msg);
  });
});
```

### 端到端测试（使用 Cypress）

使用 Cypress 或 Nightwatch 等工具进行端到端测试，模拟用户操作，确保应用在真实使用场景中表现正常。

示例

```js
describe('My First Test', () => {
  it('Visits the app root url', () => {
    cy.visit('/');
    cy.contains('h1', 'Welcome to Your Vue.js App');
  });
});
```

### 调试

使用 Vue Devtools 来调试 Vue 3 应用。确保你安装了最新版本的 Vue Devtools，并在开发者工具中启用了 Vue 3 支持。





## 5. vue3组件定义

```html
    <div id="box">
        {{myname}}
        <navbar myname="aaa">
            <div>111111111111111</div>
        </navbar>
        <sidebar></sidebar>
    </div>

    <script>
        var obj = {
            data() {
                return {
                    myname: "jerry"
                }
            },
            methods: {}
            computed: {}
        }
        var app = Vue.createApp(obj)
        app.component("navbar", {
            props: ["myname"],
            template: `
                <div>
                    navbar-{{myname}}
                    <slot></slot>
                </div>
            `
        })
        app.component("sidebar", {
            template: `
            <div>123123123</div>
            `
        })
        app.mount("#box")
    </script>
```



## 6. vue3自定义指令

### 6.1 生命周期

- `created `: 在绑定元素的属性或事件监听器被应用之前调用。
- `beforeMount `: 指令第一次绑定到元素并且在挂载父组件之前调用。
- `mounted `: 在绑定元素的父组件被挂载后调用。
- `beforeUpdate`: 在更新包含组件的 VNode 之前调用。
- `updated`: 在包含组件的 VNode 及其子组件的 VNode 更新后调用。
- `beforeUnmount`: 当指令与在绑定元素父组件卸载之前时，只调用一次。
- `unmounted`: 当指令与元素解除绑定且父组件已卸载时，只调用一次。

与组件的生命周期，除了没有 **beforeCreate** 外，其他都一样。



### 6.2 轮播

* vue3中使用轮播：https://www.zhangshengrong.com/p/bYXxz4ZLaZ/
* 指令轮播示例：

```html
    <div id="box">
        <header>导航</header>
        <div class="swiper">
            <div class="swiper-wrapper">
                <!-- 绑一个自定义指令 v-swiper，传参为对象解构 -->
                <div class="swiper-slide" v-for="(item, index) in datalist" :key="item"
                    v-swiper="{index: index, length: datalist.length}">
                    {{item}}
                </div>
            </div>
            <!-- 如果需要分页器 -->
            <div class="swiper-pagination"></div>

            <!-- 如果需要导航按钮 -->
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
        </div>
        <footer>底部内容</footer>
    </div>


    <script>
        // 自定义指令 v-swiper
        var obj = {
            data() {
                return {
                    datalist: []
                }
            },
            mounted() {
                setTimeout(() => {
                    this.datalist = ["aaa", "bbb", "ccc"]
                    //过早
                }, 2000)
            },
        }

        var app = Vue.createApp(obj)
        app.directive("swiper", {
            mounted(el, binding) {
                console.log("inserted", el, binding.value)
                // 如果最后一个节点插入到父节点中了，就可以 new Swiper 初始化了
                let { index, length } = binding.value
                if (binding.value = length) {
                    console.log("new Swiper")
                    new Swiper(".swiper", {
                        // direction: 'vertical', // 垂直切换选项
                        loop: true, // 循环模式选项
                        // 如果需要分页器
                        pagination: {
                            el: '.swiper-pagination',
                        },
                        // 如果需要前进后退按钮
                        navigation: {
                            nextEl: '.swiper-button-next',
                            prevEl: '.swiper-button-prev',
                        },
                        // 自动轮播
                        autoplay: {
                            delay: 2500,
                            disableOnInteraction: false,
                        },
                    })
                }
            }
        })
        app.mount("#box")
    </script>
```





### 6.3 路由

router/index.js - vue2可以用 `*` 做默认匹配，vue3中需要使用 `\`

```js
const routes = [
  ...
  // 重定向：访问根目录时，自动重定向到 /films
  {
    path: '/',
    redirect: '/films'
  }
]
```





